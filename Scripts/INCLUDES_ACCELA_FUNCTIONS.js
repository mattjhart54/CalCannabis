/*------------------------------------------------------------------------------------------------------/
| Program : INCLUDES_ACCELA_FUNCTIONS.js
| Event   : N/A
|
| Usage   : Accela Inc. Developed Master Script Functions.  This file should not be modified.  For custom
			includes make additions and overrides to the INCLUDES_CUSTOM script file.
|
| Notes   : For Application Submit Before see INCLUDES_ACCELA_FUNCTIONS_ASB
|
/------------------------------------------------------------------------------------------------------*/

var INCLUDE_VERSION = "3.1.28";

/*------------------------------------------------------------------------------------------------------/
| <===========Begin Standard Include Functions (used by Action entries)
/------------------------------------------------------------------------------------------------------*/

function activateTask(e){var t=!1,a="";2==arguments.length&&(a=arguments[1],t=!0);var r=aa.workflow.getTaskItems(capId,e,a,null,null,null);if(!r.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var s=r.getOutput();for(i in s){var n=s[i];if(n.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!t||n.getProcessCode().equals(a))){var o=n.getStepNumber(),g=n.getProcessID();t?aa.workflow.adjustTask(capId,o,g,"Y","N",null,null):aa.workflow.adjustTask(capId,o,"Y","N",null,null),logMessage("Activating Workflow Task: "+e),logDebug("Activating Workflow Task: "+e)}}}function activeLicense(e){if(null==e||aa.util.instanceOfString(e))return!1;var t=aa.expiration.activeLicensesByCapID(e);return t.getSuccess()?!0:(aa.print("ERROR: Failed to activate License with CAP("+e+"): "+t.getErrorMessage()),!1)}function activeTasksCheck(){var e=aa.workflow.getTasks(capId);if(!e.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=e.getOutput();for(i in wfObj)if(fTask=wfObj[i],fTask.getActiveFlag().equals("Y"))return!0;return!1}function addAddressCondition(e,t,a,r,s,n){if(e){var i=aa.addressCondition.addAddressCondition(e,t,r,s,null,null,n,a,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);logDebug(i.getSuccess()?"Successfully added condition to Address "+e+"  ("+n+") "+r:"**ERROR: adding condition to Address "+e+"  ("+n+"): "+i.getErrorMessage())}else{var o=aa.address.getAddressByCapId(capId);if(o.getSuccess()){var g=o.getOutput();for(zz in g)if(g[zz].getRefAddressId()){var i=aa.addressCondition.addAddressCondition(g[zz].getRefAddressId(),t,r,s,null,null,n,a,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);logDebug(i.getSuccess()?"Successfully added condition to reference Address "+g[zz].getRefAddressId()+"  ("+n+") "+r:"**ERROR: adding condition to reference Address "+g[zz].getRefAddressId()+"  ("+n+"): "+i.getErrorMessage())}}}}function addAddressDistrict(e,t){if(e){if(apdResult=aa.address.addAddressDistrictForDaily(capId.getID1(),capId.getID2(),capId.getID3(),e,t),!apdResult.getSuccess())return logDebug("**ERROR Adding District "+t+" to address #"+e+" : "+apdResult.getErrorMessage()),!1;logDebug("Successfully added district "+t+" to address #"+e)}else{var a=aa.address.getAddressByCapId(capId);if(a.getSuccess()){var r=a.getOutput();for(var s in r){if(apdResult=aa.address.addAddressDistrictForDaily(capId.getID1(),capId.getID2(),capId.getID3(),r[s].getAddressId(),t),!apdResult.getSuccess())return logDebug("**ERROR Adding District "+t+" to address #"+r[s].getAddressId()+" : "+apdResult.getErrorMessage()),!1;logDebug("Successfully added district "+t+" to address #"+r[s].getAddressId())}}}}function addAddressStdCondition(e,t,a){var r=!1;if(cStatus="Applied",arguments.length>3&&(cStatus=arguments[3]),aa.capCondition.getStandardConditions){for(standardConditions=aa.capCondition.getStandardConditions(t,a).getOutput(),i=0;i<standardConditions.length;i++)if(standardConditions[i].getConditionType().toUpperCase()==t.toUpperCase()&&standardConditions[i].getConditionDesc().toUpperCase()==a.toUpperCase())if(standardCondition=standardConditions[i],r=!0,e){var s=aa.addressCondition.addAddressCondition(e,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,null,systemUserObj,systemUserObj);logDebug(s.getSuccess()?"Successfully added condition to Address "+e+" "+a:"**ERROR: adding condition to Address "+e+" "+s.getErrorMessage())}else{var n=aa.address.getAddressByCapId(capId);if(n.getSuccess()){var o=n.getOutput();for(zz in o)if(o[zz].getRefAddressId()){var s=aa.addressCondition.addAddressCondition(o[zz].getRefAddressId(),standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,null,systemUserObj,systemUserObj);logDebug(s.getSuccess()?"Successfully added condition to reference Address "+o[zz].getRefAddressId()+" "+a:"**ERROR: adding condition to reference Address "+o[zz].getRefAddressId()+" "+s.getErrorMessage())}}}}else logDebug("addAddressStdCondition function is not available in this version of Accela Automation.");r||logDebug("**WARNING: couldn't find standard condition for "+t+" / "+a)}function addAdHocTask(e,t,a){var r=capId,s=currentUserID;arguments.length>3&&(s=arguments[3]),arguments.length>4&&(r=arguments[4]);var n=aa.person.getUser(s);if(!n.getSuccess())return logDebug("Could not find user to assign to"),!1;var i=aa.workflow.getTasks(r).getOutput()[0].getTaskItem();return i.setProcessCode(e),i.setTaskDescription(t),i.setDispositionNote(a),i.setProcessID(0),i.setAssignmentDate(aa.util.now()),i.setDueDate(aa.util.now()),i.setAssignedUser(n.getOutput()),wf=aa.proxyInvoker.newInstance("com.accela.aa.workflow.workflow.WorkflowBusiness").getOutput(),wf.createAdHocTaskItem(i),!0}function addAllFees(e,t,a,r){var s=aa.finance.getFeeItemList(null,e,null).getOutput();for(xx in s){var n=s[xx].getFeeCod(),i=aa.finance.createFeeItem(capId,e,n,t,a);if(i.getSuccess()){var o=i.getOutput();logMessage("Added Fee "+n+", Qty "+a),logDebug("The assessed fee Sequence Number "+o),"Y"==r&&(feeSeqList.push(o),paymentPeriodList.push(t))}else logDebug("**ERROR: assessing fee ("+n+"): "+i.getErrorMessage())}}function addAppCondition(e,t,a,r,s,n){var i;i=arguments.length>5?aa.capCondition.addCapCondition(capId,e,a,r,sysDate,null,sysDate,null,null,s,systemUserObj,systemUserObj,t,currentUserID,"A",n):aa.capCondition.addCapCondition(capId,e,a,r,sysDate,null,sysDate,null,null,s,systemUserObj,systemUserObj,t,currentUserID,"A"),i.getSuccess()?(logDebug("Successfully added condition ("+s+") "+a),logDebug("Successfully added condition ("+s+") "+a)):logDebug("**ERROR: adding condition ("+s+"): "+i.getErrorMessage())}function addASITable(e,t){var a=capId;arguments.length>2&&(a=arguments[2]);var r=aa.appSpecificTableScript.getAppSpecificTableModel(a,e);if(!r.getSuccess())return logDebug("**WARNING: error retrieving app specific table "+e+" "+r.getErrorMessage()),!1;var s=r.getOutput(),n=s.getAppSpecificTableModel(),i=n.getTableField(),o=n.getReadonlyField();for(thisrow in t){for(var g=n.getColumns(),u=g.iterator();u.hasNext();){var c=u.next();t[thisrow][c.getColumnName()]||(logDebug("addToASITable: null or undefined value supplied for column "+c.getColumnName()+", setting to empty string"),t[thisrow][c.getColumnName()]=""),"undefined"!=typeof t[thisrow][c.getColumnName()].fieldValue?(i.add(t[thisrow][c.getColumnName()].fieldValue),o.add(t[thisrow][c.getColumnName()].readOnly)):(i.add(t[thisrow][c.getColumnName()]),o.add(null))}n.setTableField(i),n.setReadonlyField(o)}var l=aa.appSpecificTableScript.editAppSpecificTableInfos(n,a,currentUserID);return l.getSuccess()?void logDebug("Successfully added record to ASI Table: "+e):(logDebug("**WARNING: error adding record to ASI Table:  "+e+" "+l.getErrorMessage()),!1)}function addASITable4ACAPageFlow(e,t,a){var r=capId;arguments.length>3&&(r=arguments[3]);for(var s=e.getTablesMap().values(),n=s.iterator(),i=!1;n.hasNext();){var o=n.next();if(o.getTableName().equals(t)){i=!0;break}}if(!i)return logDebug("cannot update asit for ACA, no matching table name"),!1;var g=-1;null!=o.getTableFields()&&(g=0-o.getTableFields().size());for(thisrow in a){for(var u=aa.util.newArrayList(),c=aa.util.newArrayList(),l=o.getColumns(),p=l.iterator();p.hasNext();){var d=p.next();if(a[thisrow][d.getColumnName()]||(logDebug("addToASITable: null or undefined value supplied for column "+d.getColumnName()+", setting to empty string"),a[thisrow][d.getColumnName()]=""),"undefined"!=typeof a[thisrow][d.getColumnName()].fieldValue){var f=new Array(a[thisrow][d.getColumnName()].fieldValue?a[thisrow][d.getColumnName()].fieldValue:"",d),m=aa.proxyInvoker.newInstance("com.accela.aa.aamain.appspectable.AppSpecificTableField",f).getOutput();m.setRowIndex(g),m.setFieldLabel(d.getColumnName()),m.setFieldGroup(t.replace(/ /g,"+")),m.setReadOnly(a[thisrow][d.getColumnName()].readOnly.equals("Y")),u.add(m),c.add(a[thisrow][d.getColumnName()].readOnly)}else{var f=new Array(a[thisrow][d.getColumnName()]?a[thisrow][d.getColumnName()]:"",d),m=aa.proxyInvoker.newInstance("com.accela.aa.aamain.appspectable.AppSpecificTableField",f).getOutput();m.setRowIndex(g),m.setFieldLabel(d.getColumnName()),m.setFieldGroup(t.replace(/ /g,"+")),m.setReadOnly(!1),u.add(m),c.add("N")}}g--,null==o.getTableFields()?o.setTableFields(u):o.getTableFields().addAll(u),null==o.getReadonlyField()?o.setReadonlyField(c):o.getReadonlyField().addAll(c)}return tssm=o,e}function addContactStdCondition(e,t,a){var r=!1,s=new Date,n=aa.date.transToJavaUtilDate(s.getTime());if(cStatus="Applied",arguments.length>3&&(cStatus=arguments[3]),aa.capCondition.getStandardConditions){for(standardConditions=aa.capCondition.getStandardConditions(t,a).getOutput(),i=0;i<standardConditions.length;i++)if(standardConditions[i].getConditionType().toUpperCase()==t.toUpperCase()&&standardConditions[i].getConditionDesc().toUpperCase()==a.toUpperCase())if(standardCondition=standardConditions[i],r=!0,e){var o=aa.commonCondition.getNewCommonConditionModel().getOutput();o.setServiceProviderCode(aa.getServiceProviderCode()),o.setEntityType("CONTACT"),o.setEntityID(e),o.setConditionDescription(standardCondition.getConditionDesc()),o.setConditionGroup(standardCondition.getConditionGroup()),o.setConditionType(standardCondition.getConditionType()),o.setConditionComment(standardCondition.getConditionComment()),o.setImpactCode(standardCondition.getImpactCode()),o.setConditionStatus(cStatus),o.setAuditStatus("A"),o.setIssuedByUser(systemUserObj),o.setIssuedDate(n),o.setEffectDate(n),o.setAuditID(currentUserID);var g=aa.commonCondition.addCommonCondition(o);logDebug(g.getSuccess()?"Successfully added reference contact ("+e+") condition: "+a:"**ERROR: adding reference contact ("+e+") condition: "+g.getErrorMessage())}else{var u=aa.people.getCapContactByCapID(capId);if(u.getSuccess()){var c=u.getOutput();for(var l in c){var p=c[l].getCapContactModel().getPeople().getRefContactNumber();if(p){var o=aa.commonCondition.getNewCommonConditionModel().getOutput();o.setServiceProviderCode(aa.getServiceProviderCode()),o.setEntityType("CONTACT"),o.setEntityID(p),o.setConditionDescription(standardCondition.getConditionDesc()),o.setConditionGroup(standardCondition.getConditionGroup()),o.setConditionType(standardCondition.getConditionType()),o.setConditionComment(standardCondition.getConditionComment()),o.setImpactCode(standardCondition.getImpactCode()),o.setConditionStatus(cStatus),o.setAuditStatus("A"),o.setIssuedByUser(systemUserObj),o.setIssuedDate(n),o.setEffectDate(n),o.setAuditID(currentUserID);var g=aa.commonCondition.addCommonCondition(o);logDebug(g.getSuccess()?"Successfully added reference contact ("+p+") condition: "+a:"**ERROR: adding reference contact ("+p+") condition: "+g.getErrorMessage())}}}}}else logDebug("addAddressStdCondition function is not available in this version of Accela Automation.");r||logDebug("**WARNING: couldn't find standard condition for "+t+" / "+a)}function addCustomFee(e,t,a,r,s,n){var i=capId;null==n&&(n="FINAL");var o=aa.finance.createFeeItem(i,e,t,n,r);if(o.getSuccess()){var g=o.getOutput(),u=aa.finance.getFeeItemByPK(i,g).getOutput().getF4FeeItem();u.setFeeDescription(a),s&&u.setAccCodeL1(s);var c=aa.finance.editFeeItem(u);logDebug(c.getSuccess()?"Added Custom Fee "+a:"Error Adding Fee "+c.getErrorMessage())}else logDebug("Error Adding Fee "+o.getErrorMessage())}function addFee(e,t,a,r,s){var n=capId,i="",o=new Array,g=new Array,u=null;if(arguments.length>5&&(n=arguments[5],i=" to specified CAP"),assessFeeResult=aa.finance.createFeeItem(n,t,e,a,r),assessFeeResult.getSuccess()){if(u=assessFeeResult.getOutput(),logMessage("Successfully added Fee "+e+", Qty "+r+i),logDebug("The assessed fee Sequence Number "+u+i),"Y"==s&&5==arguments.length&&(feeSeqList.push(u),paymentPeriodList.push(a)),"Y"==s&&arguments.length>5){o.push(u),g.push(a);var c=aa.finance.createInvoice(n,o,g);c.getSuccess()?logMessage("Invoicing assessed fee items"+i+" is successful."):logDebug("**ERROR: Invoicing the fee items assessed"+i+" was not successful.  Reason: "+invoiceResult.getErrorMessage())}updateFeeItemInvoiceFlag(u,s)}else logDebug("**ERROR: assessing fee ("+e+"): "+assessFeeResult.getErrorMessage()),u=null;return u}function addFeeByDate(e,t,a,r,s,n,i){var o=new Array,g=new Array,u=null,c=" to "+e.getCustomID(),l=aa.proxyInvoker.newInstance("com.accela.aa.finance.fee.RefFeeBusiness").getOutput();if(!l)return logDebug("could not instantiate RefFeeBusiness to determine fee version, exiting addFeeByDate"),!1;var p=convertDate(t);if(!p)return logDebug("could not convert date parameter to javascript date, exiting addFeeByDate"),!1;var d=l.getDefaultVersionBySchedule(aa.getServiceProviderCode(),r,p,"ADMIN");if(!d)return logDebug("could not determine default version for fee schedule "+r+", exiting addFeeByDate"),!1;if(assessFeeResult=aa.finance.createFeeItem(e,r,d,a,s,n),assessFeeResult.getSuccess()){if(u=assessFeeResult.getOutput(),logDebug("Successfully added Fee:"+a+", Qty:"+n+" Version:"+d+" Sched: "+r+" based on date "+p+" "+c+".  The assessed fee Sequence Number "+u+c),"Y"==i&&5==arguments.length&&(feeSeqList.push(u),paymentPeriodList.push(s)),"Y"==i&&arguments.length>5){o.push(u),g.push(s);var f=aa.finance.createInvoice(e,o,g);f.getSuccess()?logMessage("Invoicing assessed fee items"+c+" is successful."):logDebug("**ERROR: Invoicing the fee items assessed"+c+" was not successful.  Reason: "+invoiceResult.getErrorMessage())}updateFeeItemInvoiceFlag(u,i)}else logDebug("**ERROR: assessing fee ("+a+"): "+assessFeeResult.getErrorMessage()),u=null;return u}function addFeeWithExtraData(e,t,a,r,s,n,i,o,g){var u="",c=new Array,l=new Array;if(assessFeeResult=aa.finance.createFeeItem(n,t,e,a,r),!assessFeeResult.getSuccess())return logDebug("**ERROR: assessing fee ("+e+"): "+assessFeeResult.getErrorMessage()),null;if(feeSeq=assessFeeResult.getOutput(),logMessage("Successfully added Fee "+e+", Qty "+r+u),logDebug("The assessed fee Sequence Number "+feeSeq+u),fsm=aa.finance.getFeeItemByPK(n,feeSeq).getOutput().getF4FeeItem(),i&&fsm.setFeeNotes(i),o&&fsm.setUdf1(o),g&&fsm.setUdf2(g),aa.finance.editFeeItem(fsm),"Y"==s&&5==arguments.length&&(feeSeqList.push(feeSeq),paymentPeriodList.push(a)),"Y"==s&&arguments.length>5){c.push(feeSeq),l.push(a);var p=aa.finance.createInvoice(n,c,l);p.getSuccess()?logMessage("Invoicing assessed fee items is successful."):logDebug("**ERROR: Invoicing the fee items assessed was not successful.  Reason: "+invoiceResult.getErrorMessage())}return feeSeq}function addFeeWithExtraDataByDate(e,t,a,r,s,n,i,e,o,g,u){var c=new Array,l=new Array,p=null,d=" to "+e.getCustomID(),f=aa.proxyInvoker.newInstance("com.accela.aa.finance.fee.RefFeeBusiness").getOutput();if(!f)return logDebug("could not instantiate RefFeeBusiness to determine fee version, exiting addFeeByDate"),!1;var m=convertDate(t);if(!m)return logDebug("could not convert date parameter to javascript date, exiting addFeeByDate"),!1;var C=f.getDefaultVersionBySchedule(aa.getServiceProviderCode(),r,m,"ADMIN");if(!C)return logDebug("could not determine default version for fee schedule "+r+", exiting addFeeByDate"),!1;if(assessFeeResult=aa.finance.createFeeItem(e,r,a,s,n),!assessFeeResult.getSuccess())return logDebug("**ERROR: assessing fee ("+a+"): "+assessFeeResult.getErrorMessage()),null;if(p=assessFeeResult.getOutput(),logDebug("Successfully added Fee:"+a+", Qty:"+n+" Version:"+C+" Sched: "+r+" based on date "+m+" "+d+".  The assessed fee Sequence Number "+p+d),fsm=aa.finance.getFeeItemByPK(e,p).getOutput().getF4FeeItem(),o&&fsm.setFeeNotes(o),g&&fsm.setUdf1(g),u&&fsm.setUdf2(u),aa.finance.editFeeItem(fsm),"Y"==i&&5==arguments.length&&(feeSeqList.push(p),paymentPeriodList.push(s)),"Y"==i&&arguments.length>5){c.push(p),l.push(s);var b=aa.finance.createInvoice(e,c,l);b.getSuccess()?logMessage("Invoicing assessed fee items is successful."):logDebug("**ERROR: Invoicing the fee items assessed was not successful.  Reason: "+invoiceResult.getErrorMessage())}return p}function addGuideSheet(e,t,a){var r=null,s=aa.proxyInvoker.newInstance("com.accela.aa.inspection.guidesheet.RGuideSheetBusiness").getOutput();s&&(r=s.getRGuideSheet(aa.getServiceProviderCode(),a));var n=aa.proxyInvoker.newInstance("com.accela.aa.inspection.guidesheet.GGuideSheetBusiness").getOutput();if(r){var i=n.createGGuideSheet(e,r,t,"ADMIN");return i}}function addLicenseCondition(e,t,a,r,s){if(i=new Array,6==arguments.length)i.push(getRefLicenseProf(arguments[5]));else{var n=aa.licenseScript.getLicenseProf(capId);if(!n.getSuccess())return logDebug("**ERROR: getting lic profs from Cap: "+n.getErrorMessage()),!1;var i=n.getOutput()}for(var o in i)if(licSeq=6==arguments.length?i[o].getLicSeqNbr():i[o].getLicenseProfessionalModel().getLicSeqNbr(),licSeq>=0){var g=aa.caeCondition.addCAECondition(licSeq,e,a,r,null,null,s,t,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);logDebug(g.getSuccess()?"Successfully added licensed professional ("+licSeq+") condition ("+s+") "+a:"**ERROR: adding licensed professional ("+licSeq+") condition ("+s+"): "+g.getErrorMessage())}else logDebug("No reference link to license : "+i[o].getLicenseNbr())}function addLicenseStdCondition(e,t,a){var r=!1;if(cStatus="Applied",arguments.length>3&&(cStatus=arguments[3]),aa.capCondition.getStandardConditions){for(standardConditions=aa.capCondition.getStandardConditions(t,a).getOutput(),i=0;i<standardConditions.length;i++)if(standardConditions[i].getConditionType().toUpperCase()==t.toUpperCase()&&standardConditions[i].getConditionDesc().toUpperCase()==a.toUpperCase())if(standardCondition=standardConditions[i],r=!0,e){var s=aa.caeCondition.addCAECondition(e,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);logDebug(s.getSuccess()?"Successfully added licensed professional ("+e+") condition: "+a:"**ERROR: adding licensed professional ("+e+") condition: "+s.getErrorMessage())}else{var n=aa.licenseScript.getLicenseProf(capId);if(!n.getSuccess())return logDebug("**ERROR: getting lic profs from Cap: "+n.getErrorMessage()),!1;var o=n.getOutput();for(var g in o)if(o[g].getLicenseProfessionalModel().getLicSeqNbr()){licSeq=o[g].getLicenseProfessionalModel().getLicSeqNbr();var s=aa.caeCondition.addCAECondition(licSeq,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);logDebug(s.getSuccess()?"Successfully added licensed professional ("+licSeq+") condition: "+a:"**ERROR: adding licensed professional ("+licSeq+") condition: "+s.getErrorMessage())}}}else logDebug("addLicenseStdCondition function is not available in this version of Accela Automation.");r||logDebug("**WARNING: couldn't find standard condition for "+t+" / "+a)}function addLookup(e,t,a){var r=aa.bizDomain.getBizDomainByValue(e,t);if(r.getSuccess())return logDebug("Standard Choices Item "+e+" and Value "+t+" already exist.  Lookup is not added or updated."),!1;if(null!=e&&e.length&&null!=t&&t.length&&null!=a&&a.length){var r=aa.bizDomain.createBizDomain(e,t,"A",a);logDebug(r.getSuccess()?"Successfully created Std Choice("+e+","+t+") = "+a:"**ERROR creating Std Choice "+r.getErrorMessage())}else logDebug("Could not create std choice, one or more null values")}function addParameter(e,t,a){null!=t&&(null==a&&(a=""),e.put(t,a))}function addParcelAndOwnerFromRefAddress(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.parcel.getPrimaryParcelByRefAddressID(e,"Y");if(!a.getSuccess())return logDebug("**ERROR: Failed to get primary parcel for ref Address "+e+" , "+a.getErrorMessage()),!1;var r=a.getOutput(),s=aa.parcel.warpCapIdParcelModel2CapParcelModel(t,r).getOutput(),n=aa.parcel.createCapParcel(s);logDebug(n.getSuccess()?"created CAP Parcel":"**WARNING: Failed to create the cap Parcel "+n.getErrorMessage());var i=aa.parcel.getParcelDailyByCapID(t,null);if(!i.getSuccess())return logDebug("**ERROR: Failed to get Parcel List "+i.getErrorMessage()),!1;var o=i.getOutput();for(var g in o){var u=aa.owner.getOwnersByParcel(o[g]);if(!u.getSuccess())return logDebug("**ERROR: Failed to get Owner List "+u.getErrorMessage()),!1;var c=u.getOutput();for(var l in c)c[l].setCapID(t),createOResult=aa.owner.createCapOwnerWithAPOAttribute(c[l]),logDebug(createOResult.getSuccess()?"Created CAP Owner":"**WARNING: Failed to create CAP Owner "+createOResult.getErrorMessage())}}function addParcelCondition(e,t,a,r,s,n){if(e){var i=aa.parcelCondition.addParcelCondition(e,t,r,s,null,null,n,a,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);i.getSuccess()?(logMessage("Successfully added condition to Parcel "+e+"  ("+n+") "+r),logDebug("Successfully added condition to Parcel "+e+"  ("+n+") "+r)):logDebug("**ERROR: adding condition to Parcel "+e+"  ("+n+"): "+i.getErrorMessage())}else{var o=aa.parcel.getParcelandAttribute(capId,null);if(o.getSuccess()){var g=o.getOutput().toArray();for(zz in g){logDebug("Adding Condition to parcel #"+zz+" = "+g[zz].getParcelNumber());var i=aa.parcelCondition.addParcelCondition(g[zz].getParcelNumber(),t,r,s,null,null,n,a,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);i.getSuccess()?(logMessage("Successfully added condition to Parcel "+g[zz].getParcelNumber()+"  ("+n+") "+r),logDebug("Successfully added condition to Parcel "+g[zz].getParcelNumber()+"  ("+n+") "+r)):logDebug("**ERROR: adding condition to Parcel "+g[zz].getParcelNumber()+"  ("+n+"): "+i.getErrorMessage())}}}}function addParcelDistrict(e,t){if(e){if(apdResult=aa.parcel.addParceDistrictForDaily(capId.getID1(),capId.getID2(),capId.getID3(),e,t),!apdResult.getSuccess())return logDebug("**ERROR Adding District "+t+" to parcel #"+e+" : "+apdResult.getErrorMessage()),!1;logDebug("Successfully added district "+t+" to parcel #"+e)}else{var a=aa.parcel.getParcelandAttribute(capId,null);if(a.getSuccess()){var r=a.getOutput().toArray();for(zz in r){if(apdResult=aa.parcel.addParceDistrictForDaily(capId.getID1(),capId.getID2(),capId.getID3(),r[zz].getParcelNumber(),t),!apdResult.getSuccess())return logDebug("**ERROR Adding District "+t+" to parcel #"+r[zz].getParcelNumber()+" : "+apdResult.getErrorMessage()),!1;logDebug("Successfully added district "+t+" to parcel #"+r[zz].getParcelNumber())}}}}function addParent(e){if("object"!=typeof e){var t=aa.cap.getCapID(e);if(!t.getSuccess())return logDebug("**ERROR: getting parent cap id ("+e+"): "+t.getErrorMessage()),!1;var a=t.getOutput()}else a=e;var r=aa.cap.createAppHierarchy(a,capId);logDebug(r.getSuccess()?"Successfully linked to Parent Application : "+e:"**ERROR: linking to parent application parent cap id ("+e+"): "+r.getErrorMessage())}function addPublicUserLPsToRecord(e,t){var a=aa.publicUser.getPublicUserByPUser(t);if(!a.getSuccess()||!a.getOutput())return logDebug("**WARNING** couldn't find public user "+t+" "+a.getErrorMessage()),!1;var r=a.getOutput().getUserSeqNum(),s=aa.licenseScript.getRefLicProfByOnlineUser(r);if(!s.getSuccess()||!s.getOutput())return logDebug("**WARNING** no associated LPs to publuc user "+t+" "+s.getErrorMessage()),!1;var n=s.getOutput();for(var i in n){var o=n[i],g=aa.licenseScript.associateLpWithCap(capId,o);logDebug(g.getSuccess()?"Associated LP "+o.getStateLicense()+" to Record "+e.getCustomID():"**WARNING** failed to associate LP "+o.getStateLicense+" to Record "+g.getErrorMessage())}}function addrAddCondition(e,t,a,r,s,n,i){if("Y"==i)var o=!1;else var o=!0;var g=!1;if(e){if(o){var u,c,l,p;if(m=aa.addressCondition.getAddressConditions(e),C=m.getOutput(),C.length>0)for(bb in C)if(u=C[bb].getConditionType(),c=C[bb].getConditionStatus(),l=C[bb].getConditionDescription(),p=C[bb].getImpactCode(),null==u&&(u=" "),null==c&&(c=" "),null==l&&(l=" "),null==p&&(p=" "),!(null!=t&&t.toUpperCase()!=u.toUpperCase()||null!=a&&a.toUpperCase()!=c.toUpperCase()||null!=r&&r.toUpperCase()!=l.toUpperCase()||null!=n&&n.toUpperCase()!=p.toUpperCase()))return logMessage("Condition already exists: New condition not added to Address ID "+e),logDebug("Condition already exists: New condition not added to Address ID "+e),!1}var d=aa.addressCondition.addAddressCondition(e,t,r,s,null,null,n,a,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);d.getSuccess()?(logMessage("Successfully added condition to Address ID "+e+"  ("+n+") "+r),logDebug("Successfully added condition to Address ID "+e+"  ("+n+") "+r),g=!0):logDebug("**ERROR: adding condition to Address "+e+"  ("+n+"): "+d.getErrorMessage())}else{var f=aa.address.getAddressByCapId(capId);if(f.getSuccess()){var d,m,C,b=f.getOutput();e:for(zz in b){var D=b[zz].getRefAddressId();if(null!=D){if(o){var u,c,l,p;if(m=aa.addressCondition.getAddressConditions(D),C=m.getOutput(),C.length>0)for(bb in C)if(u=C[bb].getConditionType(),c=C[bb].getConditionStatus(),l=C[bb].getConditionDescription(),p=C[bb].getImpactCode(),null==u&&(u=" "),null==c&&(c=" "),null==l&&(l=" "),null==p&&(p=" "),!(null!=t&&t.toUpperCase()!=u.toUpperCase()||null!=a&&a.toUpperCase()!=c.toUpperCase()||null!=r&&r.toUpperCase()!=l.toUpperCase()||null!=n&&n.toUpperCase()!=p.toUpperCase())){logMessage("Condition already exists: New condition not added to Address ID "+D),logDebug("Condition already exists: New condition not added to Address ID "+D);continue e}}logDebug("Adding Condition to address "+zz+" = "+D),d=aa.addressCondition.addAddressCondition(D,t,r,s,null,null,n,a,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj),d.getSuccess()?(logMessage("Successfully added condition to Address ID "+D+"  ("+n+") "+r),logDebug("Successfully added condition to Address ID "+D+"  ("+n+") "+r),g=!0):logDebug("**ERROR: adding condition to Address "+D+"  ("+n+"): "+d.getErrorMessage())}else logDebug("No reference address ID found for Address "+zz)}}}return g}function addReferenceContactByName(e,t,a){var r=e,s=t,n=a,i=aa.people.getPeopleByFMLName(r,s,n);if(!i.getSuccess())return logDebug("**ERROR: Failed to get reference contact record: "+i.getErrorMessage()),!1;var o=i.getOutput();if(null==o)return logDebug("No reference user found."),!1;logDebug("No. of reference contacts found: "+o.length);var g=aa.people.createCapContactWithRefPeopleModel(capId,o[0]);if(g.getSuccess()){logDebug("Contact successfully added to CAP.");var u=aa.people.getCapContactByCapID(capId);if(u.getSuccess()){var c=u.getOutput(),l=c.length,p=c[l-1].getCapContactModel().getPeople().getContactSeqNumber();return logDebug("Contact Nbr = "+p),p}return logDebug("**ERROR: Failed to get Contact Nbr: "+u.getErrorMessage()),!1}return logDebug("**ERROR: Cannot add contact: "+g.getErrorMessage()),!1}function addressExistsOnCap(){var e=capId;1==arguments.length&&(e=arguments[0]);var t=null,a=aa.address.getAddressByCapId(e);if(!a.getSuccess())return logDebug("**ERROR: Failed to get Address object: "+a.getErrorType()+":"+a.getErrorMessage()),!1;var t=a.getOutput();for(i in t)return!0;return!1}function addStdCondition(e,t){var a=capId;if(3==arguments.length&&(a=arguments[2]),aa.capCondition.getStandardConditions)for(standardConditions=aa.capCondition.getStandardConditions(e,t).getOutput(),i=0;i<standardConditions.length;i++){standardCondition=standardConditions[i];var r=aa.capCondition.addCapCondition(a,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),sysDate,null,sysDate,null,null,standardCondition.getImpactCode(),systemUserObj,systemUserObj,"Applied",currentUserID,"A",null,standardCondition.getDisplayConditionNotice(),standardCondition.getIncludeInConditionName(),standardCondition.getIncludeInShortDescription(),standardCondition.getInheritable(),standardCondition.getLongDescripton(),standardCondition.getPublicDisplayMessage(),standardCondition.getResolutionAction(),null,null,standardCondition.getConditionNbr(),standardCondition.getConditionGroup(),standardCondition.getDisplayNoticeOnACA(),standardCondition.getDisplayNoticeOnACAFee(),standardCondition.getPriority(),standardCondition.getConditionOfApproval());logDebug(r.getSuccess()?"Successfully added condition ("+standardCondition.getConditionDesc()+")":"**ERROR: adding condition ("+standardCondition.getConditionDesc()+"): "+r.getErrorMessage())}else logDebug("addStdCondition function is not available in this version of Accela Automation.")}function addTask(e,t,a){var r=capId;if(arguments.length>3&&(r=arguments[3]),!a.toUpperCase().equals("P")&&!a.toUpperCase().equals("N"))return logDebug("WARNING: Insert Task Type must be P or N"),!1;var s,n=aa.workflow.getTask(r,e);if(!n.getSuccess())return logDebug("WARNING: Failed to get task! Path = "+e+";"+n.getErrorMessage()),!1;s=n.getOutput(),s.setTaskDescription(t);var i=aa.workflow.insertTask(s,a);if(!i.getSuccess())return logDebug("WARNING: Failed to add task! Path = "+taskPath+";"+i.getErrorMessage()),!1;var o=s.getProcessID(),g=s.getStepNumber(),n=aa.workflow.getTask(r,g,o);return n.getSuccess()?(s=n.getOutput(),logDebug("add task successful : inserted task name = "+s.getTaskDescription()+"; Process name = "+s.getProcessCode()),s):(logDebug("WARNING: Failed to get task! Path = "+taskPath+";"+n.getErrorMessage()),!1)}function addTimeAccountingRecord(e,t,a,r,s,n,i){if(!aa.timeAccounting.getTimeTypeByTimeTypeName)return logDebug("addTimeAccountingRecordToWorkflow function required AA 7.1SP3 or higher."),!1;userRight=aa.userright.getUserRight(appTypeArray[0],e).getOutput(),TimeAccountingResult=aa.timeAccounting.getTimeLogModel(),TimeAccountingResult.getSuccess(),TimeAccounting=TimeAccountingResult.getOutput();var o="N";i&&(o="Y"),TimeAccounting.setAccessModel("N"),TimeAccounting.setBillable(o),TimeAccounting.setCreatedBy(e),TimeAccounting.setCreatedDate(aa.date.getCurrentDate()),TimeAccounting.setDateLogged(aa.date.parseDate(r)),TimeAccounting.setEndTime(null),TimeAccounting.setEntryCost(0),TimeAccounting.setEntryPct(0),TimeAccounting.setEntryRate(0),TimeAccounting.setLastChangeDate(aa.date.getCurrentDate()),TimeAccounting.setLastChangeUser(e),TimeAccounting.setMaterials(null),TimeAccounting.setMaterialsCost(0),TimeAccounting.setMilageTotal(0),TimeAccounting.setMileageEnd(0),TimeAccounting.setMileageStart(0),TimeAccounting.setNotation(null),TimeAccounting.setReference(n?n:"N/A"),TimeAccounting.setStartTime(null),TimeAccounting.setTotalMinutes(60*s);var g="";if(-1!=s.indexOf(".")){var u="";u=60*s.substr(s.indexOf(".")),u=u.toString(),1==u.length&&(u="0"+u),g=r+" "+s.substr(0,s.indexOf("."))+":"+u+":00"}else g=r+" "+s+":00:00";var c=aa.timeAccounting.getTimeTypeByTimeTypeName(a);if(!c.getSuccess()||!c.getOutput())return logDebug("**WARNING: error retrieving Timeaccounting type : "+a+" : "+c.getErrorMessage()),!1;var l=aa.timeAccounting.getTimeGroupByTimeGroupName(t);return l.getSuccess()&&l.getOutput()?(TimeAccounting.setTimeElapsed(aa.date.parseDate(g)),TimeAccounting.setTimeGroupSeq(l.getOutput().getTimeGroupSeq()),TimeAccounting.setTimeTypeSeq(c.getOutput().getTimeTypeSeq()),TimeAccounting.setUserGroupSeqNbr(userRight.getGroupSeqNumber()),TimeAccounting.setVehicleId(null),addResult=aa.timeAccounting.addTimeLogModel(TimeAccounting),void logDebug(addResult.getSuccess()?"Successfully added Time Accounting Record.":"**ERROR: adding Time Accounting Record: "+addResult.getErrorMessage())):(logDebug("**WARNING: error retrieving Timeaccounting group : "+t+" : "+l.getErrorMessage()),!1)}function addTimeAccountingRecordToWorkflow(e,t,a,r,s,n,i,o,g){if(!aa.timeAccounting.getTimeTypeByTimeTypeName)return logDebug("addTimeAccountingRecordToWorkflow function required AA 7.1SP3 or higher."),!1;userRight=aa.userright.getUserRight(appTypeArray[0],e).getOutput(),TimeAccountingResult=aa.timeAccounting.getTimeLogModel(),TimeAccountingResult.getSuccess(),TimeAccounting=TimeAccountingResult.getOutput();
var u="N";g&&(u="Y"),TimeAccounting.setAccessModel("N"),TimeAccounting.setBillable(u),TimeAccounting.setCreatedBy(e),TimeAccounting.setCreatedDate(aa.date.getCurrentDate()),TimeAccounting.setDateLogged(aa.date.parseDate(r)),TimeAccounting.setEndTime(null),TimeAccounting.setEntryCost(0),TimeAccounting.setEntryPct(0),TimeAccounting.setEntryRate(0),TimeAccounting.setLastChangeDate(aa.date.getCurrentDate()),TimeAccounting.setLastChangeUser(currentUserID),TimeAccounting.setMaterials(null),TimeAccounting.setMaterialsCost(0),TimeAccounting.setMilageTotal(0),TimeAccounting.setMileageEnd(0),TimeAccounting.setMileageStart(0),TimeAccounting.setNotation(null),TimeAccounting.setReference(n),TimeAccounting.setStartTime(null),TimeAccounting.setTotalMinutes(60*s);var c="";if(-1!=s.indexOf(".")){var l="";l=60*s.substr(s.indexOf(".")),l=l.toString(),1==l.length&&(l="0"+l),c=r+" "+s.substr(0,s.indexOf("."))+":"+l+":00"}else c=r+" "+s+":00:00";var p=aa.timeAccounting.getTimeTypeByTimeTypeName(a);if(!p.getSuccess()||!p.getOutput())return logDebug("**WARNING: error retrieving Timeaccounting type : "+a+" : "+p.getErrorMessage()),!1;var d=aa.timeAccounting.getTimeGroupByTimeGroupName(t);if(!d.getSuccess()||!d.getOutput())return logDebug("**WARNING: error retrieving Timeaccounting group : "+t+" : "+d.getErrorMessage()),!1;TimeAccounting.setTimeElapsed(aa.date.parseDate(c)),TimeAccounting.setTimeGroupSeq(d.getOutput().getTimeGroupSeq()),TimeAccounting.setTimeTypeSeq(p.getOutput().getTimeTypeSeq()),TimeAccounting.setUserGroupSeqNbr(userRight.getGroupSeqNumber()),TimeAccounting.setVehicleId(null);var f=loadTasks(n),m=null;for(var C in f)!C.equals(i)||o&&!f[C].process.equals(o)||(m=TimeAccounting.getTimeLogModel(),m.setEntityId(f[C].step+":"+f[C].processID),m.setEntityType("WORKFLOW"),m.setCapIDModel(n));m?(addResult=aa.timeAccounting.addTimeLogModel(TimeAccounting),logDebug(addResult.getSuccess()?"Successfully added Time Accounting Record to task: "+i:"**WARNING: error adding Time Accounting Record to task: "+addResult.getErrorMessage())):logDebug("**WARNING: error adding Time Accounting Record: task "+i+", process "+o+" not found.")}function addToASITable(e,t){itemCap=capId,arguments.length>2&&(itemCap=arguments[2]);var a=aa.appSpecificTableScript.getAppSpecificTableModel(itemCap,e);if(!a.getSuccess())return logDebug("**WARNING: error retrieving app specific table "+e+" "+a.getErrorMessage()),!1;for(var r=a.getOutput(),s=r.getAppSpecificTableModel(),n=s.getTableField(),i=s.getColumns(),o=s.getReadonlyField(),g=i.iterator();g.hasNext();)colname=g.next(),t[colname.getColumnName()]||(logDebug("addToASITable: null or undefined value supplied for column "+colname.getColumnName()+", setting to empty string"),t[colname.getColumnName()]=""),"undefined"!=typeof t[colname.getColumnName()].fieldValue?(n.add(t[colname.getColumnName()].fieldValue),o.add(t[colname.getColumnName()].readOnly)):(n.add(t[colname.getColumnName()]),o.add(null));return s.setTableField(n),s.setReadonlyField(o),addResult=aa.appSpecificTableScript.editAppSpecificTableInfos(s,itemCap,currentUserID),addResult.getSuccess()?void logDebug("Successfully added record to ASI Table: "+e):(logDebug("**WARNING: error adding record to ASI Table:  "+e+" "+addResult.getErrorMessage()),!1)}function allTasksComplete(e){for(var t=new Array,a=1;a<arguments.length;a++)t.push(arguments[a]);var r=aa.workflow.getTasks(capId);if(!r.getSuccess())return logDebug("**ERROR: getting tasks : "+r.getErrorMessage()),!1;taskArr=r.getOutput();for(xx in taskArr)if(taskArr[xx].getProcessCode().equals(e)&&taskArr[xx].getActiveFlag().equals("Y")&&!exists(taskArr[xx].getTaskDescription(),t))return!1;return!0}function appHasCondition(e,t,a,r){if(null==e)var s=aa.capCondition.getCapConditions(capId);else var s=aa.capCondition.getCapConditions(capId,e);if(!s.getSuccess())return logMessage("**ERROR: getting cap conditions: "+s.getErrorMessage()),logDebug("**ERROR: getting cap conditions: "+s.getErrorMessage()),!1;var n,i,o,g=s.getOutput();for(cc in g){{var u=g[cc],n=u.getConditionStatus(),i=u.getConditionDescription(),o=u.getImpactCode();u.getConditionType()}if(null==n&&(n=" "),null==i&&(i=" "),null==o&&(o=" "),(null==t||t.toUpperCase().equals(n.toUpperCase()))&&(null==a||a.toUpperCase().equals(i.toUpperCase()))&&(null==r||r.toUpperCase().equals(o.toUpperCase())))return!0}return!1}function applyPayments(){var e=aa.finance.getPaymentByCapID(capId,null);if(!e.getSuccess())return logDebug("**ERROR: error retrieving payments "+e.getErrorMessage()),!1;var t=e.getOutput();for(var a in t){var r=t[a],s=r.getAmountNotAllocated(),n=r.getPaymentStatus();if(!(0>=s)&&"Paid"==n){var i=aa.finance.getFeeItemByCapID(capId);if(!i.getSuccess())return logDebug("**ERROR: error retrieving fee items "+i.getErrorMessage()),!1;var o=i.getOutput();for(var g in o){var u=o[g],c=0,l=aa.finance.getPaymentFeeItems(capId,null);if("INVOICED"==u.getFeeitemStatus()){if(!l.getSuccess())return logDebug("**ERROR: error retrieving fee payment items items "+l.getErrorMessage()),!1;var p=l.getOutput();for(ij in p)u.getFeeSeqNbr()==p[ij].getFeeSeqNbr()&&(c+=p[ij].getFeeAllocation());var d=u.getFee()-c;if(!(0>=d)){var f=new Array,m=new Array,C=new Array,b=aa.finance.getFeeItemInvoiceByFeeNbr(capId,u.getFeeSeqNbr(),null);if(!b.getSuccess())return logDebug("**ERROR: error retrieving invoice items "+b.getErrorMessage()),!1;var D=b.getOutput();if(1!=D.length)logDebug("**WARNING: fee item "+u.getFeeSeqNbr()+" returned "+D.length+" invoice matches");else{if(f.push(u.getFeeSeqNbr()),m.push(D[0].getInvoiceNbr()),C.push(d>s?s:d),applyResult=aa.finance.applyPayment(capId,r,f,m,C,"NA","NA","0"),!applyResult.getSuccess())return logDebug("**ERROR: error applying payment "+applyResult.getErrorMessage()),!1;s-=C[0],logDebug("Applied $"+C[0]+" to fee code "+u.getFeeCod()+".  Payment Balance: $"+s)}if(0>=s)break}}}}}}function appMatch(e){var t=appTypeArray;if(2==arguments.length){if(matchCapParm=arguments[1],matchCapId="string"==typeof matchCapParm?aa.cap.getCapID(matchCapParm).getOutput():matchCapParm,!matchCapId)return logDebug("**WARNING: CapId passed to appMatch was not valid: "+arguments[1]),!1;matchCap=aa.cap.getCap(matchCapId).getOutput(),t=matchCap.getCapType().toString().split("/")}var a=!0,r=e.split("/");if(4!=r.length)logDebug("**ERROR in appMatch.  The following Application Type String is incorrectly formatted: "+e);else for(xx in r)r[xx].equals(t[xx])||r[xx].equals("*")||(a=!1);return a}function appNameIsUnique(e,t,a){var r=aa.cap.getByAppType(e,t);if(!r.getSuccess())return logDebug("**ERROR: getting caps by app type: "+r.getErrorMessage()),null;var s=r.getOutput();for(aps in s){var n=aa.cap.getCap(s[aps].getCapID()).getOutput();if(n.getSpecialText()&&n.getSpecialText().toUpperCase().equals(a.toUpperCase())&&!capIDString.equals(s[aps].getCapID().getCustomID()))return!1}return!0}function asiTableValObj(e,t,a){this.columnName=e,this.fieldValue=t,this.readOnly=a,this.hasValue=Boolean(null!=t&""!=t),asiTableValObj.prototype.toString=function(){return String(this.hasValue?this.fieldValue:"")}}function assignCap(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();return r?(cd=r.getCapDetailModel(),iNameResult=aa.person.getUser(e),iNameResult.getSuccess()?(iName=iNameResult.getOutput(),cd.setAsgnDept(iName.getDeptOfUser()),cd.setAsgnStaff(e),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void logDebug("Assigned CAP to "+e):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR retrieving  user model "+e+" : "+iNameResult.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function assignInspection(e,t){var a=capId;if(arguments.length>2&&(a=arguments[2]),iObjResult=aa.inspection.getInspection(a,e),!iObjResult.getSuccess())return logDebug("**WARNING retrieving inspection "+e+" : "+iObjResult.getErrorMessage()),!1;if(iObj=iObjResult.getOutput(),iInspector=aa.person.getUser(t).getOutput(),!iInspector){var r=aa.people.getDepartmentList(null).getOutput();for(var s in r){var n=r[s];if(t.equals(n.getDeptName())){if(iNameResult=aa.person.getUser(null,null,null,null,n.getAgencyCode(),n.getBureauCode(),n.getDivisionCode(),n.getSectionCode(),n.getGroupCode(),n.getOfficeCode()),!iNameResult.getSuccess())return logDebug("**WARNING retrieving department user model "+t+" : "+iNameResult.getErrorMessage()),!1;iInspector=iNameResult.getOutput()}}}return iInspector?(logDebug("assigning inspection "+e+" to "+t),iObj.setInspector(iInspector),null==iObj.getScheduledDate()&&iObj.setScheduledDate(sysDate),void aa.inspection.editInspection(iObj)):(logDebug("**WARNING could not find inspector or department: "+t+", no assignment was made"),!1)}function assignTask(e,t){var a=!1,r="";3==arguments.length&&(r=arguments[2],a=!0);var s=aa.person.getUser(t);if(!s.getSuccess())return logMessage("**ERROR: Failed to get user object: "+s.getErrorMessage()),!1;taskUserObj=s.getOutput();var n=aa.workflow.getTaskItems(capId,e,r,null,null,null);if(!n.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var o=n.getOutput();for(i in o){var g=o[i];if(g.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!a||g.getProcessCode().equals(r))){g.setAssignedUser(taskUserObj);{var u=g.getTaskItem();aa.workflow.assignTask(u)}logMessage("Assigned Workflow Task: "+e+" to "+t),logDebug("Assigned Workflow Task: "+e+" to "+t)}}}function associateRefContactAddressToRecordContact(e,t,a){if(e&&t&&a){var r=aa.address.createXRefContactAddressModel().getOutput();r.setCapID(e),r.setAddressID(a.getAddressID()),r.setEntityID(aa.util.parseLong(t)),r.setEntityType(a.getEntityType());var s=aa.address.createXRefContactAddress(r.getXRefContactAddressModel());return s.getSuccess?(logDebug("Successfully assocaited reference contact address to cap contact: "+t),!0):(logDebug("Failed to associate reference contact address to cap: "+s.getErrorMessage()),!1)}return logDebug("Could not associate reference contact address no address model, capId or cap contact sequence number"),!1}function autoAssignInspection(e){return iObjResult=aa.inspection.getInspection(capId,e),iObjResult.getSuccess()?(iObj=iObjResult.getOutput(),inspTypeResult=aa.inspection.getInspectionType(iObj.getInspection().getInspectionGroup(),iObj.getInspectionType()),inspTypeResult.getSuccess()?(inspTypeArr=inspTypeResult.getOutput(),null==inspTypeArr||0==inspTypeArr.length?(logDebug("**ERROR no inspection type found"),!1):(inspType=inspTypeArr[0],inspSeq=inspType.getSequenceNumber(),inspSchedDate=iObj.getScheduledDate().getYear()+"-"+iObj.getScheduledDate().getMonth()+"-"+iObj.getScheduledDate().getDayOfMonth(),logDebug(inspSchedDate),iout=aa.inspection.autoAssignInspector(capId.getID1(),capId.getID2(),capId.getID3(),inspSeq,inspSchedDate),iout.getSuccess()?(inspectorArr=iout.getOutput(),null==inspectorArr||0==inspectorArr.length?(logDebug("**WARNING no auto-assign inspector found"),!1):(inspectorObj=inspectorArr[0],iObj.setInspector(inspectorObj),assignResult=aa.inspection.editInspection(iObj),assignResult.getSuccess()?void logDebug("Successfully reassigned inspection "+iObj.getInspectionType()+" to user "+inspectorObj.getUserID()):(logDebug("**ERROR re-assigning inspection "+assignResult.getErrorMessage()),!1))):(logDebug("**ERROR retrieving auto assign inspector "+iout.getErrorMessage()),!1))):(logDebug("**ERROR retrieving inspection Type "+inspTypeResult.getErrorMessage()),!1)):(logDebug("**ERROR retrieving inspection "+e+" : "+iObjResult.getErrorMessage()),!1)}function branch(e){doStandardChoiceActions(e,!0,0)}function branchTask(e,t,a,r){var s=!1,n="";5==arguments.length&&(n=arguments[4],s=!0);var o=aa.workflow.getTaskItems(capId,e,n,null,null,null);if(!o.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var g=o.getOutput();t||(t="NA");for(i in g){var u=g[i];if(u.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!s||u.getProcessCode().equals(n))){var c=aa.date.getCurrentDate(),l=u.getStepNumber(),p=u.getProcessID();s?aa.workflow.handleDisposition(capId,l,p,t,c,r,a,systemUserObj,"B"):aa.workflow.handleDisposition(capId,l,t,c,r,a,systemUserObj,"B"),logMessage("Closing Workflow Task: "+e+" with status "+t+", Branching..."),logDebug("Closing Workflow Task: "+e+" with status "+t+", Branching...")}}}function callWebService(e,t){aa.env.setValue("wsScriptParameters",t),aa.env.setValue("wsScriptDebug",""),aa.env.setValue("wsScriptMessage","");var a="",r="";logDebug("Executing Web Service wsSubScript: "+e),aa.runScriptInNewTransaction(e),a=aa.env.getValue("wsScriptDebug"),r=aa.env.getValue("wsScriptMessage"),""!=a&&(logDebug("Debug from wsSubScript: "+e),logDebug(a)),""!=r&&(logDebug("Message from wsSubScript: "+e),logDebug(r))}function capHasExpiredLicProf(e,t,a){var r;if(null==e||""==e)return logDebug("Invalid expiration type parameter"),!1;if(r=e.toUpperCase(),!matches(r,"EXPIRE","INSURANCE","BUSINESS"))return logDebug("Invalid expiration type parameter"),!1;var s=a;(null==a||""==a)&&(s=capId);var n=aa.licenseScript.getLicenseProf(capId);if(!n.getSuccess())return logDebug("Error getting CAP's license professional: "+n.getErrorMessage()),!1;var o=new Date,g=!1,u=n.getOutput();if(!u)return logDebug("No licensed professionals found on CAP"),!1;for(i in u)if(null==t||""==t||t.equals(u[i].getLicenseType())){var c=u[i].getLicenseNbr(),l=refLicProfGetDate(c,r);o>l&&(g=!0,logMessage("WARNING: Licence # "+c+" expired on "+jsDateToMMDDYYYY(l)),logDebug("Licence # "+c+" expired on "+jsDateToMMDDYYYY(l)))}return g}function capIdsFilterByFileDate(e,t,a){if(0==e.length||void 0==e[0])return logDebug("Invalid 1st parameter"),!1;var r,s,n=new Array,i=new Date(t),o=new Date(a);logDebug("Filtering CAP array by file date between "+t+" and "+a);for(y in e)r=aa.cap.getCap(e[y]).getOutput(),s=convertDate(r.getFileDate()),s>=i&&o>=s&&n.push(e[y]);return n}function capIdsGetByAddr(){var e=aa.address.getAddressByCapId(capId);if(!e.getSuccess())return logDebug("**ERROR: getting CAP addresses: "+e.getErrorMessage()),!1;var t=new Array,t=e.getOutput();if(0==t.length||void 0==t)return logDebug("The current CAP has no address.  Unable to get CAPs with the same address."),!1;var a=t[0].getStreetName(),r=t[0].getHouseNumberStart(),s=t[0].getStreetSuffix(),n=t[0].getZip(),o=t[0].getStreetDirection();""==o&&(o=null),""==s&&(s=null),""==n&&(n=null),r=r&&!isNaN(r)?parseInt(r):null;var g=aa.cap.getCapListByDetailAddress(a,r,s,n,o,null);if(!g.getSuccess())return logDebug("**ERROR: getting similar addresses: "+g.getErrorMessage()),!1;var u=g.getOutput(),c=new Array;for(i in u)c.push(u[i].getCapID());return c?c:!1}function capIdsGetByParcel(e){if(null!=e)var t=e;else{var a=aa.parcel.getParcelandAttribute(capId,null);if(!a.getSuccess())return logDebug("**ERROR: Failed to get parcels: "+a.getErrorMessage()),!1;var r=a.getOutput().toArray();if(void 0==r[0])return logDebug("Current CAP has no parcel"),!1;var t=r[0].getParcelNumber()}if(a=aa.cap.getCapListByParcelID(t,aa.util.newQueryFormat()),!a.getSuccess())return logDebug("**ERROR: Failed to get parcels: "+a.getErrorMessage()),!1;var s=a.getOutput(),n=new Array;for(i in s)n.push(s[i].getCapID());return n?n:!1}function capSet(e){this.refresh=function(){var e=aa.set.getSetByPK(this.id).getOutput();this.status=e.getSetStatus(),this.setId=e.getSetID(),this.name=e.getSetTitle(),this.comment=e.getSetComment(),this.model=e.getSetHeaderModel(),this.statusComment=e.getSetStatusComment();var t=aa.set.getCAPSetMembersByPK(this.id);t.getSuccess()?(this.members=t.getOutput().toArray(),this.size=this.members.length,this.members.length>0&&(this.empty=!1),logDebug("capSet: loaded set "+this.id+" of status "+this.status+" with "+this.size+" records")):logDebug("**WARNING** error retrieving set members "+t.getErrorMessage())},this.add=function(e){var t;2==arguments.length&&(t=arguments[1]);aa.set.add(this.id,e);t&&this.updateMemberStatus(e,t)},this.updateMemberStatus=function(e,t){var a=aa.set.getSetDetailsScriptModel().getOutput();a.setSetID(this.id),a.setID1(e.getID1()),a.setID2(e.getID2()),a.setID3(e.getID3()),a.setSetMemberStatus(t),a.setSetMemberStatusDate(aa.date.getCurrentDate()),a.setServiceProviderCode(aa.getServiceProviderCode());var r=aa.set.updateSetMemberStatus(a);logDebug(r.getSuccess()?"capSet: updated record "+e+" to status "+t:"**WARNING** error adding record to set "+this.id+" : "+r.getErrorMessage())},this.remove=function(e){var t=aa.set.removeSetHeadersListByCap(this.id,e);logDebug(t.getSuccess()?"capSet: removed record "+e+" from set "+this.id:"**WARNING** error removing record from set "+this.id+" : "+t.getErrorMessage())},this.update=function(){var e=aa.proxyInvoker.newInstance("com.accela.aa.aamain.cap.SetBusiness").getOutput();this.model.setSetStatus(this.status),this.model.setSetID(this.setId),this.model.setSetTitle(this.name),this.model.setSetComment(this.comment),this.model.setSetStatusComment(this.statusComment),this.model.setRecordSetType(this.type),logDebug("capSet: updating set header information");try{updateResult=e.updateSetBySetID(this.model)}catch(t){logDebug("**WARNING** error updating set header failed "+t.message)}},this.id=e,this.name=e,this.type=null,this.comment=null,arguments.length>1&&arguments[1]&&(this.name=arguments[1]),arguments.length>2&&arguments[2]&&(this.type=arguments[2]),arguments.length>3&&arguments[3]&&(this.comment=arguments[3]),this.size=0,this.empty=!0,this.members=new Array,this.status="",this.statusComment="",this.model=null;var t=aa.set.getSetByPK(this.id);t.getSuccess()?this.refresh():(t=aa.set.createSet(this.id,this.name,this.type,this.comment),t.getSuccess()?(logDebug("capSet: Created new set "+this.id+" of type "+this.type),this.refresh()):logDebug("**WARNING** error creating set "+this.id+" : "+t.getErrorMessage))}function checkCapForLicensedProfessionalType(e){var t=aa.licenseScript.getLicenseProf(capId);if(t.getSuccess()){var a=t.getOutput();if(!a)return logDebug("WARNING: no license professional available on the application:"),!1;for(licProf in a)if(e.equals(a[licProf].getLicenseType()))return aa.print("Found License Professional with Type= "+e),!0;return!1}return aa.print("**ERROR: getting lic prof: "+t.getErrorMessage()),!1}function checkInspectionResult(e,t){var a=aa.inspection.getInspections(capId);if(a.getSuccess()){var r=a.getOutput();for(xx in r)if(String(e).equals(r[xx].getInspectionType())&&String(t).equals(r[xx].getInspectionStatus()))return!0}return!1}function checkRequiredASIFields(){var e=aa.appSpecificInfo.getByCapID(capId),t=e.getOutput(),a=!0;for(var r in t)"Y"==t[r].getRequiredFlag()&&matches(t[r].checklistComment,null,void 0,"")&&(a=!1);return a}function childGetByCapType(e,t){if(null!=t)var a=t;else var a=capId;if(arguments.length>2)var r=arguments[2];else var r=null;var s=e.split("/");4!=s.length&&logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+e);var n=aa.cap.getChildByMasterID(a);if(n.getSuccess()){var i=n.getOutput();if(i.length){var o,g,u,c="";for(xx in i)if(o=i[xx].getCapID(),null==r||!r.getCustomID().equals(o.getCustomID())){c=aa.cap.getCap(o).getOutput().getCapType().toString(),g=c.split("/"),u=!0;for(yy in g)if(!s[yy].equals(g[yy])&&!s[yy].equals("*")){u=!1;break}if(u)return o}}else logDebug("**WARNING: childGetByCapType function found no children");return!1}logDebug("**WARNING: childGetByCapType function found no children: "+n.getErrorMessage())}function closeCap(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();return r?(cd=r.getCapDetailModel(),iNameResult=aa.person.getUser(e),iNameResult.getSuccess()?(iName=iNameResult.getOutput(),cd.setClosedDept(iName.getDeptOfUser()),cd.setClosedBy(e),r.setClosedDate(sysDate),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void(logDebug("Set CAP *Closed by Staff* to "+e)+"\nSet CAP *Closed by Dept* "+iName.getDeptOfUser()+"\nSet CAP *Closed Date* "+sysDate.toString()):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR retrieving  user model "+e+" : "+iNameResult.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function closeSubWorkflow(e,t){var a=capId;3==arguments.length&&(a=arguments[2]);var r=!0,s=aa.workflow.getTasks(a);if(!s.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var n=s.getOutput();for(i in n){var o=n[i];o.getProcessID()==e&&"Y"!=o.getCompleteFlag()&&(logDebug("closeSubWorkflow: found an incomplete task processID #"+e+" , Step# "+o.getStepNumber(),3),r=!1)}if(!r)return!1;var g=aa.workflow.getProcessRelationByCapID(a,null).getOutput(),u=null;for(thisRel in g)g[thisRel].getProcessID()==e&&(u=g[thisRel]);if(!u)return logDebug("closeSubWorkflow: did not find a process relation, exiting",3),!1;logDebug("executing handleDisposition:"+u.getStepNumber()+","+u.getParentProcessID()+","+t,3);var c=aa.workflow.handleDisposition(a,u.getStepNumber(),u.getParentProcessID(),t,sysDate,"Closed via script","Closed via script",systemUserObj,"Y");logDebug(c.getSuccess()?"Closed parent task":"**WARNING: closing parent task: "+c.getErrorMessage())}function closeTask(e,t,a,r){var s=!1,n="";5==arguments.length&&(n=arguments[4],s=!0);var o=aa.workflow.getTaskItems(capId,e,n,null,null,null);if(!o.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var g=o.getOutput();t||(t="NA");for(i in g){var u=g[i];if(u.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!s||u.getProcessCode().equals(n))){var c=aa.date.getCurrentDate(),l=u.getStepNumber(),p=u.getProcessID();s?aa.workflow.handleDisposition(capId,l,p,t,c,r,a,systemUserObj,"Y"):aa.workflow.handleDisposition(capId,l,t,c,r,a,systemUserObj,"Y"),logMessage("Closing Workflow Task: "+e+" with status "+t),logDebug("Closing Workflow Task: "+e+" with status "+t)}}}function comment(e){showDebug&&logDebug(e),showMessage&&logMessage(e)}function comparePeopleGeneric(e){e.setAuditDate(null),e.setAuditID(null),e.setAuditStatus(null),e.setBirthDate(null),e.setBusName2(null),e.setBusinessName(null),e.setComment(null),e.setCompactAddress(null),e.setContactSeqNumber(null),e.setContactType(null),e.setContactTypeFlag(null),e.setCountry(null),e.setCountryCode(null),e.setEndBirthDate(null),e.setFax(null),e.setFaxCountryCode(null),e.setFein(null),e.setFirstName(null),e.setFlag(null),e.setFullName(null),e.setGender(null),e.setHoldCode(null),e.setHoldDescription(null),e.setId(null),e.setIvrPinNumber(null),e.setIvrUserNumber(null),e.setLastName(null),e.setMaskedSsn(null),e.setMiddleName(null),e.setNamesuffix(null),e.setPhone1(null),e.setPhone1CountryCode(null),e.setPhone2(null),e.setPhone2CountryCode(null),e.setPhone3(null),e.setPhone3CountryCode(null),e.setPostOfficeBox(null),e.setPreferredChannel(null),e.setPreferredChannelString(null),e.setRate1(null),e.setRelation(null),e.setSalutation(null),e.setServiceProviderCode(null),e.setSocialSecurityNumber(null),e.setTitle(null),e.setTradeName(null);var t=aa.people.getPeopleByPeopleModel(e);if(!t.getSuccess())return logDebug("WARNING: error searching for people : "+t.getErrorMessage()),!1;var a=t.getOutput();return 0==a.length?(logDebug("Searched for REF contact, no matches found, returing null"),null):a.length>0?(logDebug("Searched for a REF Contact, "+a.length+" matches found! returning the first match : "+a[0].getContactSeqNumber()),a[0].getContactSeqNumber()):void 0}function comparePeopleStandard(e){if(e.getSocialSecurityNumber()||e.getFein()){var t=aa.people.createPeopleModel().getOutput().getPeopleModel();logDebug("we have a SSN "+e.getSocialSecurityNumber()+" or FEIN, checking on that"),t.setSocialSecurityNumber(e.getSocialSecurityNumber()),t.setFein(e.getFein());var a=aa.people.getPeopleByPeopleModel(t);if(!a.getSuccess())return logDebug("WARNING: error searching for people : "+a.getErrorMessage()),!1;var r=a.getOutput();if(r.length>0)return logDebug("Searched for a REF Contact, "+r.length+" matches found! returning the first match : "+r[0].getContactSeqNumber()),r[0].getContactSeqNumber()}if(e.getEmail()){var t=aa.people.createPeopleModel().getOutput().getPeopleModel();t.setServiceProviderCode(aa.getServiceProviderCode()),logDebug("we have an email, checking on that"),t.setEmail(e.getEmail());var a=aa.people.getPeopleByPeopleModel(t);if(!a.getSuccess())return logDebug("WARNING: error searching for people : "+a.getErrorMessage()),!1;var r=a.getOutput();if(r.length>0)return logDebug("Searched for a REF Contact, "+r.length+" matches found! returning the first match : "+r[0].getContactSeqNumber()),r[0].getContactSeqNumber()}if(e.getBirthDate()&&e.getLastName()&&e.getFirstName()){var t=aa.people.createPeopleModel().getOutput().getPeopleModel();logDebug("we have a name and birthdate, checking on that"),t.setBirthDate(e.getBirthDate()),t.setLastName(e.getLastName()),t.setFirstName(e.getFirstName()),t.setMiddleName(e.getMiddleName());var a=aa.people.getPeopleByPeopleModel(t);if(!a.getSuccess())return logDebug("WARNING: error searching for people : "+a.getErrorMessage()),!1;var r=a.getOutput();if(r.length>0)return logDebug("Searched for a REF Contact, "+r.length+" matches found! returning the first match : "+r[0].getContactSeqNumber()),r[0].getContactSeqNumber()}return logDebug("ComparePeople did not find a match"),!1}function completeCAP(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();return r?(cd=r.getCapDetailModel(),iNameResult=aa.person.getUser(e),iNameResult.getSuccess()?(iName=iNameResult.getOutput(),cd.setCompleteDept(iName.getDeptOfUser()),cd.setCompleteStaff(e),r.setCompleteDate(sysDate),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void(logDebug("Set CAP *Completed by Staff* to "+e)+"\nSet CAP *Completed by Dept* "+iName.getDeptOfUser()+"\nSet CAP *Completed Date* "+sysDate.toString()):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR retrieving  user model "+e+" : "+iNameResult.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function contactAddFromUser(e){if(1==arguments.length){var t=aa.person.getUser(e);if(!t.getSuccess())return logDebug("**ERROR: Failed to get User: "+t.getErrorMessage()),!1;var a=t.getOutput();if(null==a)return logDebug("**ERROR: Failed to get User"),!1}else var a=systemUserObj;var r=a.getFirstName(),s=a.getMiddleName(),n=a.getLastName(),i=aa.people.getPeopleByFMLName(r,s,n);if(!i.getSuccess())return logDebug("**ERROR: Failed to get reference contact record: "+i.getErrorMessage()),!1;var o=i.getOutput();if(null==o)return logDebug("No reference user found."),!1;logDebug("No. of reference contacts found: "+o.length);var g=aa.people.createCapContactWithRefPeopleModel(capId,o[0]);if(g.getSuccess()){logDebug("Contact successfully added to CAP.");var u=aa.people.getCapContactByCapID(capId);if(u.getSuccess()){var c=u.getOutput(),l=c.length,p=c[l-1].getCapContactModel().getPeople().getContactSeqNumber();return logDebug("Contact Nbr = "+p),p}return logDebug("**ERROR: Failed to get Contact Nbr: "+u.getErrorMessage()),!1}return logDebug("**ERROR: Cannot add contact: "+g.getErrorMessage()),!1}function contactObj(e){if(this.people=null,this.capContact=null,this.capContactScript=null,this.capId=null,this.type=null,this.seqNumber=null,this.refSeqNumber=null,this.asiObj=null,this.asi=new Array,this.primary=null,this.relation=null,this.addresses=null,this.validAttrs=!1,this.capContactScript=e,e){if(void 0==e.getCapContactModel)this.people=this.capContactScript.getPeople(),this.refSeqNumber=this.capContactScript.getRefContactNumber();else if(this.capContact=e.getCapContactModel(),this.people=this.capContact.getPeople(),this.refSeqNumber=this.capContact.getRefContactNumber(),null!=this.people.getAttributes()&&(this.asiObj=this.people.getAttributes().toArray(),null!=this.asiObj)){for(var t in this.asiObj)this.asi[this.asiObj[t].attributeName]=this.asiObj[t];this.validAttrs=!0}this.relation=this.people.relation,this.seqNumber=this.people.contactSeqNumber,this.type=this.people.getContactType(),this.capId=this.capContactScript.getCapID();var a=aa.address.getContactAddressListByCapContact(this.capContact);if(a.getSuccess()){this.addresses=a.getOutput();var r=convertContactAddressModelArr(a.getOutput());this.people.setContactAddressList(r)}else pmcal=this.people.getContactAddressList(),pmcal&&(this.addresses=pmcal.toArray())}this.toString=function(){return this.capId+" : "+this.type+" "+this.people.getLastName()+","+this.people.getFirstName()+" (id:"+this.seqNumber+"/"+this.refSeqNumber+") #ofAddr="+this.addresses.length+" primary="+this.primary},this.getEmailTemplateParams=function(e){return addParameter(e,"$$LastName$$",this.people.getLastName()),addParameter(e,"$$FirstName$$",this.people.getFirstName()),addParameter(e,"$$MiddleName$$",this.people.getMiddleName()),addParameter(e,"$$BusinesName$$",this.people.getBusinessName()),addParameter(e,"$$ContactSeqNumber$$",this.seqNumber),addParameter(e,"$$ContactType$$",this.type),addParameter(e,"$$Relation$$",this.relation),addParameter(e,"$$Phone1$$",this.people.getPhone1()),addParameter(e,"$$Phone2$$",this.people.getPhone2()),addParameter(e,"$$Email$$",this.people.getEmail()),addParameter(e,"$$AddressLine1$$",this.people.getCompactAddress().getAddressLine1()),addParameter(e,"$$AddressLine2$$",this.people.getCompactAddress().getAddressLine2()),addParameter(e,"$$City$$",this.people.getCompactAddress().getCity()),addParameter(e,"$$State$$",this.people.getCompactAddress().getState()),addParameter(e,"$$Zip$$",this.people.getCompactAddress().getZip()),addParameter(e,"$$Fax$$",this.people.getFax()),addParameter(e,"$$Country$$",this.people.getCompactAddress().getCountry()),addParameter(e,"$$FullName$$",this.people.getFullName()),e},this.replace=function(e){var t=this.type;2==arguments.length&&(t=arguments[1]);var a=getContactObjs(e,[String(t)]);for(var r in a){var s=a[r];if(this.equals(a[r]))return s.people.setContactType(t),aa.people.copyCapContactModel(this.capContact,s.capContact),s.people.setContactAddressList(this.people.getContactAddressList()),overwriteResult=aa.people.editCapContactWithAttribute(s.capContact),logDebug(overwriteResult.getSuccess()?"overwrite contact "+s+" with "+this:"error overwriting contact : "+this+" : "+overwriteResult.getErrorMessage()),!0}var n=this.capContact.getCapID(),i=this.type;return this.people.setContactType(t),this.capContact.setCapID(e),createResult=aa.people.createCapContactWithAttribute(this.capContact),logDebug(createResult.getSuccess()?"(contactObj) contact created : "+this:"(contactObj) error creating contact : "+this+" : "+createResult.getErrorMessage()),this.capContact.setCapID(n),this.type=i,!0},this.equals=function(e){return null==e?!1:String(this.people.type).equals(String(e.people.type))&&String(this.people.getFirstName()).equals(String(e.people.getFirstName()))&&String(this.people.getLastName()).equals(String(e.people.getLastName()))&&String(this.people.getFullName()).equals(String(e.people.getFullName()))&&String(this.people.getBusinessName()).equals(String(e.people.getBusinessName()))?!0:!1},this.saveBase=function(){this.people.setContactType(this.type),this.capContact.setPrimaryFlag(this.primary?"Y":"N"),this.people.setRelation(this.relation),saveResult=aa.people.editCapContact(this.capContact),logDebug(saveResult.getSuccess()?"(contactObj) base contact saved : "+this:"(contactObj) error saving base contact : "+this+" : "+saveResult.getErrorMessage())},this.save=function(){this.people.setContactType(this.type),this.capContact.setPrimaryFlag(this.primary?"Y":"N"),this.people.setRelation(this.relation),this.capContact.setPeople(this.people),saveResult=aa.people.editCapContactWithAttribute(this.capContact),logDebug(saveResult.getSuccess()?"(contactObj) contact saved : "+this:"(contactObj) error saving contact : "+this+" : "+saveResult.getErrorMessage())
},this.getAttribute=function(e){var t=null;if(this.validAttrs){var a=this.asi[e.toString().toUpperCase()];null!=a&&(t=a.getAttributeValue())}return t},this.setAttribute=function(e,t){var a=!1;if(this.validAttrs){var r=this.asi[e.toString().toUpperCase()];null!=r&&(r.setAttributeValue(t),a=!0)}return a},this.remove=function(){var e=aa.people.removeCapContact(this.capId,this.seqNumber);logDebug(e.getSuccess()?"(contactObj) contact removed : "+this+" from record "+this.capId.getCustomID():"(contactObj) error removing contact : "+this+" : from record "+this.capId.getCustomID()+" : "+e.getErrorMessage())},this.isSingleAddressPerType=function(){if(!(this.addresses.length>1))return!0;var e=new Array;for(y in this.addresses)thisAddr=this.addresses[y],e[thisAddr.addressType]=0;for(yy in this.addresses)thisAddr=this.addresses[yy],e[thisAddr.addressType]+=1;for(z in e)if(e[z]>1)return!1;return!0},this.getAddressTypeCounts=function(){var e=new Array;for(y in this.addresses)thisAddr=this.addresses[y],e[thisAddr.addressType]=0;for(yy in this.addresses)thisAddr=this.addresses[yy],e[thisAddr.addressType]+=1;return e},this.createPublicUser=function(){if(!this.capContact.getEmail())return logDebug("(contactObj) Couldn't create public user for : "+this+", no email address"),!1;if(String(this.people.getContactTypeFlag()).equals("organization"))return logDebug("(contactObj) Couldn't create public user for "+this+", the contact is an organization"),!1;var e=aa.publicUser.getPublicUserByEmail(this.capContact.getEmail());if(e.getSuccess()&&e.getOutput()&&(s=e.getOutput(),logDebug("(contactObj) createPublicUserFromContact: Found an existing public user: "+s.getUserID())),!s){logDebug("(contactObj) CreatePublicUserFromContact: creating new user based on email address: "+this.capContact.getEmail());var t=aa.publicUser.getPublicUserModel();t.setFirstName(this.capContact.getFirstName()),t.setLastName(this.capContact.getLastName()),t.setEmail(this.capContact.getEmail()),t.setUserID(this.capContact.getEmail()),t.setPassword("e8248cbe79a288ffec75d7300ad2e07172f487f6"),t.setAuditID("PublicUser"),t.setAuditStatus("A"),t.setCellPhone(this.people.getPhone2());var a=aa.publicUser.createPublicUser(t);if(!a.getSuccess())return logDebug("(contactObj) **WARNIJNG creating public user "+this.capContact.getEmail()+"  failure: "+a.getErrorMessage()),null;logDebug("(contactObj) Created public user "+this.capContact.getEmail()+"  sucessfully.");var r=a.getOutput(),s=aa.publicUser.getPublicUser(r).getOutput();aa.publicUser.createPublicUserForAgency(s);var n=aa.proxyInvoker.newInstance("com.accela.pa.pin.UserPINBusiness").getOutput();n.updateActiveStatusAndLicenseIssueDate4PublicUser(aa.getServiceProviderCode(),r,"ADMIN");var i=aa.publicUser.resetPassword(this.capContact.getEmail());if(i.getSuccess()){var o=i.getOutput();s.setPassword(o),logDebug("(contactObj) Reset password for "+this.capContact.getEmail()+"  sucessfully.")}else logDebug("(contactObj **WARNING: Reset password for  "+this.capContact.getEmail()+"  failure:"+i.getErrorMessage());aa.publicUser.sendActivateEmail(s,!0,!0),aa.publicUser.sendPasswordEmail(s)}return this.refSeqNumber&&(logDebug("(contactObj) CreatePublicUserFromContact: Linking this public user with reference contact : "+this.refSeqNumber),aa.licenseScript.associateContactWithPublicUser(s.getUserSeqNum(),this.refSeqNumber)),s},this.getCaps=function(){if(this.refSeqNumber){aa.print("ref seq : "+this.refSeqNumber);var e=null,t=new Array;1==arguments.length&&(e=arguments[0]);var a=aa.people.createPeopleModel().getOutput().getPeopleModel(),r=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.CapContactDAOOracle").getOutput();a.setServiceProviderCode(aa.getServiceProviderCode()),a.setContactSeqNumber(this.refSeqNumber);var s=r.getCapContactsByRefContactModel(a).toArray();for(var n in s){var i=aa.cap.getCapID(s[n].getCapID().getID1(),s[n].getCapID().getID2(),s[n].getCapID().getID3()).getOutput();e&&appMatch(e,i)&&t.push(i)}}return t},this.getRelatedContactObjs=function(){if(this.refSeqNumber){var e=null,t=new Array;1==arguments.length&&(e=arguments[0]);var a=aa.people.createPeopleModel().getOutput().getPeopleModel(),r=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.CapContactDAOOracle").getOutput();a.setServiceProviderCode(aa.getServiceProviderCode()),a.setContactSeqNumber(this.refSeqNumber);var s=r.getCapContactsByRefContactModel(a).toArray();for(var n in s){var i=aa.cap.getCapID(s[n].getCapID().getID1(),s[n].getCapID().getID2(),s[n].getCapID().getID3()).getOutput();if(e&&appMatch(e,i)){var o=aa.people.getCapContactByPK(i,s[n].getPeople().contactSeqNumber).getOutput(),g=new contactObj(o);t.push(g)}}}return t},this.createRefLicProf=function(e,t,a,r){var s=!1,n=aa.getServiceProviderCode();5==arguments.length&&(n=arguments[4],aa.setDelegateAgencyCode(n));var i=getRefLicenseProf(e);if(i)s=!0,logDebug("(contactObj) Updating existing Ref Lic Prof : "+e);else var i=aa.licenseScript.createLicenseScriptModel();peop=this.people,cont=this.capContact,null!=cont.getFirstName()&&i.setContactFirstName(cont.getFirstName()),null!=peop.getMiddleName()&&i.setContactMiddleName(peop.getMiddleName()),null!=cont.getLastName()&&i.setContactLastName(null!=peop.getNamesuffix()?cont.getLastName()+" "+peop.getNamesuffix():cont.getLastName()),null!=peop.getBusinessName()&&i.setBusinessName(peop.getBusinessName()),null!=peop.getPhone1()&&i.setPhone1(peop.getPhone1()),null!=peop.getPhone2()&&i.setPhone2(peop.getPhone2()),null!=peop.getEmail()&&i.setEMailAddress(peop.getEmail()),null!=peop.getFax()&&i.setFax(peop.getFax()),i.setAgencyCode(n),i.setAuditDate(sysDate),i.setAuditID(currentUserID),i.setAuditStatus("A"),i.setLicenseType(t),i.setStateLicense(e),i.setLicState(r);var o=lookup("CONTACT_ACROSS_AGENCIES",servProvCode);i.setLicenseBoard(matches(o,void 0,null,"")?"":o);var g=null;if(a)for(var u in this.addresses)cAddr=this.addresses[u],a.equals(cAddr.getAddressType())&&(g=cAddr);return g||(g=peop.getCompactAddress()),null!=g.getAddressLine1()&&i.setAddress1(g.getAddressLine1()),null!=g.getAddressLine2()&&i.setAddress2(g.getAddressLine2()),null!=g.getAddressLine3()&&i.getLicenseModel().setTitle(g.getAddressLine3()),null!=g.getCity()&&i.setCity(g.getCity()),null!=g.getState()&&i.setState(g.getState()),null!=g.getZip()&&i.setZip(g.getZip()),null!=g.getCountryCode()&&i.getLicenseModel().setCountryCode(g.getCountryCode()),myResult=s?aa.licenseScript.editRefLicenseProf(i):aa.licenseScript.createRefLicenseProf(i),5==arguments.length&&aa.resetDelegateAgencyCode(),myResult.getSuccess()?(logDebug("Successfully added/updated License No. "+e+", Type: "+t+" From Contact "+this),!0):(logDebug("**WARNING: can't create ref lic prof: "+myResult.getErrorMessage()),!1)},this.getAKA=function(){var e=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.PeopleAKABusiness").getOutput();return this.refSeqNumber?e.getPeopleAKAListByContactNbr(aa.getServiceProviderCode(),String(this.refSeqNumber)).toArray():(logDebug("contactObj: Cannot get AKA names for a non-reference contact"),!1)},this.addAKA=function(e,t,a,r,s,n){if(!this.refSeqNumber)return logDebug("contactObj: Cannot add AKA name for non-reference contact"),!1;var i=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.PeopleAKABusiness").getOutput(),o=new Array,g=aa.proxyInvoker.newInstance("com.accela.orm.model.contact.PeopleAKAModel",o).getOutput(),u=aa.proxyInvoker.newInstance("com.accela.orm.model.common.AuditModel",o).getOutput(),c=i.getPeopleAKAListByContactNbr(aa.getServiceProviderCode(),String(this.refSeqNumber));g.setServiceProviderCode(aa.getServiceProviderCode()),g.setContactNumber(parseInt(this.refSeqNumber)),g.setFirstName(e),g.setMiddleName(t),g.setLastName(a),g.setFullName(r),g.setStartDate(s),g.setEndDate(n),u.setAuditDate(new Date),u.setAuditStatus("A"),u.setAuditID("ADMIN"),g.setAuditModel(u),c.add(g),i.saveModels(aa.getServiceProviderCode(),this.refSeqNumber,c)},this.removeAKA=function(e,t,a){if(!this.refSeqNumber)return logDebug("contactObj: Cannot remove AKA name for non-reference contact"),!1;for(var r=!1,s=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.PeopleAKABusiness").getOutput(),n=s.getPeopleAKAListByContactNbr(aa.getServiceProviderCode(),String(this.refSeqNumber)),i=n.iterator();i.hasNext();){var o=i.next();o.getFirstName()&&!o.getFirstName().equals(e)||o.getMiddleName()&&!o.getMiddleName().equals(t)||o.getLastName()&&!o.getLastName().equals(a)||(i.remove(),logDebug("contactObj: removed AKA Name : "+e+" "+t+" "+a),r=!0)}r&&s.saveModels(aa.getServiceProviderCode(),this.refSeqNumber,n)},this.hasPublicUser=function(){if(null==this.refSeqNumber)return!1;var e=aa.publicUser.getPublicUserListByContactNBR(aa.util.parseLong(this.refSeqNumber));if(e.getSuccess()){var t=e.getOutput();return null==t||0==t.size()?(logDebug("The contact("+this.refSeqNumber+") is not associated with any public user."),!1):(logDebug("The contact("+this.refSeqNumber+") is associated with "+t.size()+" public users."),!0)}return logMessage("**ERROR: Failed to get public user by contact number: "+e.getErrorMessage()),!1},this.linkToPublicUser=function(e){if(null==e)return logDebug("No public user id provided"),!1;var t=e.replace("PUBLICUSER",""),a=aa.publicUser.getPublicUser(aa.util.parseLong(t));if(!a.getSuccess())return logDebug("Could not find a public user with the seq number: "+t),!1;var r=aa.licenseScript.associateContactWithPublicUser(t,this.refSeqNumber);return r.getSuccess()?void logDebug("Successfully linked public user "+t+" to contact "+this.refSeqNumber):(logDebug("Failed to link contact to public user"),!1)},this.sendCreateAndLinkNotification=function(){var e=this.people.getEmail();if(e){var t=aa.util.newHashtable();getACARecordParam4Notification(t,acaUrl),addParameter(t,"$$licenseType$$",cap.getCapType().getAlias()),addParameter(t,"$$altID$$",capIDString);var a;if(a="individual"==this.people.getContactTypeFlag()?this.people.getFirstName()+" "+this.people.getLastName():this.people.getBusinessName(),a&&addParameter(t,"$$notificationName$$",a),this.refSeqNumber){var r=new verhoeff,s=r.compute(String(this.refSeqNumber));addParameter(t,"$$pinCode$$",s),sendNotification(sysFromEmail,e,"","PUBLICUSER CREATE AND LINK",t,null)}}},this.getRelatedRefContacts=function(){var e;arguments.length>0&&(e=arguments[0]);var t=new Array;if(matches(this.refSeqNumber,null,void 0,""))return t;var a=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.XRefContactEntityBusiness").getOutput();if(xRefContactEntityModel=aa.people.getXRefContactEntityModel().getOutput(),xRefContactEntityModel.setContactSeqNumber(parseInt(this.refSeqNumber)),x=a.getXRefContactEntityList(xRefContactEntityModel),x.size()>0){var r=x.toArray();for(var s in r){var n=r[s],i=!0;if(e&&(i=exists(n.getEntityID4(),e)),i){var o=aa.people.getPeople(n.getEntityID1());if(o.getSuccess()){var g=o.getOutput();t.push(g)}}}}var a=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.XRefContactEntityBusiness").getOutput();if(xRefContactEntityModel=aa.people.getXRefContactEntityModel().getOutput(),xRefContactEntityModel.setEntityID1(parseInt(this.refSeqNumber)),x=a.getXRefContactEntityList(xRefContactEntityModel),x.size()>0){var r=x.toArray();for(var s in r){var n=r[s],i=!0;if(e&&(i=exists(n.getEntityID4(),e)),i){var o=aa.people.getPeople(n.getContactSeqNumber());if(o.getSuccess()){var g=o.getOutput();t.push(g)}}}}return t}}function contactSetPrimary(e){if(null==e)return logDebug("**ERROR: ContactNbr parameter is null"),!1;var t=aa.people.getCapContactByPK(capId,e);if(t.getSuccess()){var a=t.getOutput(),r=a.getCapContactModel().getPeople();r.setFlag("Y"),a.getCapContactModel().setPeople(r);var s=aa.people.editCapContact(a.getCapContactModel());return s.getSuccess()?(logDebug("Contact successfully set to Primary"),!0):(logDebug("**ERROR: Could not set contact to Primary: "+s.getErrorMessage()),!1)}return logDebug("**ERROR: Can't get contact: "+t.getErrorMessage()),!1}function contactSetRelation(e,t){if(null==e)return logDebug("ContactNbr parameter is null"),!1;var a=aa.people.getCapContactByPK(capId,e);if(a.getSuccess()){var r=a.getOutput(),s=r.getCapContactModel().getPeople();s.setRelation(t),r.getCapContactModel().setPeople(s);var n=aa.people.editCapContact(r.getCapContactModel());return n.getSuccess()?(logDebug("Contact relationship successfully changed to "+t),!0):(logDebug("**ERROR: Could not change contact relationship: "+n.getErrorMessage()),!1)}return logDebug("**ERROR: Can't get contact: "+a.getErrorMessage()),!1}function convertContactAddressModelArr(e){var t=null;if(null!=e&&e.length>0){t=aa.util.newArrayList();for(loopk in e)t.add(e[loopk].getContactAddressModel())}return t}function convertDate(e){if("string"==typeof e){var t=new Date(String(e));if(!t.toString().equals("Invalid Date"))return t}if("object"==typeof e){if(!e.getClass)return e;if(e.getClass().toString().equals("class com.accela.aa.emse.dom.ScriptDateTime"))return new Date(e.getMonth()+"/"+e.getDayOfMonth()+"/"+e.getYear());if(e.getClass().toString().equals("class com.accela.aa.emse.util.ScriptDateTime"))return new Date(e.getMonth()+"/"+e.getDayOfMonth()+"/"+e.getYear());if(e.getClass().toString().equals("class java.util.Date"))return new Date(e.getTime());if(e.getClass().toString().equals("class java.lang.String"))return new Date(String(e))}return"number"==typeof e?new Date(e):(logDebug("**WARNING** convertDate cannot parse date : "+e),null)}function convertStringToPhone(e){for(var t="22233344455566677778889999",a=String(e.toUpperCase()),r="",s=0;s<a.length;s++)r+=a[s]>="A"&&a[s]<="Z"?t[a.charCodeAt(s)-65]:a[s];return r}function copyAddresses(e,t){if(null==t)var a=capId;else var a=t;var r=!1,s=aa.address.getAddressByCapId(a);if(!s.getSuccess())return logMessage("**ERROR: Failed to get addresses: "+s.getErrorMessage()),!1;Address=s.getOutput();for(yy in Address)if("Y"==Address[yy].getPrimaryFlag()){r=!0,logDebug("Target CAP has primary address");break}var s=aa.address.getAddressWithAttributeByCapId(e),n=0;if(!s.getSuccess())return logMessage("**ERROR: Failed to get addresses: "+s.getErrorMessage()),!1;Address=s.getOutput();for(yy in Address)newAddress=Address[yy],newAddress.setCapID(a),r&&newAddress.setPrimaryFlag("N"),aa.address.createAddressWithAPOAttribute(a,newAddress),logDebug("Copied address from "+e.getCustomID()+" to "+a.getCustomID()),n++;return n}function copyAppSpecific(e){var t=new Array,a=!1;arguments.length>1&&(t=arguments[1],a=!0);for(asi in AInfo){if(a){for(var r=!1,s=0;s<t.length;s++)if(t[s]==asi){r=!0;break}if(r)continue}editAppSpecific(asi,AInfo[asi],e)}}function copyAppSpecific4ACA(e){for(var t=e.getAppSpecificInfoGroups().iterator();t.hasNext();){var a=t.next(),r=a.getFields();if(null!=r)for(var s=r.iterator();s.hasNext();){var n=s.next();useAppSpecificGroupName?editAppSpecific4ACA(n.getCheckboxType()+"."+n.getCheckboxDesc(),n.getChecklistComment()):editAppSpecific4ACA(n.getCheckboxDesc(),n.getChecklistComment())}}}function copyASIFields(e,t){for(var a=new Array,r=2;r<arguments.length;r++)a.push(arguments[r]);var s=aa.cap.getCap(t).getOutput(),n=s.getCapType(),i=n.toString(),o=i.split("/"),g=aa.appSpecificInfo.getByCapID(e);if(!g.getSuccess())return aa.print("**ERROR: getting source ASI: "+g.getErrorMessage()),!1;var u=g.getOutput();for(ASICount in u)thisASI=u[ASICount],exists(thisASI.getCheckboxType(),a)||(thisASI.setPermitID1(t.getID1()),thisASI.setPermitID2(t.getID2()),thisASI.setPermitID3(t.getID3()),thisASI.setPerType(o[1]),thisASI.setPerSubType(o[2]),aa.cap.createCheckbox(thisASI))}function copyASITables(e,t){var a=e,r=aa.appSpecificTableScript.getAppSpecificTableGroupModel(a).getOutput(),s=r.getTablesArray(),n=s.iterator(),i=(new Array,new Array),o=!1;for(arguments.length>2&&(i=arguments[2],o=!0);n.hasNext();){var g=n.next(),u=new Array,c=new Array,l=g.getTableName()+"",p=0;if(o){for(var d=!1,f=0;f<i.length;f++)if(i[f]==l){d=!0;break}if(d)continue}if(!g.rowIndex.isEmpty()){for(var m=g.getTableField().iterator(),C=g.getColumns().iterator(),b=g.getAppSpecificTableModel().getReadonlyField().iterator(),p=1;m.hasNext();){if(!C.hasNext()){var C=g.getColumns().iterator();c.push(u);var u=new Array;p++}var D=C.next(),A=m.next(),v="N";b.hasNext()&&(v=b.next());var y=new asiTableValObj(D.getColumnName(),A,v);u[D.getColumnName()]=y}c.push(u)}addASITable(l,c,t),logDebug("ASI Table Array : "+l+" ("+p+" Rows)")}}function copyCalcVal(e,t){if(!t)return logMessage("**WARNING: copyCalcVal was passed a null new cap ID"),!1;var a=aa.finance.getCalculatedValuation(e,null);if(!a.getSuccess())return logMessage("**ERROR: Failed to get calc val array: "+a.getErrorMessage()),!1;var r=a.getOutput();for(thisCV in r){var s=r[thisCV];if(s.setCapID(t),createResult=aa.finance.createBCalcValuatn(s),!createResult.getSuccess())return logMessage("**ERROR: Creating new calc valuatn on target cap ID: "+createResult.getErrorMessage()),!1}}function copyConditions(e){var t=capId;2==arguments.length&&(t=arguments[1]);var a=aa.capCondition.getCapConditions(e);if(!a.getSuccess())return logDebug("**ERROR: getting cap conditions: "+a.getErrorMessage()),!1;var r=a.getOutput();for(cc in r){var s=r[cc],n=aa.capCondition.addCapCondition(t,s.getConditionType(),s.getConditionDescription(),s.getConditionComment(),s.getEffectDate(),s.getExpireDate(),sysDate,s.getRefNumber1(),s.getRefNumber2(),s.getImpactCode(),s.getIssuedByUser(),s.getStatusByUser(),s.getConditionStatus(),currentUserID,String("A"),null,s.getDisplayConditionNotice(),s.getIncludeInConditionName(),s.getIncludeInShortDescription(),s.getInheritable(),s.getLongDescripton(),s.getPublicDisplayMessage(),s.getResolutionAction(),null,null,s.getReferenceConditionNumber(),s.getConditionGroup(),s.getDisplayNoticeOnACA(),s.getDisplayNoticeOnACAFee(),s.getPriority(),s.getConditionOfApproval());logDebug(n.getSuccess()?"Successfully added condition ("+s.getImpactCode()+") "+s.getConditionDescription():"**ERROR: adding condition ("+cImpact+"): "+n.getErrorMessage())}}function copyConditionsFromParcel(e){var t=aa.parcelCondition.getParcelConditions(e);if(!t.getSuccess())return logDebug("**WARNING: getting parcel conditions: "+t.getErrorMessage()),!1;var a=t.getOutput();for(cc in a){var r=a[cc];if(appHasCondition(r.getConditionType(),null,r.getConditionDescription(),r.getImpactCode()))logDebug("**WARNING: adding condition ("+r.getImpactCode()+"): condition already exists");else{var s=aa.capCondition.addCapCondition(capId,r.getConditionType(),r.getConditionDescription(),r.getConditionComment(),r.getEffectDate(),r.getExpireDate(),sysDate,r.getRefNumber1(),r.getRefNumber2(),r.getImpactCode(),r.getIssuedByUser(),r.getStatusByUser(),r.getConditionStatus(),currentUserID,"A");logDebug(s.getSuccess()?"Successfully added condition ("+r.getImpactCode()+") "+r.getConditionDescription():"**ERROR: adding condition ("+r.getImpactCode()+"): "+s.getErrorMessage())}}}function copyContacts(e,t){if(null==t)var a=capId;else var a=t;var r=aa.people.getCapContactByCapID(e),s=0;if(!r.getSuccess())return logMessage("**ERROR: Failed to get contacts: "+r.getErrorMessage()),!1;var n=r.getOutput();for(yy in n){var i=n[yy].getCapContactModel(),o=aa.address.getContactAddressListByCapContact(i);if(o.getSuccess()){var g=convertContactAddressModelArr(o.getOutput());i.getPeople().setContactAddressList(g)}i.setCapID(a),aa.people.createCapContactWithAttribute(i),s++,logDebug("Copied contact from "+e.getCustomID()+" to "+a.getCustomID())}return s}function convertContactAddressModelArr(e){var t=null;if(null!=e&&e.length>0){t=aa.util.newArrayList();for(loopk in e)t.add(e[loopk].getContactAddressModel())}return t}function copyContactsByType(e,t,a){if(null==t)var r=capId;else var r=t;var s=aa.people.getCapContactByCapID(e),n=0;if(!s.getSuccess())return logMessage("**ERROR: Failed to get contacts: "+s.getErrorMessage()),!1;var i=s.getOutput();for(yy in i)if(i[yy].getCapContactModel().getContactType()==a){var o=i[yy].getCapContactModel();o.setCapID(r),aa.people.createCapContact(o),n++,logDebug("Copied contact from "+e.getCustomID()+" to "+r.getCustomID())}return n}function copyEducation(e,t){null!=e&&null!=t&&aa.education.copyEducationList(e,t)}function copyFees(e,t){var a=new Array,r=(new Array,new Array,loadFees(e));for(x in r){if(thisFee=r[x],logMessage("We have a fee "+thisFee.code+" status : "+thisFee.status),"INVOICED"==thisFee.status){addFee(thisFee.code,thisFee.sched,thisFee.period,thisFee.unit,"Y",t);var a=new Array,s=new Array;a.push(thisFee.sequence),s.push(thisFee.period);var n=aa.finance.createInvoice(e,a,s);n.getSuccess()||aa.print("**ERROR: Invoicing the fee items voided "+thisFee.code+" was not successful.  Reason: "+n.getErrorMessage())}"NEW"==thisFee.status&&addFee(thisFee.code,thisFee.sched,thisFee.period,thisFee.unit,"N",t)}}function copyLicensedProf(e,t){var a=aa.licenseProfessional.getLicensedProfessionalsByCapID(e).getOutput();if(null!=a)for(x in a)a[x].setCapID(t),aa.licenseProfessional.createLicensedProfessional(a[x]),logDebug("Copied "+a[x].getLicenseNbr());else logDebug("No licensed professional on source")}function copyOwner(e,t){var a=aa.owner.getOwnerByCapId(e);if(a.getSuccess()){var r=a.getOutput();for(xx in r)r[xx].setCapID(t),aa.owner.createCapOwnerWithAPOAttribute(r[xx]),logDebug("Copied Owner: "+r[xx].getOwnerFullName())}else logDebug("Error Copying Owner : "+r.getErrorType()+" : "+r.getErrorMessage())}function GetOwnersByParcel(){var e=aa.parcel.getParcelDailyByCapID(capId,null);if(e.getSuccess())if(e=e.getOutput(),null==e||0==e.length)aa.print("There is no any parcel for the cap.");else for(var t=0;t<e.length;t++){{var a=aa.owner.getOwnersByParcel(e[t]);e[t].getParcelNumber(),e[t].getParcelModel().getUID()}if(a.getSuccess()){var r=a.getOutput();for(j=0;j<r.length;j++)r[j].setCapID(capId),aa.owner.createCapOwnerWithAPOAttribute(r[j])}else aa.print("ERROR: Failed to get owner(s) by Parcel(s): "+a.getErrorMessage())}}function copyParcelGisObjects(){var e=aa.parcel.getParcelandAttribute(capId,null);if(!e.getSuccess())return logDebug("**ERROR: Getting Parcels from Cap.  Reason is: "+e.getErrorType()+":"+e.getErrorMessage()),!1;var t=e.getOutput().toArray();for(zz in t){var a=t[zz].getParcelNumber();logDebug("Looking at parcel "+a);var r=aa.gis.getParcelGISObjects(a);if(!r.getSuccess())return logDebug("**WARNING: Getting GIS objects for Parcel.  Reason is: "+r.getErrorType()+":"+r.getErrorMessage()),!1;var s=r.getOutput();for(a1 in s){var n=s[a1],i=n.getGISObjects();for(b1 in i){var o=i[b1],g=o.getGisObjectModel(),u=aa.gis.addCapGISObject(capId,g.getServiceID(),g.getLayerId(),g.getGisId());if(!u.getSuccess())return logDebug("**WARNING: Could not add Cap GIS Object.  Reason is: "+u.getErrorType()+":"+u.getErrorMessage()),!1;logDebug("Successfully added Cap GIS object: "+g.getGisId())}}}}function copyParcels(e,t){if(null==t)var a=capId;else var a=t;var r=aa.parcel.getParcelandAttribute(e,null),s=0;if(!r.getSuccess())return logMessage("**ERROR: Failed to get parcels: "+r.getErrorMessage()),!1;var n=r.getOutput().toArray();for(zz in n){var i=aa.parcel.getCapParcelModel().getOutput();i.setParcelModel(n[zz]),i.setCapIDModel(a),i.setL1ParcelNo(n[zz].getParcelNumber()),i.setParcelNo(n[zz].getParcelNumber()),aa.parcel.createCapParcel(i),logDebug("Copied parcel "+n[zz].getParcelNumber()+" from "+e.getCustomID()+" to "+a.getCustomID()),s++}return s}function copySchedInspections(e,t){if(null==t)var a=capId;else var a=t;var r=aa.inspection.getInspections(e);if(!r.getSuccess())return logMessage("**ERROR: Failed to get inspections: "+r.getErrorMessage()),!1;var s,n,i,o,g,u,c=0,l=r.getOutput();for(xx in l)"Insp Scheduled"==l[xx].getDocumentDescription()&&(n=l[xx].getInspector(),i=l[xx].getScheduledDate(),o=l[xx].getScheduledTime(),g=l[xx].getInspectionType(),u=l[xx].getInspectionComments(),s=aa.inspection.scheduleInspection(a,n,i,o,g,u),s.getSuccess()?(logDebug("Copied scheduled inspection from "+e.getCustomID()+" to "+a.getCustomID()),c++):logDebug("**ERROR: copying scheduling inspection ("+g+"): "+s.getErrorMessage()));return c}function countActiveTasks(e){var t=0,a=aa.workflow.getTaskCount(capId,e,"Y");return a.getSuccess()?t=a.getOutput().intValue():(logMessage("**ERROR: Failed to get task count: "+s_capResult.getErrorMessage()),!1)}function countIdenticalInspections(){var e=0,t="01/01/1900";arguments.length>0&&(t=arguments[0]),oldDate=new Date("oldDateStr");var a=!1,r=aa.inspection.getInspections(capId);if(r.getSuccess()){inspList=r.getOutput();for(xx in inspList)String(inspType).equals(inspList[xx].getInspectionType())&&String(inspResult).equals(inspList[xx].getInspectionStatus())&&(convertDate(inspList[xx].getInspectionStatusDate())<oldDate?a||(e++,a=!0):e++)}return logDebug("countIdenticalInspections("+inspType+","+inspResult+", "+t+") Returns "+e),e}function createCap(e,t){var a=e.split("/");if(4!=a.length)return logDebug("**ERROR in createCap.  The following Application Type String is incorrectly formatted: "+e),"INVALID PARAMETER";var r=aa.cap.createApp(a[0],a[1],a[2],a[3],t);if(logDebug("Creating cap "+e),!r.getSuccess())return logDebug("**ERROR: creating CAP "+r.getErrorMessage()),!1;var s=r.getOutput();logDebug("CAP of type "+e+" created successfully ");aa.cap.getCap(s).getOutput();return s}function createCapComment(e){var t=capId,a="N";arguments.length>=2&&"undefined"!=typeof arguments[1]&&null!=arguments[1]&&""!=arguments[1]&&(t=arguments[1]),arguments.length>=3&&"undefined"!=typeof arguments[2]&&null!=arguments[2]&&""!=arguments[2]&&(a=arguments[2]);var r=aa.date.getCurrentDate(),s=aa.cap.createCapCommentScriptModel();s.setCapIDModel(t),s.setCommentType("APP LEVEL COMMENT"),s.setSynopsis(""),s.setText(e),s.setAuditUser(currentUserID),s.setAuditStatus("A"),s.setAuditDate(r);var n=s.getCapCommentModel();n.setDisplayOnInsp(a),aa.cap.createCapComment(n),logDebug("Comment Added")}function createChild(e,t,a,r,s){var n=capId;arguments.length>5&&(n=arguments[5]);var i=aa.cap.createApp(e,t,a,r,s);if(logDebug("creating cap "+e+"/"+t+"/"+a+"/"+r),i.getSuccess()){var o=i.getOutput();logDebug("cap "+e+"/"+t+"/"+a+"/"+r+" created successfully "),capModel=aa.cap.newCapScriptModel().getOutput(),capDetailModel=capModel.getCapModel().getCapDetailModel(),capDetailModel.setCapID(o),aa.cap.createCapDetail(capDetailModel);var g=(aa.cap.getCap(o).getOutput(),aa.cap.createAppHierarchy(n,o));logDebug(g.getSuccess()?"Child application successfully linked":"Could not link applications");var u=aa.parcel.getParcelandAttribute(n,null);if(u.getSuccess()){var c=u.getOutput().toArray();for(zz in c){logDebug("adding parcel #"+zz+" = "+c[zz].getParcelNumber());var l=aa.parcel.getCapParcelModel().getOutput();l.setParcelModel(c[zz]),l.setCapIDModel(o),l.setL1ParcelNo(c[zz].getParcelNumber()),l.setParcelNo(c[zz].getParcelNumber()),aa.parcel.createCapParcel(l)}}if(capContactResult=aa.people.getCapContactByCapID(n),capContactResult.getSuccess()){Contacts=capContactResult.getOutput();for(yy in Contacts){var p=Contacts[yy].getCapContactModel();p.setCapID(o),aa.people.createCapContact(p),logDebug("added contact")}}if(capAddressResult=aa.address.getAddressByCapId(n),capAddressResult.getSuccess()){Address=capAddressResult.getOutput();for(yy in Address)newAddress=Address[yy],newAddress.setCapID(o),aa.address.createAddress(newAddress),logDebug("added address")}return o}logDebug("**ERROR: adding child App: "+i.getErrorMessage())}function createLicense(e,t){{var a=null,r=null;appTypeArray[2]}return a=createParent(appTypeArray[0],appTypeArray[1],appTypeArray[2],"License",null),editScheduledDate(sysDateMMDDYYYY,a),editFirstIssuedDate(sysDateMMDDYYYY,a),r=a.getCustomID(),updateAppStatus(e,"",a),t&&copyAppSpecific(a),a}function createParent(e,t,a,r,s){var n=aa.cap.createApp(e,t,a,r,s);if(logDebug("creating cap "+e+"/"+t+"/"+a+"/"+r),n.getSuccess()){var i=n.getOutput();logDebug("cap "+e+"/"+t+"/"+a+"/"+r+" created successfully "),capModel=aa.cap.newCapScriptModel().getOutput(),capDetailModel=capModel.getCapModel().getCapDetailModel(),capDetailModel.setCapID(i),aa.cap.createCapDetail(capDetailModel);var o=(aa.cap.getCap(i).getOutput(),aa.cap.createAppHierarchy(i,capId));logDebug(o.getSuccess()?"Parent application successfully linked":"Could not link applications");var g=aa.parcel.getParcelandAttribute(capId,null);if(g.getSuccess()){var u=g.getOutput().toArray();for(zz in u){logDebug("adding parcel #"+zz+" = "+u[zz].getParcelNumber());var c=aa.parcel.getCapParcelModel().getOutput();c.setParcelModel(u[zz]),c.setCapIDModel(i),c.setL1ParcelNo(u[zz].getParcelNumber()),c.setParcelNo(u[zz].getParcelNumber()),aa.parcel.createCapParcel(c)}}if(copyContacts(capId,i),capAddressResult=aa.address.getAddressByCapId(capId),capAddressResult.getSuccess()){Address=capAddressResult.getOutput();for(yy in Address)newAddress=Address[yy],newAddress.setCapID(i),aa.address.createAddress(newAddress),logDebug("added address")}return i}logDebug("**ERROR: adding parent App: "+n.getErrorMessage())}function createPendingInspection(e,t){var a=capId;3==arguments.length&&(a=arguments[2]);var r=aa.inspection.getInspectionType(e,t);if(!r.getSuccess())return logDebug("**WARNING error retrieving inspection types: "+r.getErrorMessage),!1;var s=r.getOutput();if(!s)return logDebug("**WARNING could not find any matches for inspection group "+e+" and type "+t),!1;var n=null;for(thisItm in s){var i=s[thisItm];i.getGroupCode().toUpperCase().equals(e.toUpperCase())&&i.getType().toUpperCase().equals(t.toUpperCase())&&(n=i.getSequenceNumber())}if(!n)return logDebug("**WARNING could not find an exact match for inspection group "+e+" and type "+t),!1;var o=aa.inspection.getInspectionScriptModel().getOutput().getInspection(),g=o.getActivity();return g.setInspSequenceNumber(n),g.setCapIDModel(a),pendingResult=aa.inspection.pendingInspection(o),pendingResult.getSuccess()?(logDebug("Successfully created pending inspection group "+e+" and type "+t),!0):(logDebug("**WARNING could not create pending inspection group "+e+" and type "+t+" Message: "+pendingResult.getErrorMessage()),!1)}function createPendingInspFromReqd(){var e=capId;1==arguments.length&&(e=arguments[0]);var t=aa.inspection.getInspectionListForSchedule(e.getID1(),e.getID2(),e.getID3());if(!t.getSuccess())return logDebug("**WARNING error retrieving inspections: "+t.getErrorMessage()),!1;var a=t.getOutput();for(var r in a){var s=a[r];s.getRequiredInspection().equals("Y")&&createPendingInspection(s.getGroupCode(),s.getType(),e)}}function createPublicUserFromContact(){var e,t,a,r="Applicant";arguments.length>0&&(r=arguments[0]);var s=aa.people.getCapContactByCapID(capId);if(s.getSuccess()){var n=s.getOutput();for(yy in n)r.equals(n[yy].getCapContactModel().getPeople().getContactType())&&(e=n[yy])}if(!e)return logDebug("Couldn't create public user for "+r+", no such contact"),!1;if(!e.getEmail())return logDebug("Couldn't create public user for "+r+", no email address"),!1;if(e.getPeople().getContactTypeFlag().equals("organization"))return logDebug("Couldn't create public user for "+r+", the contact is an organization"),!1;t=e.getCapContactModel().getRefContactNumber();var i=aa.publicUser.getPublicUserByEmail(e.getEmail());if(i.getSuccess()&&i.getOutput()&&(a=i.getOutput(),logDebug("CreatePublicUserFromContact: Found an existing public user: "+a.getUserID())),!a){logDebug("CreatePublicUserFromContact: creating new user based on email address: "+e.getEmail());var o=aa.publicUser.getPublicUserModel();o.setFirstName(e.getFirstName()),o.setLastName(e.getLastName()),o.setEmail(e.getEmail()),o.setUserID(e.getEmail()),o.setPassword("e8248cbe79a288ffec75d7300ad2e07172f487f6"),o.setAuditID("PublicUser"),o.setAuditStatus("A"),o.setCellPhone(e.getCapContactModel().getPeople().getPhone2());var g=aa.publicUser.createPublicUser(o);if(!g.getSuccess())return logDebug("**Warning creating public user "+e.getEmail()+"  failure: "+g.getErrorMessage()),null;logDebug("Created public user "+e.getEmail()+"  sucessfully.");var u=g.getOutput(),a=aa.publicUser.getPublicUser(u).getOutput();aa.publicUser.createPublicUserForAgency(a);
var c=aa.proxyInvoker.newInstance("com.accela.pa.pin.UserPINBusiness").getOutput();c.updateActiveStatusAndLicenseIssueDate4PublicUser(servProvCode,u,"ADMIN");var l=aa.publicUser.resetPassword(e.getEmail());if(l.getSuccess()){var p=l.getOutput();a.setPassword(p),logDebug("Reset password for "+e.getEmail()+"  sucessfully.")}else logDebug("**ERROR: Reset password for  "+e.getEmail()+"  failure:"+l.getErrorMessage());aa.publicUser.sendActivateEmail(a,!0,!0),aa.publicUser.sendPasswordEmail(a)}return t&&(logDebug("CreatePublicUserFromContact: Linking this public user with reference contact : "+t),aa.licenseScript.associateContactWithPublicUser(a.getUserSeqNum(),t)),a}function createRecord(e,t,a,r,s){var n=aa.cap.createApp(e,t,a,r,s);if(logDebug("creating cap "+e+"/"+t+"/"+a+"/"+r),n.getSuccess()){var i=n.getOutput();logDebug("cap "+e+"/"+t+"/"+a+"/"+r+" created successfully "),capModel=aa.cap.newCapScriptModel().getOutput(),capDetailModel=capModel.getCapModel().getCapDetailModel(),capDetailModel.setCapID(i),aa.cap.createCapDetail(capDetailModel);var o=(aa.cap.getCap(i).getOutput(),aa.parcel.getParcelandAttribute(capId,null));if(o.getSuccess()){var g=o.getOutput().toArray();for(zz in g){logDebug("adding parcel #"+zz+" = "+g[zz].getParcelNumber());var u=aa.parcel.getCapParcelModel().getOutput();u.setParcelModel(g[zz]),u.setCapIDModel(i),u.setL1ParcelNo(g[zz].getParcelNumber()),u.setParcelNo(g[zz].getParcelNumber()),aa.parcel.createCapParcel(u)}}if(capContactResult=aa.people.getCapContactByCapID(capId),capContactResult.getSuccess()){Contacts=capContactResult.getOutput();for(yy in Contacts){var c=Contacts[yy].getCapContactModel();c.setCapID(i),aa.people.createCapContact(c),logDebug("added contact")}}if(capAddressResult=aa.address.getAddressByCapId(capId),capAddressResult.getSuccess()){Address=capAddressResult.getOutput();for(yy in Address)newAddress=Address[yy],newAddress.setCapID(i),aa.address.createAddress(newAddress),logDebug("added address")}return i}logDebug("**ERROR: adding parent App: "+n.getErrorMessage())}function createRefContactAddressFromAddress(e,t,a){if(t&&e){var r=aa.address.createContactAddressModel().getOutput();r.setServiceProviderCode(servProvCode),r.setAuditStatus("A"),r.setAuditID(currentUserID);var s=r.getContactAddressModel();s.setEntityID(parseInt(e)),s.setEntityType("CONTACT"),s.setAddressType(a),s.setAddressLine1(t.getAddressLine1()),s.setAddressLine2(t.getAddressLine2()),s.setAddressLine3(t.getCounty()),s.setHouseNumberStart(t.getHouseNumberStart()),s.setHouseNumberEnd(t.getHouseNumberEnd()),s.setStreetName(t.getStreetName()),s.setCity(t.getCity()),s.setState(t.getState()),s.setZip(t.getZip());var s=r.getContactAddressModel(),n=aa.address.createContactAddress(s);return n.getSuccess()?(logDebug("Create Contact Address Successfully: "+n.getOutput().getAddressID()),n.getOutput()):(logDebug("Create Contact Address Failed:"+n.getErrorMessage()),!1)}return logDebug("Could not create reference contact address no address model or reference contact sequence number"),!1}function createRefContactsFromCapContactsAndLink(e,t,a,r,s,n){{var i="REF_CONTACT_CREATION_RULES";new Array}arguments.length>1&&(ignoreArray=arguments[1]);var o=lookup(i,"Default"),g=aa.people.getCapContactByCapID(e).getOutput(),u=aa.people.getCapContactByCapID(e).getOutput();for(var c in g){var l="U",p=g[c],d=p.getPeople(),f=lookup(i,d.getContactType());if((o||f||!t||exists(d.getContactType(),t))&&(!f&&o&&(l=o),f&&(l=f),!l.equals("D"))){var m="";switch(l){case"U":m=d.getContactType();break;case"I":m="Individual";break;case"O":m="Organization";break;case"F":m=d.getContactTypeFlag()&&d.getContactTypeFlag().equals("organization")?"Organization":"Individual"}var C=p.getCapContactModel().getRefContactNumber();if(C){if(s){d.setContactSeqNumber(C),d.setContactType(m);var b=d.getAttributes();if(b)for(var D=b.iterator();D.hasNext();){var A=D.next();A.setContactNo(C)}var v=aa.people.editPeopleWithAttribute(d,d.getAttributes());logDebug(v.getSuccess()?"Successfully refreshed ref contact #"+C+" with CAP contact data":"WARNING: couldn't refresh reference people : "+v.getErrorMessage())}}else{var y=d.getContactSeqNumber(),h=n(d),d=u[c].getPeople();if(h)S=h;else{var b=d.getAttributes();if(b)for(var D=b.iterator();D.hasNext();){var A=D.next();a&&exists(A.getAttributeName().toUpperCase(),a)&&D.remove()}d.setContactType(m);var v=aa.people.createPeopleWithAttribute(d,b);if(!v.getSuccess()){logDebug("WARNING: couldn't create reference people : "+v.getErrorMessage());continue}var d=u[c].getPeople(),S=d.getContactSeqNumber();logDebug("Successfully created reference contact #"+S);var R=aa.publicUser.getPublicUserByEmail(p.getEmail());if(R.getSuccess()&&R.getOutput()){var I=R.getOutput();logDebug("createRefContactsFromCapContactsAndLink: Found an existing public user: "+I.getUserID()),S&&(logDebug("createRefContactsFromCapContactsAndLink: Linking this public user with new reference contact : "+S),aa.licenseScript.associateContactWithPublicUser(I.getUserSeqNum(),S))}}var N=aa.people.getCapContactByPK(e,y).getOutput().getCapContactModel();N.setRefContactNumber(S),v=aa.people.editCapContact(N),logDebug(v.getSuccess()?"Successfully linked ref contact "+S+" to cap contact "+y:"WARNING: error updating cap contact model : "+v.getErrorMessage())}}}}function createRefLicProf(e,t,a){var r=null;4==arguments.length&&(r=arguments[3]);var s=!1;if(conArr=getPeople(capId),!conArr.length)return logDebug("**WARNING: No contact available"),!1;var n=getRefLicenseProf(e);if(n)s=!0,logDebug("Updating existing Ref Lic Prof : "+e);else var n=aa.licenseScript.createLicenseScriptModel();if(null==a)var i=conArr[0];else{var o=!1;for(yy in conArr)if(a.equals(conArr[yy].getCapContactModel().getPeople().getContactType())){i=conArr[yy],o=!0;break}if(!o)return logDebug("**WARNING: No Contact found of type: "+a),!1}peop=i.getPeople();var g=null;if(r){var u=peop.getContactAddressList();if(u){u=u.toArray();for(var c in u)r.equals(u[c].getAddressType())&&(g=u[c])}}return g||(g=peop.getCompactAddress()),n.setContactFirstName(i.getFirstName()),n.setContactLastName(i.getLastName()),n.setBusinessName(peop.getBusinessName()),n.setAddress1(g.getAddressLine1()),n.setAddress2(g.getAddressLine2()),n.setAddress3(g.getAddressLine3()),n.setCity(g.getCity()),n.setState(g.getState()),n.setZip(g.getZip()),n.setPhone1(peop.getPhone1()),n.setPhone2(peop.getPhone2()),n.setEMailAddress(peop.getEmail()),n.setFax(peop.getFax()),n.setAgencyCode(aa.getServiceProviderCode()),n.setAuditDate(sysDate),n.setAuditID(currentUserID),n.setAuditStatus("A"),AInfo["Insurance Co"]&&n.setInsuranceCo(AInfo["Insurance Co"]),AInfo["Insurance Amount"]&&n.setInsuranceAmount(parseFloat(AInfo["Insurance Amount"])),AInfo["Insurance Exp Date"]&&n.setInsuranceExpDate(aa.date.parseDate(AInfo["Insurance Exp Date"])),AInfo["Policy #"]&&n.setPolicy(AInfo["Policy #"]),AInfo["Business License #"]&&n.setBusinessLicense(AInfo["Business License #"]),AInfo["Business License Exp Date"]&&n.setBusinessLicExpDate(aa.date.parseDate(AInfo["Business License Exp Date"])),n.setLicenseType(t),n.setLicState(g.getState()),n.setStateLicense(e),myResult=s?aa.licenseScript.editRefLicenseProf(n):aa.licenseScript.createRefLicenseProf(n),myResult.getSuccess()?(logDebug("Successfully added/updated License No. "+e+", Type: "+t),logMessage("Successfully added/updated License No. "+e+", Type: "+t),!0):(logDebug("**ERROR: can't create ref lic prof: "+myResult.getErrorMessage()),logMessage("**ERROR: can't create ref lic prof: "+myResult.getErrorMessage()),!1)}function createRefLicProfFromLicProf(){if(capLicenseResult=aa.licenseScript.getLicenseProf(capId),!capLicenseResult.getSuccess())return logDebug("**ERROR: getting lic prof: "+capLicenseResult.getErrorMessage()),!1;if(capLicenseArr=capLicenseResult.getOutput(),!capLicenseArr.length)return logDebug("WARNING: no license professional available on the application:"),!1;licProfScriptModel=capLicenseArr[0],rlpId=licProfScriptModel.getLicenseNbr();var e=!1,t=getRefLicenseProf(rlpId);if(t)e=!0,logDebug("Updating existing Ref Lic Prof : "+rlpId);else var t=aa.licenseScript.createLicenseScriptModel();return t.setStateLicense(rlpId),t.setAddress1(licProfScriptModel.getAddress1()),t.setAddress2(licProfScriptModel.getAddress2()),t.setAddress3(licProfScriptModel.getAddress3()),t.setAgencyCode(licProfScriptModel.getAgencyCode()),t.setAuditDate(licProfScriptModel.getAuditDate()),t.setAuditID(licProfScriptModel.getAuditID()),t.setAuditStatus(licProfScriptModel.getAuditStatus()),t.setBusinessLicense(licProfScriptModel.getBusinessLicense()),t.setBusinessName(licProfScriptModel.getBusinessName()),t.setCity(licProfScriptModel.getCity()),t.setCityCode(licProfScriptModel.getCityCode()),t.setContactFirstName(licProfScriptModel.getContactFirstName()),t.setContactLastName(licProfScriptModel.getContactLastName()),t.setContactMiddleName(licProfScriptModel.getContactMiddleName()),t.setContryCode(licProfScriptModel.getCountryCode()),t.setCountry(licProfScriptModel.getCountry()),t.setEinSs(licProfScriptModel.getEinSs()),t.setEMailAddress(licProfScriptModel.getEmail()),t.setFax(licProfScriptModel.getFax()),t.setLicenseType(licProfScriptModel.getLicenseType()),t.setLicOrigIssDate(licProfScriptModel.getLicesnseOrigIssueDate()),t.setPhone1(licProfScriptModel.getPhone1()),t.setPhone2(licProfScriptModel.getPhone2()),t.setSelfIns(licProfScriptModel.getSelfIns()),t.setState(licProfScriptModel.getState()),t.setLicState(licProfScriptModel.getState()),t.setSuffixName(licProfScriptModel.getSuffixName()),t.setWcExempt(licProfScriptModel.getWorkCompExempt()),t.setZip(licProfScriptModel.getZip()),myResult=e?aa.licenseScript.editRefLicenseProf(t):aa.licenseScript.createRefLicenseProf(t),myResult.getSuccess()?(logDebug("Successfully added/updated License ID : "+rlpId),rlpId):void logDebug("**ERROR: can't create ref lic prof: "+myResult.getErrorMessage())}function createRefLP4Lookup(e,t,a,r){createRefLicProf(e,t,a,r),newLic=getRefLicenseProf(e),newLic?(newLic.setAuditStatus("A"),aa.licenseScript.editRefLicenseProf(newLic),logDebug("Reference LP successfully created")):logDebug("Reference LP not created")}function dateAdd(e,t){var a=!1;3==arguments.length&&(a=!0),dDate=e?convertDate(e):new Date;var r=0;if(a)if(aa.calendar.getNextWorkDay)for(;r<Math.abs(t);)t>0?(dDate=new Date(aa.calendar.getNextWorkDay(aa.date.parseDate(dDate.getMonth()+1+"/"+dDate.getDate()+"/"+dDate.getFullYear())).getOutput().getTime()),r++):(dDate=new Date(aa.calendar.getPreviousWorkDay(aa.date.parseDate(dDate.getMonth()+1+"/"+dDate.getDate()+"/"+dDate.getFullYear())).getOutput().getTime()),r++);else for(logDebug("getNextWorkDay function is only available in Accela Automation 6.3.2 or higher.");r<Math.abs(t);)dDate.setDate(dDate.getDate()+parseInt(t>0?1:-1,10)),dDate.getDay()>0&&dDate.getDay()<6&&r++;else dDate.setDate(dDate.getDate()+parseInt(t,10));return dDate.getMonth()+1+"/"+dDate.getDate()+"/"+dDate.getFullYear()}function dateAddMonths(e,t){baseDate=e?convertDate(e):new Date;var a=baseDate.getDate();return baseDate.setMonth(baseDate.getMonth()+t),baseDate.getDate()<a&&(baseDate.setDate(1),baseDate.setDate(baseDate.getDate()-1)),baseDate.getMonth()+1+"/"+baseDate.getDate()+"/"+baseDate.getFullYear()}function dateDiff(e,t){return(convertDate(t).getTime()-convertDate(e).getTime())/864e5}function dateFormatted(e,t,a,r){var s="",n="",i="";return s=e>9?e.toString():"0"+e.toString(),n=t>9?t.toString():"0"+t.toString(),i="YYYY-MM-DD"==r?a.toString()+"-"+s+"-"+n:""+s+"/"+n+"/"+a.toString()}function dateNextOccur(e,t,a){var r=new String(a);if(10==r.length&&4==r.indexOf("-")&&7==r.indexOf("-",7))var s=new Date(r.substr(5,2)+"/"+r.substr(8,2)+"/"+r.substr(0,4));else var s=new Date(r);var n,i=s.getFullYear().toString(),o=new Date(e+"/"+t+"/"+i),g=!1,u=o;if(arguments.length>3){var n=arguments[3].toUpperCase();g=!0}return o>s?u=o:(o.setFullYear(o.getFullYear()+1),u=o),g&&("ODD"==n&&u.getFullYear()%2==0&&u.setFullYear(u.getFullYear()+1),"EVEN"==n&&u.getFullYear()%2&&u.setFullYear(u.getFullYear()+1)),u.getMonth()+1+"/"+u.getDate()+"/"+u.getFullYear()}function deactivateActiveTasks(e){var t=aa.workflow.getTasks(capId);if(!t.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=t.getOutput();for(i in wfObj)fTask=wfObj[i],fTask.getProcessCode().equals(e)&&fTask.getActiveFlag().equals("Y")&&deactivateTask(fTask.getTaskDescription())}function deactivateTask(e){var t=!1,a="";2==arguments.length&&(a=arguments[1],t=!0);var r=aa.workflow.getTaskItems(capId,e,a,null,null,null);if(!r.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var s=r.getOutput();for(i in s){var n=s[i];if(n.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!t||n.getProcessCode().equals(a))){var o=n.getStepNumber(),g=n.getProcessID(),u=n.getCompleteFlag();t?aa.workflow.adjustTask(capId,o,g,"N",u,null,null):aa.workflow.adjustTask(capId,o,"N",u,null,null),logDebug("deactivating Workflow Task: "+e)}}}function decode64(e){var t,a,r,s,n,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="",g="",u="",c=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(e)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=i.indexOf(e.charAt(c++)),s=i.indexOf(e.charAt(c++)),n=i.indexOf(e.charAt(c++)),u=i.indexOf(e.charAt(c++)),t=r<<2|s>>4,a=(15&s)<<4|n>>2,g=(3&n)<<6|u,o+=String.fromCharCode(t),64!=n&&(o+=String.fromCharCode(a)),64!=u&&(o+=String.fromCharCode(g)),t=a=g="",r=s=n=u="";while(c<e.length);return unescape(o)}function deleteLicensedProfessional(e){var t=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.LicenseBusiness").getOutput(),a=aa.proxyInvoker.newInstance("com.accela.pa.people.license.ContractorLicenseBusiness").getOutput();if(e){lm=e.getLicenseModel(),pubusers=aa.publicUser.getPublicUserListByLicenseSeqNBR(licenseNumber).getOutput().toArray();for(p1 in pubusers)pu=pubusers[p1].getUserSeqNum(),a.deleteContractorLicense(pu,e.getLicenseType(),e.getAgencyCode(),licenseNumber),logDebug("deleted association to public user: "+pubusers[p1].getUserID());t.removeLicenseByPK(lm),logDebug(licenseNumber+"has been deleted")}}function deleteTask(e,t){var a=aa.workflow.getTaskItems(e,t,null,null,null,null);if(!a.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var r=a.getOutput(),s=null;for(i in r){var n=r[i];if(n.getTaskDescription().toUpperCase().equals(t.toUpperCase()))var s=r[i]}if(!s)return logDebug("**WARNING: Task not found: "+t),!1;logDebug("Removing task "+s.getTaskDescription());var o=aa.workflow.removeTask(s);return o.getSuccess()?void 0:(logDebug("error "+o.getErrorMessage()),!1)}function describe(e){var t="";for(var a in e)t+="function"==typeof e[a]?"method:"+a+"\n":"property:"+a+" = "+e[a]+"\n";return t}function docWrite(e,t,a){var r="";for(i=0;i<a;i++)r+="|  ";t&&e&&aa.print(r+"------------------------------------------------"),e&&aa.print(r+e),t&&aa.print(r+"------------------------------------------------")}function doScriptActions(){"object"==typeof appTypeArray&&(include(prefix+":"+appTypeArray[0]+"/*/*/*"),include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/*/*"),include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/"+appTypeArray[2]+"/*"),include(prefix+":"+appTypeArray[0]+"/*/"+appTypeArray[2]+"/*"),include(prefix+":"+appTypeArray[0]+"/*/"+appTypeArray[2]+"/"+appTypeArray[3]),include(prefix+":"+appTypeArray[0]+"/*/*/"+appTypeArray[3]),include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/*/"+appTypeArray[3]),include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/"+appTypeArray[2]+"/"+appTypeArray[3]))}function doStandardChoiceActions(stdChoiceEntry,doExecution,docIndent){var thisDate=new Date,thisTime=thisDate.getTime(),lastEvalTrue=!1;stopBranch=!1,logDebug("Executing : "+stdChoiceEntry+", Elapsed Time: "+(thisTime-startTime)/1e3+" Seconds");var pairObjArray=getScriptAction(stdChoiceEntry);doExecution||docWrite(stdChoiceEntry,!0,docIndent);for(xx in pairObjArray)if(doObj=pairObjArray[xx],doExecution){if(doObj.enabled){if(stopBranch){stopBranch=!1;break}logDebug(aa.env.getValue("CurrentUserID")+" : "+stdChoiceEntry+" : #"+doObj.ID+" : Criteria : "+doObj.cri,2);try{eval(token(doObj.cri))||lastEvalTrue&&doObj.continuation?(logDebug(aa.env.getValue("CurrentUserID")+" : "+stdChoiceEntry+" : #"+doObj.ID+" : Action : "+doObj.act,2),eval(token(doObj.act)),lastEvalTrue=!0):(doObj.elseact&&(logDebug(aa.env.getValue("CurrentUserID")+" : "+stdChoiceEntry+" : #"+doObj.ID+" : Else : "+doObj.elseact,2),eval(token(doObj.elseact))),lastEvalTrue=!1)}catch(err){showDebug=3,logDebug("**ERROR An error occured in the following standard choice "+stdChoiceEntry+"#"+doObj.ID+"  Error:  "+err.message)}}}else{docWrite("|  ",!1,docIndent);var disableString="";doObj.enabled||(disableString="<DISABLED>"),doObj.elseact?docWrite("|  "+doObj.ID+" "+disableString+" "+doObj.cri+" ^ "+doObj.act+" ^ "+doObj.elseact,!1,docIndent):docWrite("|  "+doObj.ID+" "+disableString+" "+doObj.cri+" ^ "+doObj.act,!1,docIndent);for(yy in doObj.branch)doStandardChoiceActions(doObj.branch[yy],!1,docIndent+1)}doExecution||docWrite(null,!0,docIndent);var thisDate=new Date,thisTime=thisDate.getTime();logDebug("Finished: "+stdChoiceEntry+", Elapsed Time: "+(thisTime-startTime)/1e3+" Seconds")}function editAppName(e){var t=capId;return 2==arguments.length&&(t=arguments[1]),capResult=aa.cap.getCap(t),capResult.getSuccess()?(capModel=capResult.getOutput().getCapModel(),capModel.setSpecialText(e),setNameResult=aa.cap.editCapByPK(capModel),setNameResult.getSuccess()?!0:(logDebug("**WARNING: error setting cap name : "+setNameResult.getErrorMessage()),!1)):(logDebug("**WARNING: error getting cap : "+capResult.getErrorMessage()),!1)}function editAppSpecific(e,t){var a=capId,r=null;if(3==arguments.length&&(a=arguments[2]),useAppSpecificGroupName){if(e.indexOf(".")<0)return logDebug("**WARNING: editAppSpecific requires group name prefix when useAppSpecificGroupName is true"),!1;r=e.substr(0,e.indexOf(".")),e=e.substr(e.indexOf(".")+1)}var s=aa.appSpecificInfo.editSingleAppSpecific(a,e,t,r);s.getSuccess()?arguments.length<3&&(AInfo[e]=t):logDebug("WARNING: "+e+" was not updated.")}function editAppSpecific4ACA(e,t){for(var a=cap.getAppSpecificInfoGroups().iterator();a.hasNext();){var r=a.next(),s=r.getFields();if(null!=s)for(var n=s.iterator();n.hasNext();){var i=n.next();(useAppSpecificGroupName&&e.equals(i.getCheckboxType()+"."+i.getCheckboxDesc())||e.equals(i.getCheckboxDesc()))&&i.setChecklistComment(t)}}}function editBuildingCount(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();return r?(cd=r.getCapDetailModel(),cd.setBuildingCount(parseFloat(e)),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("Updated building count to "+e),!0):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editCapConditionStatus(e,t,a,r){if(null==e)var s=aa.capCondition.getCapConditions(capId);else var s=aa.capCondition.getCapConditions(capId,e);if(!s.getSuccess())return logMessage("**ERROR: getting cap conditions: "+s.getErrorMessage()),logDebug("**ERROR: getting cap conditions: "+s.getErrorMessage()),!1;var n=s.getOutput();for(cc in n){{var i=n[cc],o=i.getConditionStatus(),g=i.getConditionStatusType(),u=i.getConditionDescription();i.getImpactCode()}if(logDebug(o+": "+g),u.toUpperCase()==t.toUpperCase())return a.toUpperCase().equals(o.toUpperCase())?(logDebug("ERROR: condition found but already in the status of pStatus and pStatusType"),!1):(i.setConditionStatus(a),i.setConditionStatusType(r),i.setImpactCode(""),aa.capCondition.editCapCondition(i),!0)}return logDebug("ERROR: no matching condition found"),!1}function days_between(e,t){var a=864e5,r=e.getTime(),s=t.getTime(),n=Math.abs(r-s);return Math.round(n/a)}function editCapContactAttribute(e,t,a){var r=capId;arguments.length>3&&(r=arguments[3]);var s=null,n=aa.people.getCapContactByCapID(r).getOutput();for(var i in n){var o=!1,g=n[i].getCapContactModel().getPeople();if(g.getContactSeqNumber()==e){var u=g.getAttributes().toArray();for(var c in u)if(t.equals(u[c].getAttributeName())){s=u[c].getAttributeValue(),u[c].setAttributeValue(a),o=!0;break}if(o){logDebug("Updated Cap Contact: "+e+", attribute: "+t+" from: "+s+" to: "+a),n[i].getCapContactModel().setPeople(g);{aa.people.editCapContactWithAttribute(n[i].getCapContactModel())}}}}}function editChannelReported(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();return r?(cd=r.getCapDetailModel(),cd.setReportedChannel(e),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void logDebug("Updated channel reported to "+e):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editConstTypeCode(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();return r?(cd=r.getCapDetailModel(),cd.setConstTypeCode(e),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("Updated Construction Type Code to "+e),!0):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editContactType(e,t){var a=capId;if(3==arguments.length&&(a=arguments[2]),capContactResult=aa.people.getCapContactByCapID(a),capContactResult.getSuccess()){Contacts=capContactResult.getOutput();for(yy in Contacts){var r=Contacts[yy].getCapContactModel();if(r.getContactType()==e){r.setContactType(t);var s=r.getPeople(),n=aa.address.getContactAddressListByCapContact(r);if(n.getSuccess()){var i=convertContactAddressModelArr(n.getOutput());s.setContactAddressList(i)}aa.people.editCapContactWithAttribute(r)}}}}function editCreatedBy(e){var t=capId;2==arguments.length&&(t=arguments[1]);var a=aa.cap.getCap(t);if(!a.getSuccess())return logDebug("**WARNING: error getting cap : "+a.getErrorMessage()),!1;var r=a.getOutput(),s=r.getCapModel();return s.setCreatedBy(e),setCreatedByResult=aa.cap.editCapByPK(s),setCreatedByResult.getSuccess()?!0:(logDebug("**WARNING: error setting cap created by : "+setCreatedByResult.getErrorMessage()),!1)}function editEstimatedJobValue(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getBValuatn4AddtInfo(t),r=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var s=a.getOutput();if(!s)return logDebug("**ERROR: No valuation detail script object"),!1;if(!r.getSuccess())return logDebug("**ERROR: No cap detail script object : "+r.getErrorMessage()),!1;var n=r.getOutput();if(!n)return logDebug("**ERROR: No cap detail script object"),!1;s.setEstimatedValue(parseFloat(e));var i=aa.cap.editAddtInfo(n,s);i.getSuccess()||logDebug("**Error updating the job value in additional information"+edtResults.getErrorMessage()),null!==i&&i.getSuccess()===!0&&logDebug("Updated the estimated job value to "+e)}function editFirstIssuedDate(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();if(!r)return logDebug("**ERROR: No cap detail script object"),!1;cd=r.getCapDetailModel();var s=new Date(e),n=aa.date.transToJavaUtilDate(s.getTime());return cd.setFirstIssuedDate(n),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("updated first issued date to "+n),!0):(logDebug("**ERROR updating first issued date: "+cdWrite.getErrorMessage()),!1)}function editHouseCount(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();return r?(cd=r.getCapDetailModel(),cd.setHouseCount(parseFloat(e)),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("Updated house count to "+e),!0):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editInspectionRequiredFlag(e,t){var a=capId;arguments.length>2&&(a=arguments[2]);var r=aa.inspection.getInspMilestoneByCapID(a);if(!r.getSuccess())return logDebug("**ERROR retrieving inspection milestones: "+r.getErrorMessage()),!1;if(inspMilestones=r.getOutput(),!inspMilestones)return logDebug("No Inspection Milestones found"),!1;for(thisM in inspMilestones){var s=inspMilestones[thisM];e.equals(s.getInspType())&&(s.setInspRequired(t?"Y":"N"),r=aa.inspection.updateInspectionMilestone(inspMilestones),logDebug(r.getSuccess()?"inspection milestone updated sucessfully.":"**ERROR: could not update inpsection milestone "+r.getErrorMessage()))}}function editLookup(e,t,a){var r=aa.bizDomain.getBizDomainByValue(e,t);if(!r.getSuccess())return logDebug("Std Choice("+e+","+t+") does not exist to edit, adding..."),addLookup(e,t,a),!1;bds=r.getOutput();var s=bds.getBizDomain();s.setDescription(a);var n=aa.bizDomain.editBizDomain(s);logDebug(n.getSuccess()?"Successfully edited Std Choice("+e+","+t+") = "+a:"**ERROR editing Std Choice "+n.getErrorMessage())}function editPriority(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();return r?(cd=r.getCapDetailModel(),cd.setPriority(e),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("updated priority to "+e),!0):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editRefLicProfAttribute(e,t,a){var r=!1,s=null;if(licObj=getRefLicenseProf(e),!licObj)return logDebug("**WARNING Licensed Professional : "+e+" not found"),!1;if(licSeqNum=licObj.getLicSeqNbr(),attributeType=licObj.getLicenseType(),null==licSeqNum||""==attributeType||null==attributeType)return logDebug("**WARNING Licensed Professional Sequence Number or Attribute Type missing"),!1;var n=aa.people.getPeopleAttributeByPeople(licSeqNum,attributeType);if(!n.getSuccess())return logDebug("**WARNING retrieving reference license professional attribute: "+n.getErrorMessage()),!1;var o=n.getOutput();for(i in o)if(t.equals(o[i].getAttributeName())){s=o[i].getAttributeValue(),r=!0;break}r?(logDebug("Updated Ref Lic Prof: "+e+", attribute: "+t+" from: "+s+" to: "+a),o[i].setAttributeValue(a),aa.people.editPeopleAttribute(o[i].getPeopleAttributeModel())):logDebug("**WARNING attribute: "+t+" not found for Ref Lic Prof: "+e)}function editReportedChannel(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();return r?(cd=r.getCapDetailModel(),cd.setReportedChannel(e),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("updated reported channel to "+e),!0):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editFirstIssuedDate(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();if(!r)return logDebug("**ERROR: No cap detail script object"),!1;cd=r.getCapDetailModel();var s=new Date(e),n=aa.date.transToJavaUtilDate(s.getTime());return cd.setFirstIssuedDate(n),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("updated first issued date to "+n),!0):(logDebug("**ERROR updating first issued date: "+cdWrite.getErrorMessage()),!1)}function editTaskACAVisibility(e,t,a,r){var s=!1,n="";4==arguments.length&&(n=arguments[3],s=!0);var o=aa.workflow.getTasks(capId);if(!o.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var g=o.getOutput();for(i in g)if(fTask=g[i],fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!s||fTask.getProcessCode().equals(n))){var u=g[i].getTaskItem();u.setIsRestrictView4ACA(a?"Y":"N"),u.setDisplayInACA(t?"Y":"N"),u.setRestrictRole(r+"00000");var c=aa.workflow.editTask(u,currentUserID);if(!c.getSuccess())return logMessage("**ERROR: Failed to update task, comment visible flags on workflow task: "+c.getErrorMessage()),!1;logDebug("Set Workflow visible flags: "+t+" , "+a)}}function editTaskComment(e,t){var a=!1,r="";3==arguments.length&&(r=arguments[2],a=!0);var s=aa.workflow.getTaskItems(capId,e,r,null,null,null);if(!s.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var n=s.getOutput();for(i in n)if(fTask=n[i],fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!a||fTask.getProcessCode().equals(r))){n[i].setDispositionComment(t);var o=n[i].getTaskItem(),g=aa.workflow.adjustTaskWithNoAudit(o);if(!g.getSuccess())return logMessage("**ERROR: Failed to update comment on workflow task: "+g.getErrorMessage()),!1;logDebug("Set Workflow: "+e+" comment "+t)}}function editTaskDueDate(e,t){var a=!1,r="";3==arguments.length&&(r=arguments[2],a=!0);var s=e;"*"==e&&(s="");var n=aa.workflow.getTaskItems(capId,s,r,null,null,null);if(!n.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=n.getOutput();for(i in wfObj){var o=wfObj[i];if((o.getTaskDescription().toUpperCase().equals(e.toUpperCase())||"*"==e)&&(!a||o.getProcessCode().equals(r))){wfObj[i].setDueDate(aa.date.parseDate(t));var g=wfObj[i].getTaskItem(),u=aa.workflow.adjustTaskWithNoAudit(g);if(!u.getSuccess())return logMessage("**ERROR: Failed to update due date on workflow: "+u.getErrorMessage()),!1;logDebug("Set Workflow Task: "+o.getTaskDescription()+" due Date "+t)}}}function editTaskSpecific(e,t,a){var r=0;itemCap=capId,4==arguments.length&&(itemCap=arguments[3]);var s=aa.workflow.getTaskItems(itemCap,e,null,null,null,null);if(!s.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=s.getOutput();for(r in wfObj)if(fTask=wfObj[r],stepnumber=fTask.getStepNumber(),processID=fTask.getProcessID(),e.equals(fTask.getTaskDescription())){if(TSIResult=aa.taskSpecificInfo.getTaskSpecifiInfoByDesc(itemCap,processID,stepnumber,t),!TSIResult.getSuccess())return logDebug("**ERROR: Failed to get Task Specific Info objects: "+TSIResult.getErrorMessage()),!1;var n=TSIResult.getOutput();if(null!=n){var i=new Array;if(TSInfoModel=n.getTaskSpecificInfoModel(),TSInfoModel.setChecklistComment(a),i.push(TSInfoModel),TSIUResult=aa.taskSpecificInfo.editTaskSpecInfos(i),!TSIUResult.getSuccess())return logDebug("**ERROR: Failed to Update Task Specific Info : "+TSIUResult.getErrorMessage()),!1;logDebug("Successfully updated TSI Task="+e+" Item="+t+" Value="+a),AInfo[t]=a}else logDebug("No task specific info field called "+t+" found for task "+e)}}function email(e,t,a,r){return aa.sendMail(t,e,"",a,r),logDebug("Email sent to "+e),!0}function emailContact(e,t){var a="noreply@accela.com",r="Applicant",s="";3==arguments.length&&(r=arguments[2]);var n=aa.people.getCapContactByCapID(capId);if(n.getSuccess()){var i=n.getOutput();for(yy in i)r.equals(i[yy].getCapContactModel().getPeople().getContactType())&&null!=i[yy].getEmail()&&(s=""+i[yy].getEmail())}s.indexOf("@")>0?(aa.sendMail(a,s,"",e,t),logDebug("Successfully sent email to "+r)):logDebug("Couldn't send email to "+r+", no valid email address")
}function encode64(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e=escape(e);var a,r,s,n,i,o="",g="",u="",c=0;do a=e.charCodeAt(c++),r=e.charCodeAt(c++),g=e.charCodeAt(c++),s=a>>2,n=(3&a)<<4|r>>4,i=(15&r)<<2|g>>6,u=63&g,isNaN(r)?i=u=64:isNaN(g)&&(u=64),o=o+t.charAt(s)+t.charAt(n)+t.charAt(i)+t.charAt(u),a=r=g="",s=n=i=u="";while(c<e.length);return o}function endBranch(){stopBranch=!0}function executeASITable(tableArray){for(xx in tableArray){var doTableObj=tableArray[xx],myCriteria=doTableObj.Criteria;aa.print("cri: "+myCriteria);var myAction=doTableObj.Action;aa.print("act: "+myAction),aa.print("enabled: "+doTableObj.Enabled),"Yes"==doTableObj.Enabled&&eval(token(myCriteria))&&eval(token(myAction))}}function exists(e,t){for(ii in t)if(t[ii]==e)return!0;return!1}function externalLP_CA(e,t,a,r,s){var n="",i=new Array;if(e&&i.push(String(e)),s){var o=aa.licenseScript.getLicenseProf(s);if(!o.getSuccess())return logDebug("**ERROR: getting lic prof: "+o.getErrorMessage()),!1;var g=o.getOutput();if(null!=g&&g.length)for(var u in g)g[u].getLicenseType()==t&&i.push(g[u]);else logDebug("**WARNING: no licensed professionals on this CAP")}else r=!1;for(var u=0;u<i.length;u++){var e=i[u],c=null,l=!1;"object"==typeof e&&(c=e,e=c.getLicenseNbr(),l=!0);var p,d,f="https://www2.cslb.ca.gov/IVR/License+Detail.aspx?LicNum="+e,m=aa.httpClient.get(f),C=!1;if(m.getSuccess()){var b=m.getOutput(),D=aa.proxyInvoker.newInstance("java.io.StringBufferInputStream",new Array(b)).getOutput(),A=aa.proxyInvoker.newInstance("org.jdom.input.SAXBuilder").getOutput();p=A.build(D),d=p.getRootElement(),errorNode=d.getChild("Error")}else C=!0;if(C)logDebug("The CSLB web service is currently unavailable");else if(errorNode)logDebug("Error for license "+e+" : "+errorNode.getText().replace(/\+/g," ")),n+="License "+e+" : "+errorNode.getText().replace(/\+/g," ")+" ";else{for(var v=d.getChild("BusinessInfo"),y=d.getChild("PrimaryStatus"),h=(d.getChild("Classifications"),d.getChild("ContractorBond"),d.getChild("WorkersComp"),y.getChildren()),S=0;S<h.size();S++){var R=h.get(S);"10"!=R.getAttribute("Code").getValue()&&(n+="License:"+e+", "+R.getAttribute("Desc").getValue()+" ")}if(a){var I=!1,N=getRefLicenseProf(e);if(N)I=!0,logDebug("Updating existing Ref Lic Prof : "+e);else var N=aa.licenseScript.createLicenseScriptModel();l&&(c.getAddress1()&&N.setAddress1(c.getAddress1()),c.getAddress2()&&N.setAddress2(c.getAddress2()),c.getAddress3()&&N.setAddress3(c.getAddress3()),c.getAgencyCode()&&N.setAgencyCode(c.getAgencyCode()),c.getBusinessLicense()&&N.setBusinessLicense(c.getBusinessLicense()),c.getBusinessName()&&N.setBusinessName(c.getBusinessName()),c.getBusName2()&&N.setBusinessName2(c.getBusName2()),c.getCity()&&N.setCity(c.getCity()),c.getCityCode()&&N.setCityCode(c.getCityCode()),c.getContactFirstName()&&N.setContactFirstName(c.getContactFirstName()),c.getContactLastName()&&N.setContactLastName(c.getContactLastName()),c.getContactMiddleName()&&N.setContactMiddleName(c.getContactMiddleName()),c.getCountryCode()&&N.setContryCode(c.getCountryCode()),c.getEmail()&&N.setEMailAddress(c.getEmail()),c.getCountry()&&N.setCountry(c.getCountry()),c.getEinSs()&&N.setEinSs(c.getEinSs()),c.getFax()&&N.setFax(c.getFax()),c.getFaxCountryCode()&&N.setFaxCountryCode(c.getFaxCountryCode()),c.getHoldCode()&&N.setHoldCode(c.getHoldCode()),c.getHoldDesc()&&N.setHoldDesc(c.getHoldDesc()),c.getLicenseExpirDate()&&N.setLicenseExpirationDate(c.getLicenseExpirDate()),c.getLastRenewalDate()&&N.setLicenseLastRenewalDate(c.getLastRenewalDate()),c.getLicesnseOrigIssueDate()&&N.setLicOrigIssDate(c.getLicesnseOrigIssueDate()),c.getPhone1()&&N.setPhone1(c.getPhone1()),c.getPhone1CountryCode()&&N.setPhone1CountryCode(c.getPhone1CountryCode()),c.getPhone2()&&N.setPhone2(c.getPhone2()),c.getPhone2CountryCode()&&N.setPhone2CountryCode(c.getPhone2CountryCode()),c.getSelfIns()&&N.setSelfIns(c.getSelfIns()),c.getState()&&N.setState(c.getState()),c.getSuffixName()&&N.setSuffixName(c.getSuffixName()),c.getZip()&&N.setZip(c.getZip())),""!=v.getChild("Name").getText()&&N.setBusinessName(unescape(v.getChild("Name").getText()).replace(/\+/g," ")),""!=v.getChild("Addr1").getText()&&N.setAddress1(unescape(v.getChild("Addr1").getText()).replace(/\+/g," ")),""!=v.getChild("Addr2").getText()&&N.setAddress2(unescape(v.getChild("Addr2").getText()).replace(/\+/g," ")),""!=v.getChild("City").getText()&&N.setCity(unescape(v.getChild("City").getText()).replace(/\+/g," ")),""!=v.getChild("State").getText()&&N.setState(unescape(v.getChild("State").getText()).replace(/\+/g," ")),""!=v.getChild("Zip").getText()&&N.setZip(unescape(v.getChild("Zip").getText()).replace(/\+/g," ")),""!=v.getChild("BusinessPhoneNum").getText()&&N.setPhone1(unescape(stripNN(v.getChild("BusinessPhoneNum").getText()).replace(/\+/g," "))),N.setAgencyCode(aa.getServiceProviderCode()),N.setAuditDate(sysDate),N.setAuditID(currentUserID),N.setAuditStatus("A"),N.setLicenseType(t),N.setLicState("CA"),N.setStateLicense(e),v.getChild("IssueDt").getText()&&N.setLicenseIssueDate(aa.date.parseDate(v.getChild("IssueDt").getText())),v.getChild("ExpireDt").getText()&&N.setLicenseExpirationDate(aa.date.parseDate(v.getChild("ExpireDt").getText())),v.getChild("ReissueDt").getText()&&N.setLicenseLastRenewalDate(aa.date.parseDate(v.getChild("ReissueDt").getText()));for(var O=d.getChild("WorkersComp").getChildren(),P=0;P<O.size();P++){wc=O.get(P),wc.getAttribute("PolicyNo").getValue()&&N.setWcPolicyNo(wc.getAttribute("PolicyNo").getValue()),wc.getAttribute("InsCoCde").getValue()&&N.setWcInsCoCode(unescape(wc.getAttribute("InsCoCde").getValue())),wc.getAttribute("WCEffDt").getValue()&&N.setWcEffDate(aa.date.parseDate(wc.getAttribute("WCEffDt").getValue())),wc.getAttribute("WCExpDt").getValue()&&N.setWcExpDate(aa.date.parseDate(wc.getAttribute("WCExpDt").getValue())),wc.getAttribute("WCCancDt").getValue()&&N.setWcCancDate(aa.date.parseDate(wc.getAttribute("WCCancDt").getValue())),N.setWcExempt("E"==wc.getAttribute("Exempt").getValue()?"Y":"N");break}if(I)var E=aa.licenseScript.editRefLicenseProf(N),T=N.getLicSeqNbr();else{var E=aa.licenseScript.createRefLicenseProf(N);if(!E.getSuccess()){logDebug("**WARNING: can't create ref lic prof: "+E.getErrorMessage());continue}var T=E.getOutput()}if(logDebug("Successfully added/updated License No. "+e+", Type: "+t+" Sequence Number "+T),l){var M=c.getAttributes();if(M)for(var w in M){var L=M[w];editRefLicProfAttribute(e,L.getAttributeName(),L.getAttributeValue())}}for(var x=d.getChild("Classifications").getChildren(),F=0;F<x.size();F++)cb=x.get(F),0==F&&(editRefLicProfAttribute(e,"CLASS CODE 1",cb.getAttribute("Code").getValue()),editRefLicProfAttribute(e,"CLASS DESC 1",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," "))),1==F&&(editRefLicProfAttribute(e,"CLASS CODE 2",cb.getAttribute("Code").getValue()),editRefLicProfAttribute(e,"CLASS DESC 2",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," "))),2==F&&(editRefLicProfAttribute(e,"CLASS CODE 3",cb.getAttribute("Code").getValue()),editRefLicProfAttribute(e,"CLASS DESC 3",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," "))),3==F&&(editRefLicProfAttribute(e,"CLASS CODE 4",cb.getAttribute("Code").getValue()),editRefLicProfAttribute(e,"CLASS DESC 4",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," ")));for(var k=d.getChild("ContractorBond").getChildren(),j=0;j<k.size();j++){var U=k.get(j);U.getAttribute("BondAmt").getValue()&&editRefLicProfAttribute(e,"BOND AMOUNT",unescape(U.getAttribute("BondAmt").getValue())),U.getAttribute("BondCancDt").getValue()&&editRefLicProfAttribute(e,"BOND EXPIRATION",unescape(U.getAttribute("BondCancDt").getValue()));break}if(r){var B=aa.licenseScript.getRefLicenseProfBySeqNbr(servProvCode,T);B.getSuccess()||logDebug("**WARNING error retrieving the LP just created "+B.getErrorMessage());var q=B.getOutput(),G=!1;if(null!=g)for(var W in g){var z=g[W];if(z.getLicenseType()==t&&z.getLicenseNbr()==e){logDebug("Removing license: "+z.getLicenseNbr()+" from CAP.  We will link the new reference LP"),"Y"==z.getPrintFlag()&&(logDebug("...remove primary status..."),G=!0,z.setPrintFlag("N"),aa.licenseProfessional.editLicensedProfessional(z));var $=aa.licenseProfessional.removeLicensedProfessional(z);logDebug(o.getSuccess()?"...Success.":"**WARNING removing lic prof: "+$.getErrorMessage())}}var V=aa.licenseScript.associateLpWithCap(s,q);if(logDebug(V.getSuccess()?"Associated the CAP to the new LP":"**WARNING error associating CAP to LP: "+V.getErrorMessage()),G){var Y=getLicenseProfessional(s);for(var _ in Y)if(Y[_].getLicenseNbr().equals(e)){var H=Y[_];H.setPrintFlag("Y"),aa.licenseProfessional.editLicensedProfessional(H),logDebug("Updated primary flag on Cap LP : "+e)}}}}}}return n.length>0?n:null}function feeAmount(e){var t=!1,a=new Array;if(arguments.length>1){t=!0;for(var r=1;r<arguments.length;r++)a.push(arguments[r])}var s=0,n=aa.fee.getFeeItems(capId,e,null);if(!n.getSuccess())return logDebug("**ERROR: getting fee items: "+n.getErrorMessage()),!1;var i=n.getOutput();for(ff in i)!e.equals(i[ff].getFeeCod())||t&&!exists(i[ff].getFeeitemStatus(),a)||(s+=i[ff].getFee());return s}function feeAmountExcept(e){var t=!1,a=new Array;if(arguments.length>1){t=!0;for(var r=1;r<arguments.length;r++)a.push(arguments[r])}var s=0,n=aa.fee.getFeeItems(e);if(!n.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var i=n.getOutput();for(ff in i)t&&exists(i[ff].getFeeCod(),a)||(s+=i[ff].getFee());return s}function feeBalance(e){var t,a=0,r=0;2==arguments.length&&(t=arguments[1]);var s=aa.fee.getFeeItems(capId,e,null);if(!s.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var n=s.getOutput();for(ff in n)if(!("INVOICED"==n[ff].getFeeitemStatus()||e&&!e.equals(n[ff].getFeeCod())||t&&!t.equals(n[ff].getF4FeeItemModel().getFeeSchudle()))){a+=n[ff].getFee();var i=aa.finance.getPaymentFeeItems(capId,null);if(i.getSuccess()){var o=i.getOutput();for(ij in o)n[ff].getFeeSeqNbr()==o[ij].getFeeSeqNbr()&&(r+=o[ij].getFeeAllocation())}}return a-r}function feeBalanceFromDate(e,t){var a,r=0,s=0,n=new Date,i=new Date;i.setDate(i.getDate()+e),3==arguments.length&&(a=arguments[2]);var o=aa.fee.getFeeItems(capId);if(!o.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var g=o.getOutput();for(ff in g)if(n.setTime(g[ff].getApplyDate().getEpochMilliseconds()),(!t||t.equals(g[ff].getFeeCod()))&&(!a||a.equals(g[ff].getF4FeeItemModel().getFeeSchudle()))&&n>=i){r+=g[ff].getFee();var u=aa.finance.getPaymentFeeItems(capId,null);if(u.getSuccess()){var c=u.getOutput();for(ij in c)g[ff].getFeeSeqNbr()==c[ij].getFeeSeqNbr()&&(s+=c[ij].getFeeAllocation())}}return r-s}function feeCopyByDateRange(e,t){var a=new Date(e);a.setHours(0,0,0,0);var r=new Date(t);r.setHours(23,59,59,999);var s=!1,n=new Array;if(arguments.length>2){s=!0;for(var i=2;i<arguments.length;i++)n.push(arguments[i])}var o=aa.fee.getFeeItems(capId);if(!o.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var g=o.getOutput(),u=0,c=new Date;for(ff in g)c.setTime(g[ff].getApplyDate().getEpochMilliseconds()),c>=a&&r>=c&&(!s||exists(g[ff].getFeeitemStatus(),n))&&addFee(ffeObjArr[ff].getFeeCod(),ffeObjArr[ff].getFeeSchudle(),ffeObjArr[ff].getPaymentPeriod(),ffeObjArr[ff].getFeeUnit(),"Y");return u}function feeExists(e){var t=!1,a=new Array;if(arguments.length>1){t=!0;for(var r=1;r<arguments.length;r++)a.push(arguments[r])}var s=aa.fee.getFeeItems(capId,e,null);if(!s.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var n=s.getOutput();for(ff in n)if(e.equals(n[ff].getFeeCod())&&(!t||exists(n[ff].getFeeitemStatus(),a)))return!0;return!1}function feeGetTotByDateRange(e,t){var a=new Date(e);a.setHours(0,0,0,0);var r=new Date(t);r.setHours(23,59,59,999);var s=!1,n=new Array;if(arguments.length>2){s=!0;for(var i=2;i<arguments.length;i++)n.push(arguments[i])}var o=aa.fee.getFeeItems(capId);if(!o.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var g=o.getOutput(),u=0,c=new Date;for(ff in g)c.setTime(g[ff].getApplyDate().getEpochMilliseconds()),c>=a&&r>=c&&(!s||exists(g[ff].getFeeitemStatus(),n))&&(u+=g[ff].getFee());return u}function feeQty(e){var t=0,a=aa.fee.getFeeItems(capId,e,null);if(!a.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var r=a.getOutput();for(ff in r)e.equals(r[ff].getFeeCod())&&(t+=r[ff].getFeeUnit());return t}function generateReport(e,t,a,r){var s=currentUserID,n=aa.reportManager.getReportInfoModelByName(t);n=n.getOutput(),n.setModule(a),n.setCapId(e.getCustomID()),n.setReportParameters(r);var i=aa.reportManager.hasPermission(t,s);if(i.getOutput().booleanValue()){var o=aa.reportManager.getReportResult(n);if(o){reportOutput=o.getOutput();var g=aa.reportManager.storeReportToDisk(reportOutput);return g=g.getOutput()}return logDebug("System failed get report: "+o.getErrorType()+":"+o.getErrorMessage()),!1}return logDebug("You have no permission."),!1}function generateReport4Workflow(e,t,a,r){var s=currentUserID,n=aa.reportManager.getReportModelByName(t);n=n.getOutput();var i=aa.reportManager.hasPermission(t,s);if(i.getOutput().booleanValue()){var o=aa.reportManager.runReport(r,n);return o?reportOutput=o.getOutput():(logDebug("System failed get report: "+o.getErrorType()+":"+o.getErrorMessage()),!1)}return logDebug("You have no permission."),!1}function genericTemplateObject(e){this.ASI=new Array,this.ASIT=new Array,this.hasASI=!1,this.hasTables=!1,this.template=e;var t=template.getTemplateForms(),a=new Array;if(null!=t){aa.print(t),a=t.toArray();for(grp in a){var r=a[grp].getSubgroups();if(null!=r){var s=r.toArray();this.hasASI=!0;for(sgrp in s){var n=s[sgrp].getSubgroupName(),o=s[sgrp].getFields().toArray();for(fld in o)this.ASI[n+"."+o[fld].getFieldName()]=o[fld].getDefaultValue()}}}}var g=template.getTemplateTables(),u=new Array;if(null!=g){var u=g.toArray();for(grp in u){var r=u[grp].getSubgroups();if(null!=r){var s=r.toArray();for(sgrp in s){var n=s[sgrp].getSubgroupName();this.ASIT[n]=new Array,this.hasTables=!0;var c=s[sgrp].getRows();if(null!=c){var l=c.toArray();for(i=0;i<l.length;i++){this.ASIT[n][i]=new Array;var o=l[i].getValues().toArray();for(fld in o)this.ASIT[n][i][o[fld].getFieldName()]=o[fld].getValue()}}}}}}return this}function getACADocDownloadParam4Notification(e,t,a){return addParameter(e,"$$acaDocDownloadUrl$$",getACADocumentDownloadUrl(t,a)),e}function getACADocumentDownloadUrl(e,t){var a=aa.document.getACADocumentUrl(e,t);return a.getSuccess()?(acaDocUrl=a.getOutput(),acaDocUrl):(logDebug("Error retrieving ACA Document URL: "+a.getErrorType()),!1)}function getACARecordParam4Notification(e,t){return addParameter(e,"$$acaRecordUrl$$",getACARecordURL(t)),e}function getACARecordURL(e){var t="",a=capId.ID1,r=capId.ID2,s=capId.ID3;return t=e+"/urlrouting.ashx?type=1000",t+="&Module="+cap.getCapModel().getModuleName(),t+="&capID1="+a+"&capID2="+r+"&capID3="+s,t+="&agencyCode="+aa.getServiceProviderCode()}function getACAUrl(){itemCap=capId,1==arguments.length&&(itemCap=arguments[0]);var e="",t=capId.getID1(),a=capId.getID2(),r=capId.getID3(),s=aa.cap.getCap(capId).getOutput().getCapModel();return e+="/urlrouting.ashx?type=1000",e+="&Module="+s.getModuleName(),e+="&capID1="+t+"&capID2="+a+"&capID3="+r,e+="&agencyCode="+aa.getServiceProviderCode()}function getAddressCountyByAddressType(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.address.getAddressByCapId(t);if(!a.getSuccess())return logDebug("Could not return address: "+a.getErrorMessage()),!1;var r=a.getOutput();for(var s in r){var n=r[s];if(null!=n.getAddressType()&&String(n.getAddressType()).toUpperCase().equals(e.toUpperCase()))return n.getCounty()}return logDebug("Could not find an address of type: "+e),!1}function getAddressLineByAddressType(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.address.getAddressByCapId(t);if(!a.getSuccess())return logDebug("Could not return address: "+a.getErrorMessage()),!1;var r=a.getOutput();for(var s in r){var n=r[s];if(null!=n.getAddressType()&&String(n.getAddressType()).toUpperCase().equals(e.toUpperCase()))return n.getDisplayAddress()}return logDebug("Could not find an address of type: "+e),!1}function getAppConditions(e,t,a,r,s){if(null==t)var n=aa.capCondition.getCapConditions(capId);else var n=aa.capCondition.getCapConditions(capId,t);if(n.getSuccess())var i=n.getOutput();else logMessage("**ERROR: getting cap conditions: "+n.getErrorMessage()),logDebug("**ERROR: getting cap conditions: "+n.getErrorMessage());var o,g,u,c="";for(cc in i){{var l=i[cc],o=l.getConditionStatus(),g=l.getConditionDescription(),p=l.getDispPublicDisplayMessage(),u=l.getImpactCode();l.getConditionType()}null==o&&(o=" "),null==g&&(g=" "),null==u&&(u=" "),null!=a&&!a.toUpperCase().equals(o.toUpperCase())||null!=r&&!r.toUpperCase().equals(g.toUpperCase())||null!=s&&!s.toUpperCase().equals(u.toUpperCase())||(c+=g+": "+p)}return addParameter(e,"$$conditions$$",c),e}function getAppIdByASI(e,t,a){var r=a.split("/");4!=r.length&&logDebug("**ERROR: getAppIdByASI in appMatch.  The following Application Type String is incorrectly formatted: "+a);var s=aa.cap.getCapIDsByAppSpecificInfoField(e,t);if(!s.getSuccess())return logDebug("**ERROR: getting caps by app type: "+s.getErrorMessage()),null;var n=s.getOutput();for(aps in n){myCap=aa.cap.getCap(n[aps].getCapID()).getOutput(),myAppTypeString=myCap.getCapType().toString(),myAppTypeArray=myAppTypeString.split("/"),isMatch=!0;for(xx in r)r[xx].equals(myAppTypeArray[xx])||r[xx].equals("*")||(isMatch=!1);if(isMatch)return logDebug("getAppIdByName("+e+","+t+","+a+") Returns "+n[aps].getCapID().toString()),n[aps].getCapID().toString()}}function getAppIdByName(e,t,a){if(getCapResult=aa.cap.getByAppType(e,t),!getCapResult.getSuccess())return logDebug("**ERROR: getting caps by app type: "+getCapResult.getErrorMessage()),null;var r=getCapResult.getOutput();for(aps in r){var s=aa.cap.getCap(r[aps].getCapID()).getOutput();if(s.getSpecialText().equals(a))return logDebug("getAppIdByName("+e+","+t+","+a+") Returns "+r[aps].getCapID().toString()),r[aps].getCapID().toString()}}function getApplication(e){var t=aa.cap.getCapID(e);return t.getSuccess()?t.getOutput():void logDebug("**ERROR: getting cap id ("+e+"): "+t.getErrorMessage())}function getAppSpecific(e){var t=0,a=capId;if(2==arguments.length&&(a=arguments[1]),useAppSpecificGroupName){if(e.indexOf(".")<0)return logDebug("**WARNING: editAppSpecific requires group name prefix when useAppSpecificGroupName is true"),!1;var r=e.substr(0,e.indexOf(".")),e=e.substr(e.indexOf(".")+1)}var s=aa.appSpecificInfo.getByCapID(a);if(s.getSuccess()){var n=s.getOutput();if(""!=e)for(t in n)if(n[t].getCheckboxDesc()==e&&(!useAppSpecificGroupName||n[t].getCheckboxType()==r))return n[t].getChecklistComment()}else logDebug("**ERROR: getting app specific info for Cap : "+s.getErrorMessage())}function getCapByAddress(e){var t=new Array,a=aa.address.getAddressByCapId(capId);if(!a.getSuccess())return logDebug("**ERROR: getting address by cap ID: "+a.getErrorMessage()),!1;var r=a.getOutput();if(!r.length)return logDebug("**WARNING: no address for comparison:"),!1;var s=r[0],n=aa.cap.getCapListByDetailAddress(s.getStreetName(),s.getHouseNumberStart(),s.getStreetSuffix(),s.getZip(),s.getStreetDirection(),null);if(!n.getSuccess())return logDebug("**ERROR: getting similar addresses: "+n.getErrorMessage()),!1;var i=n.getOutput();for(cappy in i){var o=aa.cap.getCap(i[cappy].getCapID()).getOutput();reltype=o.getCapType().toString();var g=!0,u=e.split("/");if(4!=u.length)logDebug("**ERROR: The following Application Type String is incorrectly formatted: "+e);else for(xx in u)u[xx].equals(appTypeArray[xx])||u[xx].equals("*")||(g=!1);g&&t.push(i[cappy])}return t.length>1?(logDebug("**WARNING: Multiple caps returned for this address/apptype"),t[0]):0==t.length?t[0]:void 0}function getCapId(){var e=aa.env.getValue("PermitId1"),t=aa.env.getValue("PermitId2"),a=aa.env.getValue("PermitId3");if(null==e||""==e||null==t||""==t||null==a||""==a)return null;var r=aa.cap.getCapID(e,t,a);return r.getSuccess()?r.getOutput():(logDebug("function getCapID: failed to get capId from script environment: "+r.getErrorMessage()),null)}function getCapsWithConditionsRelatedByRefContact(e,t,a,r,s,n){var i=new Array,o=aa.people.getCapContactByCapID(e).getOutput();for(var g in o){var u=o[g];if(u.getCapContactModel().getRefContactNumber()){var c=(u.getPeople(),aa.people.createPeopleModel().getOutput());c.setContactSeqNumber(u.getCapContactModel().getRefContactNumber());var l=aa.people.getCapIDsByRefContact(c);if(l.getSuccess()){var p=l.getOutput();for(var d in p){var f=p[d];if(appMatch(t,f)){if(null==a)var m=aa.capCondition.getCapConditions(f);else var m=aa.capCondition.getCapConditions(f,a);if(!m.getSuccess())return logMessage("**ERROR: getting cap conditions: "+m.getErrorMessage()),logDebug("**ERROR: getting cap conditions: "+m.getErrorMessage()),!1;var C,b,D,A=m.getOutput();for(cc in A){{var v=A[cc],C=v.getConditionStatus(),b=v.getConditionDescription(),D=v.getImpactCode();v.getConditionType()}null==C&&(C=" "),null==b&&(b=" "),null==D&&(D=" "),null!=r&&!r.toUpperCase().equals(C.toUpperCase())||null!=s&&!s.toUpperCase().equals(b.toUpperCase())||null!=n&&!n.toUpperCase().equals(D.toUpperCase())||i.push(f)}}}}}}}function getChildren(e,t){var a=new Array;if(null!=t)var r=t;else var r=capId;if(arguments.length>2)var s=arguments[2];else var s=null;var n=e.split("/");4!=n.length&&logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+e);var i=aa.cap.getChildByMasterID(r);if(!i.getSuccess())return logDebug("**WARNING: getChildren returned an error: "+i.getErrorMessage()),null;var o=i.getOutput();if(!o.length)return logDebug("**WARNING: getChildren function found no children"),null;var g,u,c,l="";for(xx in o)if(g=o[xx].getCapID(),null==s||!s.getCustomID().equals(g.getCustomID())){l=aa.cap.getCap(g).getOutput().getCapType().toString(),u=l.split("/"),c=!0;for(yy in u)n[yy].equals(u[yy])||n[yy].equals("*")||(c=!1);c&&a.push(g)}return logDebug("getChildren returned "+a.length+" capIds"),a}function getChildTasks(e){var t=new Array,a=null,r=capId;arguments.length>1&&(r=arguments[1]);var s=aa.workflow.getTaskItems(r,e,null,null,null,null),n=s.getOutput();for(i in n){var o=n[i];if(o.getTaskDescription().equals(e)){var g=aa.workflow.getProcessRelationByCapID(r,null).getOutput();for(thisRel in g)y=g[thisRel],y.getParentTaskName()&&y.getParentTaskName().equals(o.getTaskDescription())&&(a=y.getProcessID())}}for(i in n){var o=n[i];o.getProcessID()==a&&t.push(o)}return t}function getCAPConditions(e,t,a,r){var s=new Array,n="en_US",i=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(i.getSuccess()&&(n=i.getOutput().getDescription()),arguments.length>4)var o=arguments[4];else var o=capId;if(null==e)var g=aa.capCondition.getCapConditions(o);else var g=aa.capCondition.getCapConditions(o,e);if(g.getSuccess())var u=g.getOutput();else{var u=new Array;logDebug("**WARNING: getting cap conditions: "+g.getErrorMessage())}var c,l,p;for(cc in u){var d=u[cc],c=d.getConditionStatus(),l=d.getConditionDescription(),p=d.getImpactCode(),f=d.getConditionType(),m=d.getConditionComment(),C=d.getExpireDate();if(null==c&&(c=" "),null==l&&(l=" "),null==p&&(p=" "),(null==t||t.toUpperCase().equals(c.toUpperCase()))&&(null==a||a.toUpperCase().equals(l.toUpperCase()))&&(null==r||r.toUpperCase().equals(p.toUpperCase()))){var b=new condMatchObj;b.objType="Record",b.object=d,b.status=c,b.type=f,b.impact=p,b.description=l,b.comment=m,b.expireDate=C;var D=aa.condition.getCondition(d,n).getOutput();b.arObject=D,b.arDescription=D.getResConditionDescription(),b.arComment=D.getResConditionComment(),s.push(b)}}return s}function getAddressConditions(e,t,a,r){var s=new Array,n="en_US",i=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(i.getSuccess()&&(n=i.getOutput().getDescription()),arguments.length>4)var o=arguments[4];else var o=capId;var g=aa.address.getAddressByCapId(o);if(g.getSuccess()){var u=g.getOutput();u||(u=new Array)}else{logDebug("**WARNING: getting CAP addresses: "+g.getErrorMessage());var u=new Array}for(var c in u)if(u[c].getRefAddressId()){if(addCondResult=aa.addressCondition.getAddressConditions(u[c].getRefAddressId()),addCondResult.getSuccess())var l=addCondResult.getOutput();else{logDebug("**WARNING: getting Address Conditions : "+addCondResult.getErrorMessage());var l=new Array}for(var p in l){var d=l[p],f=d.getConditionType(),m=d.getConditionStatus(),C=d.getConditionDescription(),b=d.getImpactCode(),f=d.getConditionType(),D=d.getConditionComment(),A=d.getExpireDate();if(null==f&&(f=" "),null==m&&(m=" "),null==C&&(C=" "),null==b&&(b=" "),!(null!=e&&!e.toUpperCase().equals(f.toUpperCase())||null!=t&&!t.toUpperCase().equals(m.toUpperCase())||null!=a&&!a.toUpperCase().equals(C.toUpperCase())||null!=r&&!r.toUpperCase().equals(b.toUpperCase()))){var v=new condMatchObj;v.objType="Address",v.addressObj=u[c],v.status=m,v.type=f,v.impact=b,v.description=C,v.comment=D,v.expireDate=A;var y=aa.condition.getCondition(d,n).getOutput();v.arObject=y,v.arDescription=y.getResConditionDescription(),v.arComment=y.getResConditionComment(),s.push(v)}}}return s}function getParcelConditions(e,t,a,r){var s=new Array,n="en_US",i=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(i.getSuccess()&&(n=i.getOutput().getDescription()),arguments.length>4)var o=arguments[4];else var o=capId;var g=aa.parcel.getParcelDailyByCapID(o,null);if(g.getSuccess()){var u=g.getOutput();u||(u=new Array)}else{logDebug("**WARNING: getting CAP addresses: "+g.getErrorMessage());var u=new Array}for(var c in u)if(u[c].getParcelNumber()){if(parcCondResult=aa.parcelCondition.getParcelConditions(u[c].getParcelNumber()),parcCondResult.getSuccess())var l=parcCondResult.getOutput();else{logDebug("**WARNING: getting Parcel Conditions : "+parcCondResult.getErrorMessage());var l=new Array}for(var p in l){var d=l[p],f=d.getConditionType(),m=d.getConditionStatus(),C=d.getConditionDescription(),b=d.getImpactCode(),f=d.getConditionType(),D=d.getConditionComment(),A=d.getExpireDate();if(null==f&&(f=" "),null==m&&(m=" "),null==C&&(C=" "),null==b&&(b=" "),!(null!=e&&!e.toUpperCase().equals(f.toUpperCase())||null!=t&&!t.toUpperCase().equals(m.toUpperCase())||null!=a&&!a.toUpperCase().equals(C.toUpperCase())||null!=r&&!r.toUpperCase().equals(b.toUpperCase()))){var v=new condMatchObj;v.objType="Parcel",v.parcelObj=u[c],v.status=m,v.type=f,v.impact=b,v.description=C,v.comment=D,v.expireDate=A;var y=aa.condition.getCondition(d,n).getOutput();v.arObject=y,v.arDescription=y.getResConditionDescription(),v.arComment=y.getResConditionComment(),s.push(v)}}}return s}function getLicenseConditions(e,t,a,r){var s=new Array,n="en_US",i=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(i.getSuccess()&&(n=i.getOutput().getDescription()),arguments.length>4)var o=arguments[4];else var o=capId;var g=aa.licenseScript.getLicenseProf(o);if(g.getSuccess()){var u=g.getOutput();u||(u=new Array)}else{logDebug("**WARNING: getting CAP licenses: "+g.getErrorMessage());var u=new Array}for(var c in u)if(u[c].getLicenseProfessionalModel().getLicSeqNbr()){var l=aa.caeCondition.getCAEConditions(u[c].getLicenseProfessionalModel().getLicSeqNbr());if(l.getSuccess())var p=l.getOutput();else{logDebug("**WARNING: getting license Conditions : "+l.getErrorMessage());var p=new Array}for(var d in p){var f=p[d],m=f.getConditionType(),C=f.getConditionStatus(),b=f.getConditionDescription(),D=f.getImpactCode(),m=f.getConditionType(),A=f.getConditionComment(),v=f.getExpireDate();if(null==m&&(m=" "),null==C&&(C=" "),null==b&&(b=" "),null==D&&(D=" "),!(null!=e&&!e.toUpperCase().equals(m.toUpperCase())||null!=t&&!t.toUpperCase().equals(C.toUpperCase())||null!=a&&!a.toUpperCase().equals(b.toUpperCase())||null!=r&&!r.toUpperCase().equals(D.toUpperCase()))){var y=new condMatchObj;y.objType="License",y.licenseObj=u[c],y.status=C,y.type=m,y.impact=D,y.description=b,y.comment=A,y.expireDate=v;var h=aa.condition.getCondition(f,n).getOutput();y.arObject=h,y.arDescription=h.getResConditionDescription(),y.arComment=h.getResConditionComment(),s.push(y)}}}return s}function getContactConditions(e,t,a,r){var s=new Array,n="en_US",i=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(i.getSuccess()&&(n=i.getOutput().getDescription()),arguments.length>4)var o=arguments[4];else var o=capId;var g=aa.people.getCapContactByCapID(o);if(g.getSuccess()){var u=g.getOutput();u||(u=new Array)}else{logDebug("**WARNING: getting CAP contact: "+g.getErrorMessage());var u=new Array}for(var c in u)if(u[c].getCapContactModel().getRefContactNumber()){var l=aa.commonCondition.getCommonConditions("CONTACT",u[c].getCapContactModel().getRefContactNumber());if(l.getSuccess())var p=l.getOutput();else{logDebug("**WARNING: getting contact Conditions : "+licCondResult.getErrorMessage());var p=new Array}for(var d in p){var f=p[d],m=f.getConditionType(),C=f.getConditionStatus(),b=f.getConditionDescription(),D=f.getImpactCode(),m=f.getConditionType(),A=f.getConditionComment(),v=f.getExpireDate();if(null==m&&(m=" "),null==C&&(C=" "),null==b&&(b=" "),null==D&&(D=" "),!(null!=e&&!e.toUpperCase().equals(m.toUpperCase())||null!=t&&!t.toUpperCase().equals(C.toUpperCase())||null!=a&&!a.toUpperCase().equals(b.toUpperCase())||null!=r&&!r.toUpperCase().equals(D.toUpperCase()))){var y=new condMatchObj;y.objType="Contact",y.contactObj=u[c],y.status=C,y.type=m,y.impact=D,y.description=b,y.comment=A,y.expireDate=v;var h=aa.condition.getCondition(f,n).getOutput();y.arObject=h,y.arDescription=h.getResConditionDescription(),y.arComment=h.getResConditionComment(),s.push(y)}}}return s}function getConditions(e,t,a,r){var s=getCAPConditions(e,t,a,r),n=getAddressConditions(e,t,a,r);if(n)for(var i=0;i<n.length;i++)s.push(n[i]);var o=getParcelConditions(e,t,a,r);if(o)for(var i=0;i<o.length;i++)s.push(o[i]);var g=getLicenseConditions(e,t,a,r);if(g)for(var i=0;i<g.length;i++)s.push(g[i]);var u=getContactConditions(e,t,a,r);if(u)for(var i=0;i<u.length;i++)s.push(u[i]);return s}function condMatchObj(){this.objType=null,this.object=null,this.contactObj=null,this.addressObj=null,this.licenseObj=null,this.parcelObj=null,this.status=null,this.type=null,this.impact=null,this.description=null,this.comment=null,this.arObject=null,this.arDescription=null,this.arComment=null,this.expireDate=null}function getContactArray(){var e=capId;1==arguments.length&&(e=arguments[0]);var t=new Array;if(0!=arguments.length||cap.isCompleteCap()||"ApplicationSubmitAfter"==controlString){var a=aa.people.getCapContactByCapID(e);if(a.getSuccess())var r=a.getOutput()}else r=cap.getContactsGroup().toArray();if(r)for(yy in r){var s=new Array;s.lastName=r[yy].getPeople().lastName,s.refSeqNumber=r[yy].getCapContactModel().getRefContactNumber(),s.firstName=r[yy].getPeople().firstName,s.middleName=r[yy].getPeople().middleName,s.businessName=r[yy].getPeople().businessName,s.contactSeqNumber=r[yy].getPeople().contactSeqNumber,s.contactType=r[yy].getPeople().contactType,s.relation=r[yy].getPeople().relation,s.phone1=r[yy].getPeople().phone1,s.phone2=r[yy].getPeople().phone2,s.email=r[yy].getPeople().email,s.addressLine1=r[yy].getPeople().getCompactAddress().getAddressLine1(),s.addressLine2=r[yy].getPeople().getCompactAddress().getAddressLine2(),s.city=r[yy].getPeople().getCompactAddress().getCity(),s.state=r[yy].getPeople().getCompactAddress().getState(),s.zip=r[yy].getPeople().getCompactAddress().getZip(),s.fax=r[yy].getPeople().fax,s.notes=r[yy].getPeople().notes,s.country=r[yy].getPeople().getCompactAddress().getCountry(),s.fullName=r[yy].getPeople().fullName,s.peopleModel=r[yy].getPeople();
var n=new Array;if(0!=arguments.length||cap.isCompleteCap())var n=r[yy].getCapContactModel().getPeople().getAttributes().toArray();else{var i=r[yy].getPeople().getAttributes();i&&(n=i.toArray())}for(xx1 in n)s[n[xx1].attributeName]=n[xx1].attributeValue;t.push(s)}return t}function getContactArrayBefore(){var e=aa.env.getValue("ContactList"),t=e.toArray(),a=new Array;if(t)for(yy in t){var r=new Array;r.lastName=t[yy].getPeople().lastName,r.refSeqNumber=t[yy].getRefContactNumber(),r.firstName=t[yy].getPeople().firstName,r.middleName=t[yy].getPeople().middleName,r.businessName=t[yy].getPeople().businessName,r.contactSeqNumber=t[yy].getPeople().contactSeqNumber,r.contactType=t[yy].getPeople().contactType,r.relation=t[yy].getPeople().relation,r.phone1=t[yy].getPeople().phone1,r.phone2=t[yy].getPeople().phone2,r.email=t[yy].getPeople().email,r.addressLine1=t[yy].getPeople().getCompactAddress().getAddressLine1(),r.addressLine2=t[yy].getPeople().getCompactAddress().getAddressLine2(),r.city=t[yy].getPeople().getCompactAddress().getCity(),r.state=t[yy].getPeople().getCompactAddress().getState(),r.zip=t[yy].getPeople().getCompactAddress().getZip(),r.fax=t[yy].getPeople().fax,r.notes=t[yy].getPeople().notes,r.country=t[yy].getPeople().getCompactAddress().getCountry(),r.fullName=t[yy].getPeople().fullName;var s=t[yy].getPeople().getAttributes().toArray();for(xx1 in s)r[s[xx1].attributeName]=s[xx1].attributeValue;a.push(r)}return a}function getContactByType(e,t){var a=getPeople(t);for(thisContact in a)if(a[thisContact].getPeople().contactType.toUpperCase()==e.toUpperCase())return a[thisContact].getPeople();return!1}function getContactObj(e,t){{var a=null;new Array}if("com.accela.aa.aamain.cap.CapModel"==e.getClass())var a=cap.getContactsGroup().toArray();else{var r=aa.people.getCapContactByCapID(e);if(r.getSuccess())var a=r.getOutput()}if(a)for(var s in a)if(a[s].getPeople().contactType.toUpperCase().equals(t.toUpperCase()))return logDebug("getContactObj returned the first contact of type "+t+" on record "+e.getCustomID()),new contactObj(a[s]);return logDebug("getContactObj could not find a contact of type "+t+" on record "+e.getCustomID()),!1}function getContactObjsBySeqNbr(e,t){var a=null,r=aa.people.getCapContactByCapID(e);if(r.getSuccess())var a=r.getOutput();if(a)for(var s in a)if(String(a[s].getPeople().contactSeqNumber).equals(String(t)))return logDebug("getContactObjsBySeqNbr returned the contact on record "+e.getCustomID()),new contactObj(a[s])}function getContactObjs(e){var t=!1;2==arguments.length&&(t=arguments[1]);var a=new Array,r=new Array;if(cap.isCompleteCap()||"ApplicationSubmitAfter"==controlString){var s=aa.people.getCapContactByCapID(e);if(s.getSuccess())var a=s.getOutput()}else if(cap.getApplicantModel()&&(a[0]=cap.getApplicantModel()),cap.getContactsGroup().size()>0){var n=cap.getContactsGroup().toArray();for(ccaa in n)a.push(n[ccaa])}if(a)for(var i in a)(!t||exists(a[i].getPeople().contactType,t))&&r.push(new contactObj(a[i]));return logDebug("getContactObj returned "+r.length+" contactObj(s)"),r}function getContactObjsByCap(){var e=!1;2==arguments.length&&(e=arguments[1]);var t=null,a=new Array,t=cap.getContactsGroup().toArray();if(t)for(var r in t)(!e||exists(t[r].getPeople().contactType,e))&&a.push(new contactObj(t[r]));return logDebug("getContactObj returned "+a.length+" contactObj(s)"),a}function getContactParams4Notification(e,t){contactArray=getContactArray();for(ca in contactArray)thisContact=contactArray[ca],thisContact.contactType==t&&(t=t.toLowerCase(),addParameter(e,"$$"+t+"LastName$$",thisContact.lastName),addParameter(e,"$$"+t+"FirstName$$",thisContact.firstName),addParameter(e,"$$"+t+"MiddleName$$",thisContact.middleName),addParameter(e,"$$"+t+"BusinesName$$",thisContact.businessName),addParameter(e,"$$"+t+"ContactSeqNumber$$",thisContact.contactSeqNumber),addParameter(e,"$$"+t+"$$",thisContact.contactType),addParameter(e,"$$"+t+"Relation$$",thisContact.relation),addParameter(e,"$$"+t+"Phone1$$",thisContact.phone1),addParameter(e,"$$"+t+"Phone2$$",thisContact.phone2),addParameter(e,"$$"+t+"Email$$",thisContact.email),addParameter(e,"$$"+t+"AddressLine1$$",thisContact.addressLine1),addParameter(e,"$$"+t+"AddressLine2$$",thisContact.addressLine2),addParameter(e,"$$"+t+"City$$",thisContact.city),addParameter(e,"$$"+t+"State$$",thisContact.state),addParameter(e,"$$"+t+"Zip$$",thisContact.zip),addParameter(e,"$$"+t+"Fax$$",thisContact.fax),addParameter(e,"$$"+t+"Notes$$",thisContact.notes),addParameter(e,"$$"+t+"Country$$",thisContact.country),addParameter(e,"$$"+t+"FullName$$",thisContact.fullName));return e}function getCSLBInfo(e,t){var a=aa.licenseScript.getLicenseProf(capId);if(!a.getSuccess())return logDebug("**ERROR: getting lic prof: "+a.getErrorMessage()),!1;var r=a.getOutput();if(null==r||!r.length)return logDebug("**WARNING: no licensed professionals on this CAP"),!1;var s=r[0],n=s.getLicenseNbr(),i=aa.httpClient.get("https://www2.cslb.ca.gov/IVR/License+Detail.aspx?LicNum="+n);if(!i.getSuccess())return logDebug("**ERROR: communicating with CSLB: "+i.getErrorMessage()),!1;var o=i.getOutput();if(o.indexOf("<Error>")>0)return logDebug("**ERROR: CSLB information returned an error: "+getNode(getNode(o,"License"),"**ERROR")),!1;{var g=getNode(o,"BusinessInfo");getNode(o,"PrimaryStatus"),getNode(o,"Classifications"),getNode(o,"ContractorBond"),getNode(o,"WorkersComp")}if(t){var u=new Date(getNode(g,"ExpireDt"));u<startDate&&(showMessage=!0,comment("**WARNING: Professional License expired on "+u.toString()))}e&&(s.setAddress1(getNode(g,"Addr1").replace(/\+/g," ")),s.setAddress2(getNode(g,"Addr2").replace(/\+/g," ")),s.setBusinessName(getNode(g,"Name").replace(/\+/g," ")),s.setCity(getNode(g,"City").replace(/\+/g," ")),s.setLicenseExpirDate(aa.date.parseDate(getNode(g,"ExpireDt"))),s.setLicesnseOrigIssueDate(aa.date.parseDate(getNode(g,"IssueDt"))),s.setState(getNode(g,"State").replace(/\+/g," ")),s.setPhone1(getNode(g,"BusinessPhoneNum")),s.setState(getNode(g,"State").replace(/\+/g," ")),s.setZip(getNode(g,"Zip")),aa.m_licenseProfessional.editLicensedProfessional(s))}function getDateDiff(e){var t=new Date(e),a=aa.date.getCurrentDate(),r=dateFormatted(a.getMonth(),a.getDayOfMonth(),a.getYear(),"MM/DD/YYYY"),s=new Date(r),n=parseInt((s-t)/864e5);return n}function getDepartmentName(e){var t=aa.person.getUser(e).getOutput(),a=aa.people.getDepartmentList(null).getOutput();for(var r in a){var s=a[r],n=s.getServiceProviderCode()+"/"+s.getAgencyCode()+"/"+s.getBureauCode()+"/"+s.getDivisionCode()+"/"+s.getSectionCode()+"/"+s.getGroupCode()+"/"+s.getOfficeCode();if(n.equals(t.deptOfUser))return s.getDeptName()}}function getDocumentList(){var e=new Array;return docListResult=aa.document.getCapDocumentList(capId,currentUserID),docListResult.getSuccess()&&(e=docListResult.getOutput()),e}function getGISBufferInfo(e,t,a){var r="feet",s=new Array,n=aa.gis.getGISType(e,t);if(!n.getSuccess())return aa.print("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+n.getErrorType()+":"+n.getErrorMessage()),!1;var i=n.getOutput();for(argnum=3;argnum<arguments.length;argnum++)i.addAttributeName(arguments[argnum]);var o=aa.gis.getCapGISObjects(capId);if(!o.getSuccess())return aa.print("**WARNING: Getting GIS objects for Cap.  Reason is: "+o.getErrorType()+":"+o.getErrorMessage()),!1;var g=o.getOutput();for(a1 in g){var u=aa.gis.getBufferByRadius(g[a1],a,r,i);if(!u.getSuccess())return aa.print("**WARNING: Retrieving Buffer Check Results.  Reason is: "+u.getErrorType()+":"+u.getErrorMessage()),!1;var c=u.getOutput();for(a2 in c){var l=c[a2].getGISObjects();for(z1 in l){var p=l[z1].getAttributeNames(),d=l[z1].getAttributeValues(),f=new Array;f.GIS_ID=l[z1].getGisId();for(n1 in p)f[p[n1]]=d[n1];s.push(f)}}}return s}function getGISInfo(e,t,a){var r,s="feet",n=aa.gis.getGISType(e,t);if(!n.getSuccess())return logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+n.getErrorType()+":"+n.getErrorMessage()),!1;var i=n.getOutput();i.addAttributeName(a);var o=aa.gis.getCapGISObjects(capId);if(!o.getSuccess())return logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+o.getErrorType()+":"+o.getErrorMessage()),!1;var g=o.getOutput();for(a1 in g){var u=aa.gis.getBufferByRadius(g[a1],"0",s,i);if(!u.getSuccess())return logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+u.getErrorType()+":"+u.getErrorMessage()),!1;var c=u.getOutput();for(a2 in c){var l=c[a2].getGISObjects();for(z1 in l){var p=l[z1].getAttributeValues();r=p[0]}}}return r}function getGISInfoArray(e,t,a){var r="feet",s=new Array,n=aa.gis.getGISType(e,t);if(!n.getSuccess())return logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+n.getErrorType()+":"+n.getErrorMessage()),!1;var i=n.getOutput();i.addAttributeName(a);var o=aa.gis.getCapGISObjects(capId);if(!o.getSuccess())return logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+o.getErrorType()+":"+o.getErrorMessage()),!1;var g=o.getOutput();for(a1 in g){var u=aa.gis.getBufferByRadius(g[a1],"0",r,i);if(!u.getSuccess())return logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+u.getErrorType()+":"+u.getErrorMessage()),!1;var c=u.getOutput();for(a2 in c){var l=c[a2].getGISObjects();for(z1 in l){var p=l[z1].getAttributeValues();s.push(p[0])}}}return s}function getGuideSheetObjects(e){var t=new Array,r=capId;2==arguments.length&&(r=arguments[1]);var s=aa.inspection.getInspections(r);if(s.getSuccess()){var n=s.getOutput();for(i in n)if(n[i].getIdNumber()==e){var o=n[i].getInspection(),g=o.getGuideSheets();if(g){gsArray=g.toArray();for(var u in gsArray){a=gsArray[u];var c=gsArray[u].getItems().toArray();for(var l in c){var p=new guideSheetObject(gsArray[u],c[l]);t.push(p)}}}else logDebug("No guidesheets for this inspection")}}return logDebug("loaded "+t.length+" guidesheet items"),t}function getInspector(e){var t=aa.inspection.getInspections(capId);if(t.getSuccess()){inspList=t.getOutput();for(xx in inspList)if(String(e).equals(inspList[xx].getInspectionType()))return inspUserObj=aa.person.getUser(inspList[xx].getInspector().getFirstName(),inspList[xx].getInspector().getMiddleName(),inspList[xx].getInspector().getLastName()).getOutput(),inspUserObj.getUserID()}return!1}function getLastInspector(e){var t=aa.inspection.getInspections(capId);if(t.getSuccess()){inspList=t.getOutput(),inspList.sort(compareInspDateDesc);for(xx in inspList)if(String(e).equals(inspList[xx].getInspectionType())&&!inspList[xx].getInspectionStatus().equals("Scheduled"))return inspUserObj=aa.person.getUser(inspList[xx].getInspector().getFirstName(),inspList[xx].getInspector().getMiddleName(),inspList[xx].getInspector().getLastName()).getOutput(),inspUserObj.getUserID()}return null}function compareInspDateDesc(e,t){return null==e.getScheduledDate()&&null==t.getScheduledDate()?!1:null==e.getScheduledDate()&&null!=t.getScheduledDate()?!0:null!=e.getScheduledDate()&&null==t.getScheduledDate()?!1:e.getScheduledDate().getEpochMilliseconds()<t.getScheduledDate().getEpochMilliseconds()}function getLastScheduledInspector(e){var t=aa.inspection.getInspections(capId);if(t.getSuccess()){inspList=t.getOutput(),inspList.sort(compareInspDateDesc);for(xx in inspList)if(String(e).equals(inspList[xx].getInspectionType())&&inspList[xx].getInspectionStatus().equals("Scheduled"))return inspUserObj=aa.person.getUser(inspList[xx].getInspector().getFirstName(),inspList[xx].getInspector().getMiddleName(),inspList[xx].getInspector().getLastName()).getOutput(),inspUserObj.getUserID()}return null}function getLicenseProfessional(e){capLicenseArr=null;var t=aa.licenseProfessional.getLicenseProf(e);return t.getSuccess()?(capLicenseArr=t.getOutput(),(null==capLicenseArr||0==capLicenseArr.length)&&(aa.print("WARNING: no licensed professionals on this CAP:"+e),capLicenseArr=null)):(aa.print("ERROR: Failed to license professional: "+t.getErrorMessage()),capLicenseArr=null),capLicenseArr}function getNode(e,t){var a="",r="<"+t+">",s="</"+t+">";return startPos=e.indexOf(r)+r.length,endPos=e.indexOf(s),startPos>0&&startPos<endPos&&(a=e.substring(startPos,endPos)),unescape(a)}function getParent(){return getCapResult=aa.cap.getProjectParents(capId,1),getCapResult.getSuccess()?(parentArray=getCapResult.getOutput(),parentArray.length?parentArray[0].getCapID():(logDebug("**WARNING: GetParent found no project parent for this application"),!1)):(logDebug("**WARNING: getting project parents:  "+getCapResult.getErrorMessage()),!1)}function getParentByCapId(e){return getCapResult=aa.cap.getProjectParents(e,1),getCapResult.getSuccess()?(parentArray=getCapResult.getOutput(),parentArray.length?parentArray[0].getCapID():(logDebug("**WARNING: GetParent found no project parent for this application"),!1)):(logDebug("**WARNING: getting project parents:  "+getCapResult.getErrorMessage()),!1)}function getParentCapID4Renewal(){parentLic=getParentLicenseCapID(capId),pLicArray=String(parentLic).split("-");var e=aa.cap.getCapID(pLicArray[0],pLicArray[1],pLicArray[2]).getOutput();return e}function getParentLicenseCapID(e){if(null==e||aa.util.instanceOfString(e))return null;var t=null,a=aa.cap.getProjectByChildCapID(e,"Renewal",null);if(a.getSuccess()&&(licenseProjects=a.getOutput(),null!=licenseProjects&&licenseProjects.length>0))return licenseProject=licenseProjects[0],licenseProject.getProjectID();var r=aa.cap.getProjectByChildCapID(e,"EST",null);return r.getSuccess()&&(projectScriptModels=r.getOutput(),null!=projectScriptModels&&projectScriptModels.length>0)?(projectScriptModel=projectScriptModels[0],t=projectScriptModel.getProjectID()):(logDebug("**WARNING: Could not find parent license Cap for child CAP("+e+"): "),!1)}function getParents(e){for(var t=1;;){if(!aa.cap.getProjectParents(capId,t).getSuccess())break;t+=1}if(t-=1,getCapResult=aa.cap.getProjectParents(capId,t),myArray=new Array,getCapResult.getSuccess()){if(parentArray=getCapResult.getOutput(),parentArray.length){for(x in parentArray)null!=e?appMatch(e,parentArray[x].getCapID())&&myArray.push(parentArray[x].getCapID()):myArray.push(parentArray[x].getCapID());return myArray}return logDebug("**WARNING: GetParent found no project parent for this application"),null}return logDebug("**WARNING: getting project parents:  "+getCapResult.getErrorMessage()),null}function getPartialCapID(e){if(null==e||aa.util.instanceOfString(e))return null;var t=aa.cap.getProjectByChildCapID(e,"EST",null);return t.getSuccess()?(projectScriptModels=t.getOutput(),null==projectScriptModels||0==projectScriptModels.length?(aa.print("ERROR: Failed to get partial CAP with CAPID("+e+")"),null):(projectScriptModel=projectScriptModels[0],projectScriptModel.getProjectID())):(aa.print("ERROR: Failed to get partial CAP by child CAP("+e+"): "+t.getErrorMessage()),null)}function getPeople(e){capPeopleArr=null;var t=aa.people.getCapContactByCapID(e);if(t.getSuccess())if(capPeopleArr=t.getOutput(),null!=capPeopleArr||capPeopleArr.length>0)for(loopk in capPeopleArr){var a=capPeopleArr[loopk],r=a.getCapContactModel(),s=a.getPeople(),n=aa.address.getContactAddressListByCapContact(r);if(n.getSuccess()){var i=convertContactAddressModelArr(n.getOutput());s.setContactAddressList(i)}}else aa.print("WARNING: no People on this CAP:"+e),capPeopleArr=null;else aa.print("ERROR: Failed to People: "+t.getErrorMessage()),capPeopleArr=null;return capPeopleArr}function getPrimaryAddressLineParam4Notification(e){return adResult=aa.address.getPrimaryAddressByCapID(capId,"Y"),adResult.getSuccess()&&(ad=adResult.getOutput().getAddressModel(),addParameter(e,"$$addressLine$$",ad.getDisplayAddress())),e}function getPrimaryOwnerParams4Notification(e){if(capOwnerResult=aa.owner.getOwnerByCapId(capId),capOwnerResult.getSuccess()){owner=capOwnerResult.getOutput();for(o in owner)if(thisOwner=owner[o],"Y"==thisOwner.getPrimaryOwner()){addParameter(e,"$$ownerFullName$$",thisOwner.getOwnerFullName()),addParameter(e,"$$ownerPhone$$",thisOwner.getPhone);break}}return e}function getProp(e,t){var a="",r=t+"='",s="'";return startPos=e.indexOf(r)+r.length,startPos>0&&(a=e.substring(startPos)),endPos=a.indexOf(s),endPos>0&&(a=a.substring(0,endPos)),unescape(a)}function getRecordParams4Notification(e){return addParameter(e,"$$altID$$",capIDString),addParameter(e,"$$capName$$",capName),addParameter(e,"$$capStatus$$",capStatus),addParameter(e,"$$fileDate$$",fileDate),addParameter(e,"$$balanceDue$$","$"+parseFloat(balanceDue).toFixed(2)),e}function getRefLicenseProf(e){var t=null,a=aa.licenseScript.getRefLicensesProfByLicNbr(aa.getServiceProviderCode(),e);if(!a.getSuccess())return logDebug("**ERROR retrieving Ref Lic Profs : "+a.getErrorMessage()),!1;var r=a.getOutput();if(!r)return null;for(var s in r)e&&r[s]&&e.toUpperCase().equals(r[s].getStateLicense().toUpperCase())&&(t=r[s]);return t}function getRelatedCapsByAddress(e){var t=new Array,a=aa.address.getAddressByCapId(capId);if(!a.getSuccess())return logDebug("**ERROR: getting address by cap ID: "+a.getErrorMessage()),!1;var r=a.getOutput();for(zzz in r){var s=r[zzz];if(capAddResult=aa.cap.getCapListByDetailAddress(s.getStreetName(),s.getHouseNumberStart(),s.getStreetSuffix(),null,s.getStreetDirection(),null),!capAddResult.getSuccess())return logDebug("**ERROR: getting similar addresses: "+capAddResult.getErrorMessage()),!1;var n=capAddResult.getOutput();for(cappy in n)if(!capId.getCustomID().equals(n[cappy].getCustomID())){var i=aa.cap.getCap(n[cappy].getCapID()).getOutput(),o=i.getCapType().toString().split("/"),g=!0,u=e.split("/");if(4!=u.length)logDebug("**ERROR: The following Application Type String is incorrectly formatted: "+e);else for(xx in u)u[xx].equals(o[xx])||u[xx].equals("*")||(g=!1);g&&t.push(n[cappy])}}return t.length>0?t:void 0}function getRelatedCapsByParcel(e){var t=new Array,a=aa.parcel.getParcelandAttribute(capId,null);if(!a.getSuccess())return logDebug("**ERROR: getting parcels by cap ID: "+a.getErrorMessage()),!1;var r=a.getOutput().toArray();for(zz in r){var s=r[zz].getParcelNumber(),n=aa.cap.getCapListByParcelID(s,null);if(!n.getSuccess())return logDebug("**ERROR: getting similar parcels: "+n.getErrorMessage()),!1;var i=n.getOutput();for(cappy in i)if(!capId.getCustomID().equals(i[cappy].getCustomID())){var o=aa.cap.getCap(i[cappy].getCapID()).getOutput(),g=o.getCapType().toString().split("/"),u=!0,c=e.split("/");if(4!=c.length)logDebug("**ERROR: The following Application Type String is incorrectly formatted: "+e);else for(xx in c)c[xx].equals(g[xx])||c[xx].equals("*")||(u=!1);u&&t.push(i[cappy])}}return t.length>0?t:void 0}function getRenewalCapByParentCapIDForReview(e){if(null==e||aa.util.instanceOfString(e))return null;var t=aa.cap.getProjectByMasterID(e,"Renewal","Review");return t.getSuccess()?(projectScriptModels=t.getOutput(),null==projectScriptModels||0==projectScriptModels.length?(aa.print("ERROR: Failed to get renewal CAP by parent CAPID("+e+") for review"),null):(projectScriptModel=projectScriptModels[0],projectScriptModel)):(aa.print("ERROR: Failed to get renewal CAP by parent CAP("+e+") for review: "+t.getErrorMessage()),null)}function getReportedChannel(){var e=capId;arguments.length>0&&(e=arguments[0]);var t=aa.cap.getCapDetail(e);if(!t.getSuccess())return logDebug("**ERROR: No cap detail script object : "+t.getErrorMessage()),!1;var a=t.getOutput();if(!a)return logDebug("**ERROR: No cap detail script object"),!1;cd=a.getCapDetailModel();var r=cd.getReportedChannel();return null!=r?r:""}function getRootNode(e,t){if(t>9)return e;var a=t+1,r=e,s=aa.cap.getProjectByChildCapID(r,"R",null);if(s.getSuccess()){directParents=s.getOutput();for(var n in directParents)if(directParents[n]){for(directParents[n].getProjectID().getID1(),directParents[n].getProjectID().getID2(),directParents[n].getProjectID().getID3();!isSameNode(r,directParents[n].getProjectID());)r=getRootNode(directParents[n].getProjectID(),a)}}return r}function getRoots(e){var t=new Array,a=aa.cap.getProjectByChildCapID(e,"R",null);if(a.getSuccess()){tmpdirectParents=a.getOutput();for(ff in tmpdirectParents)if(tmpdirectParents[ff]){var r=getRootNode(tmpdirectParents[ff].getProjectID(),1),s=r.getID1(),n=r.getID2(),i=r.getID3(),o=aa.cap.getCapID(s,n,i).getOutput();t.push(o)}}return t}function getScheduledInspId(e){var t=aa.inspection.getInspections(capId);if(t.getSuccess()){var a=t.getOutput();for(xx in a)if(String(e).equals(a[xx].getInspectionType())&&a[xx].getInspectionStatus().toUpperCase().equals("SCHEDULED"))return a[xx].getIdNumber()}return!1}function getScriptAction(e){var t=new Array,a=(String(""+maxEntries).length,aa.bizDomain.getBizDomain(e));if(a.getSuccess()){bizDomScriptArray=a.getOutput().toArray();for(var r in bizDomScriptArray){var s=new pairObj(bizDomScriptArray[r].getBizdomainValue());s.load(bizDomScriptArray[r].getDescription()),"I"==bizDomScriptArray[r].getAuditStatus()&&(s.enabled=!1),t.push(s)}}return t}function getScriptAction_v1_6(e){for(var t=new Array,a=String(""+maxEntries).length,r=1;r<=maxEntries;r++){var s="000000"+r;s=String(s).substring(s.length,s.length-a);var n=aa.bizDomain.getBizDomainByValue(e,s);if(!n.getSuccess())break;bizDomScriptObj=n.getOutput();var i=new pairObj(bizDomScriptObj.getBizdomainValue());i.load(bizDomScriptObj.getDescription()),"I"==bizDomScriptObj.getAuditStatus()&&(i.enabled=!1),t.push(i)}return t}function getScriptText(e,t,a){t||(t=aa.getServiceProviderCode()),e=e.toUpperCase();var r=aa.proxyInvoker.newInstance("com.accela.aa.emse.emse.EMSEBusiness").getOutput();try{if(a)var s=r.getMasterScript(aa.getServiceProviderCode(),e);else var s=r.getScriptByPK(aa.getServiceProviderCode(),e,"ADMIN");return s.getScriptText()+""}catch(n){return""}}function getShortNotes(){var e=capId;arguments.length>0&&(e=arguments[0]);var t=aa.cap.getCapDetail(e);if(!t.getSuccess())return logDebug("**ERROR: No cap detail script object : "+t.getErrorMessage()),!1;var a=t.getOutput();if(!a)return logDebug("**ERROR: No cap detail script object"),!1;cd=a.getCapDetailModel();var r=cd.getShortNotes();return null!=r?r:""}function getTaskDueDate(e){var t=!1,a="";2==arguments.length&&(a=arguments[1],t=!0);var r=e;"*"==e&&(r="");var s=aa.workflow.getTaskItems(capId,r,a,null,null,null);if(!s.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=s.getOutput();for(i in wfObj){var n=wfObj[i];if((n.getTaskDescription().toUpperCase().equals(e.toUpperCase())||"*"==e)&&(!t||n.getProcessCode().equals(a))){var o=wfObj[i].getDueDate();if(o)return new Date(o.getMonth()+"/"+o.getDayOfMonth()+"/"+o.getYear())}}}function getTaskStatusForEmail(e){var t="",a=aa.workflow.getTaskItems(capId,null,e,"Y",null,null);if(!a.getSuccess())return logDebug("**ERROR: getting tasks : "+a.getErrorMessage()),!1;var r=a.getOutput();for(xx in r)r[xx].getProcessCode().equals(e)&&r[xx].getCompleteFlag().equals("Y")&&(t+="Task Name: "+r[xx].getTaskDescription()+"\n",t+="Task Status: "+r[xx].getDisposition()+"\n",null!=r[xx].getDispositionComment()&&(t+="Task Comments: "+r[xx].getDispositionComment()+"\n"),t+="\n");return logDebug(t),t}function getURLToNewRecord(e,t,a,r,s,n){var i=aa.proxyInvoker.newInstance("com.accela.aa.aamain.servicemanagement.ServiceManagementBusiness").getOutput(),o=aa.proxyInvoker.newInstance("com.accela.aa.aamain.servicemanagement.ServiceModel").getOutput(),g=aa.cap.getCapTypeModel().getOutput();g.setGroup(a),g.setType(r),g.setSubType(s),g.setCategory(n),o.setCapType(g),o.setServPorvCode(t);var u=i.getServices(o).toArray();for(var c in u)return e+"/AgencyRedirect.aspx?agency="+t+"&name="+escape(u[c].getServiceName());return!1}function getUserEmail(){var e=currentUserID;arguments.length>0&&(e=arguments[0]);var t=aa.person.getUser(e.toUpperCase());if(t.getSuccess()){var a=t.getOutput(),r=a.getEmail();return r?r:!1}return aa.print(t.getErrorMessage()),!1}function getUserFullName(){var e=currentUserID;arguments.length>0&&(e=arguments[0]);var t=aa.person.getUser(e.toUpperCase());if(t.getSuccess()){var a=t.getOutput(),r=(a.getEmail(),"");return matches(a.getFirstName(),null,void 0,"")||(r=a.getFirstName()),matches(a.getLastName(),null,void 0,"")||(r+=" "+a.getLastName()),""!=r?r:!1}return logDebug(t.getErrorMessage()),!1}function guideSheetObject(e,t){this.gsType=e.getGuideType(),this.gsSequence=e.getGuidesheetSeqNbr(),this.gsDescription=e.getGuideDesc(),this.gsIdentifier=e.getIdentifier(),this.item=t,this.text=t.getGuideItemText(),this.status=t.getGuideItemStatus(),this.comment=t.getGuideItemComment(),this.score=t.getGuideItemScore(),this.info=new Array,this.infoTables=new Array,this.validTables=!1,this.validInfo=!1,this.loadInfo=function(){var e=this.item.getItemASISubgroupList();if(null!=e){this.validInfo=!0;for(var t=e.iterator();t.hasNext();){var a=t.next(),r=a.getAsiList();if(null!=r)for(var s=r.iterator();s.hasNext();){var n=s.next();this.info[n.getAsiName()]=n.getAttributeValue()}}}},this.loadInfoTables=function(){var e=this.item.getItemASITableSubgroupList();if(null!=e)for(var t=0;t<e.size();t++){for(var a=e.get(t),r=new Array,s=a.getColumnList(),n=0;n<s.size();n++)for(var i=s.get(n),o=i.getValueMap().values(),g=o.iterator();g.hasNext();){var u=g.next(),c=u.getRowIndex()-1;null==r[c]&&(r[c]=new Array),r[c][i.getColumnName()]=u.getAttributeValue()}this.infoTables[""+a.getTableName()]=r,this.validTables=!0}}}function handleError(e,t){var a=!0,r=!0;r&&(showDebug=!0),logDebug((a?"**ERROR** ":"ERROR: ")+e.message+" In "+t+" Line "+e.lineNumber),logDebug("Stack: "+e.stack)}function hasPrimaryAddressInCap(e){var t=!1,a=aa.address.getAddressByCapId(e);if(a.getSuccess()){var r=a.getOutput();for(k in r)if("Y"==r[k].getPrimaryFlag()){t=!0,logDebug("Target CAP has primary address");break}}else logMessage("**ERROR: Failed to get addresses: "+a.getErrorMessage());return t}function xmlEscapeXMLToHTML(e){var t,a=e;for(t=-1;a.indexOf("&",t+1)>-1;){var t=a.indexOf("&",t+1),r=a.substr(0,t);r+="&",r+=a.substr(t+1,a.length),a=r}for(t=-1;a.indexOf("<",t+1)>-1;){var t=a.indexOf("<",t+1),r=a.substr(0,t);r+="&lt;",r+=a.substr(t+1,a.length),a=r}for(t=-1;a.indexOf(">",t+1)>-1;){var t=a.indexOf(">",t+1),r=a.substr(0,t);r+="&gt;",r+=a.substr(t+1,a.length),a=r}for(t=-1;a.indexOf("\n",t+1)>-1;){var t=a.indexOf("\n",t+1),r=a.substr(0,t);r+="<br>",r+=a.substr(t+1,a.length),a=r}return a}function include(s){try{var thisDate=new Date,thisTime=thisDate.getTime(),st=getScriptText(s);st.length&&(logDebug("Executing script : "+s+", Elapsed Time: "+(thisTime-startTime)/1e3+" Seconds"),eval(st))}catch(err){handleError(err,s)}}function insertSubProcess(e,t,a){var r=capId,s=null;arguments.length>3&&(r=arguments[3]);var n=aa.workflow.getTaskItems(r,e,null,null,null,null);if(!n.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=n.getOutput();for(var i in wfObj)e.toUpperCase().equals(wfObj[i].getTaskDescription().toUpperCase())&&(s=wfObj[i]);if(s){var o=aa.workflow.insertSubProcess(s,t,a);return o.getSuccess()?(logDebug("attached subprocess "+t+" to "+e),!0):(logDebug("error "+o.getErrorMessage()),!1)}return logDebug("couldn't find task "+e),!1}function insertTask(e,t,a){itemCap=capId,arguments.length>3&&(itemCap=arguments[3]);var r;insertPType="P";var s=aa.workflow.getTask(capId,e);s.getSuccess()?(r=s.getOutput(),aa.print("get task successful : task name = "+r.getTaskDescription()+"; Process name = "+r.getProcessCode())):aa.print("ERROR: Failed to get task! Path = "+e+";"+s.getErrorMessage()),r.setTaskDescription(t);var n=aa.workflow.insertTask(r,a);if(!n.getSuccess())return aa.print("ERROR: Failed to insert task! Path = "+taskPath+";"+n.getErrorMessage()),!1;var i=r.getProcessID(),o=r.getStepNumber(),s=aa.workflow.getTask(capId,o,i);return s.getSuccess()?(r=s.getOutput(),aa.print("insert task successful : inserted task name = "+r.getTaskDescription()+"; Process name = "+r.getProcessCode()),r):(aa.print("ERROR: Failed to get task! Path = "+taskPath+";"+s.getErrorMessage()),!1)}function inspCancelAll(){var e=!1,t=aa.inspection.getInspections(capId);if(t.getSuccess()){var a,r,s=t.getOutput();for(ii in s)s[ii].getDocumentDescription().equals("Insp Scheduled")&&s[ii].getAuditStatus().equals("A")&&(a=s[ii].getIdNumber(),r=aa.inspection.cancelInspection(capId,a),r.getSuccess()?(logMessage("Cancelling inspection: "+s[ii].getInspectionType()),e=!0):logMessage("**ERROR","**ERROR: Cannot cancel inspection: "+s[ii].getInspectionType()+", "+r.getErrorMessage()))}else logMessage("**ERROR: getting inspections: "+t.getErrorMessage());return e}function invoiceFee(e,t){var a=!1;if(getFeeResult=aa.finance.getFeeItemsByFeeCodeAndPeriod(capId,e,t,"NEW"),getFeeResult.getSuccess()){var r=getFeeResult.getOutput();for(feeNum in r)if(r[feeNum].getFeeitemStatus().equals("NEW")){var s=r[feeNum].getFeeSeqNbr();feeSeqList.push(s),paymentPeriodList.push(t),a=!0,logDebug("Assessed fee "+e+" found and tagged for invoicing")}}else logDebug("**ERROR: getting fee items ("+e+"): "+getFeeResult.getErrorMessage());return a}function isBlank(e){return!e||/^\s*$/.test(e)}function isEmpty(e){return!e||0===e.length}function isBlank(e){return!e||/^\s*$/.test(e)}function getRoots(e){var t=new Array,a=aa.cap.getProjectByChildCapID(e,"R",null);if(a.getSuccess()){tmpdirectParents=a.getOutput();for(ff in tmpdirectParents)if(tmpdirectParents[ff]){var r=getRootNode(tmpdirectParents[ff].getProjectID(),1),s=r.getID1(),n=r.getID2(),i=r.getID3(),o=aa.cap.getCapID(s,n,i).getOutput();t.push(o)}}return t}function isSameNode(e,t){return null==e||void 0==e||null==t||void 0==t?!1:e.getID1()==t.getID1()&&e.getID2()==t.getID2()&&e.getID3()==t.getID3()}function getRootNode(e,t){if(t>9)return e;var a=t+1,r=e,s=aa.cap.getProjectByChildCapID(r,"R",null);if(s.getSuccess()){directParents=s.getOutput();for(var n in directParents)if(directParents[n]){for(directParents[n].getProjectID().getID1(),directParents[n].getProjectID().getID2(),directParents[n].getProjectID().getID3();!isSameNode(r,directParents[n].getProjectID());)r=getRootNode(directParents[n].getProjectID(),a)}}return r}function isMatchPeople(e,t){if(null==e||null==t)return!1;var a=e.getCapContactModel().getPeople().getContactType(),r=t.getCapContactModel().getPeople().getContactType(),s=e.getCapContactModel().getPeople().getFirstName(),n=t.getCapContactModel().getPeople().getFirstName(),i=e.getCapContactModel().getPeople().getLastName(),o=t.getCapContactModel().getPeople().getLastName(),g=e.getCapContactModel().getPeople().getFullName(),u=t.getCapContactModel().getPeople().getFullName();return null==a&&null!=r||null!=a&&null==r?!1:null==a||a.equals(r)?null==s&&null!=n||null!=s&&null==n?!1:null==s||s.equals(n)?null==i&&null!=o||null!=i&&null==o?!1:null==i||i.equals(o)?null==g&&null!=u||null!=g&&null==u?!1:null==g||g.equals(u)?!0:!1:!1:!1:!1}function isReadyRenew(e){if(null==e||aa.util.instanceOfString(e))return!1;var t=aa.expiration.isExpiredLicenses(e);return t.getSuccess()?!0:(logDebug("ERROR: Failed to get expiration with CAP("+e+"): "+t.getErrorMessage()),!1)}function isRenewProcess(e,t){if(null==e||null==t)return logDebug("ERROR: the parentCapID or the partialCap ID is null"),!1;var a=aa.cap.getCap(t);return a.getSuccess()?(capScriptModel=a.getOutput(),capScriptModel.isCompleteCap()?(logDebug("ERROR: It is not partial CAP("+capScriptModel.getCapID()+")"),!1):(a=aa.cap.getProjectByMasterID(e,"Renewal","Incomplete"),a.getSuccess()&&(partialProjects=a.getOutput(),null!=partialProjects&&partialProjects.length>0)?(logDebug("Warning: Renewal process was initiated before. ( "+e+")"),!1):isReadyRenew(e))):(logDebug("ERROR: Fail to get CAPModel ("+t+"): "+a.getErrorMessage()),!1)}function isSameNode(e,t){return null==e||void 0==e||null==t||void 0==t?!1:e.getID1()==t.getID1()&&e.getID2()==t.getID2()&&e.getID3()==t.getID3()}function isScheduled(e){var t=!1,a=aa.inspection.getInspections(capId);if(a.getSuccess()){var r=a.getOutput();for(xx in r)String(e).equals(r[xx].getInspectionType())&&(t=!0)}return t}function isTaskActive(e){var t=!1,a="";2==arguments.length&&(a=arguments[1],t=!0);var r=aa.workflow.getTaskItems(capId,e,a,null,null,"Y");
if(!r.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=r.getOutput();for(i in wfObj)if(fTask=wfObj[i],fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!t||fTask.getProcessCode().equals(a)))return fTask.getActiveFlag().equals("Y")?!0:!1}function isTaskComplete(e){var t=!1,a="";2==arguments.length&&(a=arguments[1],t=!0);var r=aa.workflow.getTaskItems(capId,e,a,"Y",null,null);if(!r.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=r.getOutput();for(i in wfObj)if(fTask=wfObj[i],fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!t||fTask.getProcessCode().equals(a)))return fTask.getCompleteFlag().equals("Y")?!0:!1}function isTaskStatus(e,t){var a=!1,r="";arguments.length>2&&(r=arguments[2],a=!0);var s=aa.workflow.getTaskItems(capId,e,r,null,t,null);if(!s.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var n=s.getOutput();for(i in n)if(fTask=n[i],fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!a||fTask.getProcessCode().equals(r))&&null!=fTask.getDisposition())return fTask.getDisposition().toUpperCase().equals(t.toUpperCase())?!0:!1;return!1}function jsDateToASIDate(e){if(null!=e){if(Date.prototype.isPrototypeOf(e)){var t=""+(e.getMonth()+1),a="0"+t;a=a.substring(a.length-2,a.length);var r=""+e.getDate(),s="0"+r;s=s.substring(s.length-2,s.length);var n=""+e.getFullYear();return a+"/"+s+"/"+n}return logDebug("Parameter is not a javascript date"),"INVALID JAVASCRIPT DATE"}return logDebug("Parameter is null"),"NULL PARAMETER VALUE"}function jsDateToMMDDYYYY(e){return null!=e?Date.prototype.isPrototypeOf(e)?(e.getMonth()+1).toString()+"/"+e.getDate()+"/"+e.getFullYear():(logDebug("Parameter is not a javascript date"),"INVALID JAVASCRIPT DATE"):(logDebug("Parameter is null"),"NULL PARAMETER VALUE")}function licEditExpInfo(e,t){var a=new licenseObject(null);null!=e&&a.setStatus(e),null!=t&&a.setExpiration(t)}function licenseObject(e){if(itemCap=capId,2==arguments.length&&(itemCap=arguments[1]),this.refProf=null,this.b1Exp=null,this.b1ExpDate=null,this.b1ExpCode=null,this.b1Status=null,this.refExpDate=null,this.licNum=e,e){var t=getRefLicenseProf(e);t&&(this.refProf=t,tmpDate=t.getLicenseExpirationDate(),tmpDate&&(this.refExpDate=tmpDate.getMonth()+"/"+tmpDate.getDayOfMonth()+"/"+tmpDate.getYear()),logDebug("Loaded reference license professional with Expiration of "+this.refExpDate))}return b1ExpResult=aa.expiration.getLicensesByCapID(itemCap),b1ExpResult.getSuccess()?(this.b1Exp=b1ExpResult.getOutput(),tmpDate=this.b1Exp.getExpDate(),tmpDate&&(this.b1ExpDate=tmpDate.getMonth()+"/"+tmpDate.getDayOfMonth()+"/"+tmpDate.getYear()),this.b1Status=this.b1Exp.getExpStatus(),logDebug("Found renewal record of status : "+this.b1Status+", Expires on "+this.b1ExpDate),this.setExpiration=function(e){var t=aa.date.parseDate(e);this.refProf&&(this.refProf.setLicenseExpirationDate(t),aa.licenseScript.editRefLicenseProf(this.refProf),logDebug("Updated reference license expiration to "+e)),this.b1Exp&&(this.b1Exp.setExpDate(t),aa.expiration.editB1Expiration(this.b1Exp.getB1Expiration()),logDebug("Updated renewal to "+e))},this.setIssued=function(e){var t=aa.date.parseDate(e);this.refProf&&(this.refProf.setLicenseIssueDate(t),aa.licenseScript.editRefLicenseProf(this.refProf),logDebug("Updated reference license issued to "+e))},this.setLastRenewal=function(e){var t=aa.date.parseDate(e);this.refProf&&(this.refProf.setLicenseLastRenewalDate(t),aa.licenseScript.editRefLicenseProf(this.refProf),logDebug("Updated reference license issued to "+e))},this.setStatus=function(e){this.b1Exp&&(this.b1Exp.setExpStatus(e),aa.expiration.editB1Expiration(this.b1Exp.getB1Expiration()),logDebug("Updated renewal to status "+e))},this.getStatus=function(){return this.b1Exp?this.b1Exp.getExpStatus():void 0},void(this.getCode=function(){return this.b1Exp?this.b1Exp.getExpCode():void 0})):(logDebug("**ERROR: Getting B1Expiration Object for Cap.  Reason is: "+b1ExpResult.getErrorType()+":"+b1ExpResult.getErrorMessage()),!1)}function licenseProfObject(e,t){this.refLicModel=null,this.infoTableGroupCodeObj=null,this.infoTableSubGroupCodesObj=null,this.infoTables=new Array,this.attribs=new Array,this.valid=!1,this.validTables=!1,this.validAttrs=!1;var a=aa.licenseScript.getRefLicensesProfByLicNbr(aa.getServiceProviderCode(),e);if(a.getSuccess()){var r=a.getOutput();if(null==t&&(t=""),null!=r)for(lic in r)if(r[lic].getLicenseType().toUpperCase()==t.toUpperCase()||""==t){this.refLicModel=r[lic],""==t&&(t=this.refLicModel.getLicenseType());break}}if(null!=this.refLicModel&&(this.infoTableGroupCodeObj=this.refLicModel.getInfoTableGroupCodeModel(),null==this.infoTableGroupCodeObj)){var s=aa.licenseProfessional.getLicenseProfessionScriptModel().getOutput();if(null!=s.getInfoTableGroupCodeModel()){s.getInfoTableGroupCodeModel().setServProvCode(aa.getServiceProviderCode()),s.getInfoTableGroupCodeModel().setCategory(1),s.getInfoTableGroupCodeModel().setReferenceId(""),s.getInfoTableGroupCodeModel().setName(t.toUpperCase());var n=aa.licenseProfessional.getRefInfoTableGroupCode(s).getOutput();if(null!=n){n.setReferenceId(this.refLicModel.getLicSeqNbr()),s.setInfoTableGroupCodeModel(n),aa.licenseProfessional.createRefInfoTable(s);var r=null;r=aa.licenseScript.getRefLicensesProfByLicNbr(aa.getServiceProviderCode(),e).getOutput();for(lic in r)if(r[lic].getLicenseType().toUpperCase()==t.toUpperCase()){this.refLicModel=r[lic];break}this.infoTableGroupCodeObj=this.refLicModel.getInfoTableGroupCodeModel()}}}if(null!=this.infoTableGroupCodeObj){var r=this.infoTableGroupCodeObj.getSubgroups();null!=r&&(this.infoTableSubGroupCodesObj=r.toArray())}if(this.validTables=null!=this.infoTableSubGroupCodesObj,this.valid=null!=this.refLicModel,this.refreshTables=function(){if(this.validTables)for(tbl in this.infoTableSubGroupCodesObj){var e=new Array,t=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(null!=t){t=t.toArray();for(column in t){var a=t[column].getTableValues();if(null!=a){a=a.toArray(),a.sort(function(e,t){return e.getRowNumber()-t.getRowNumber()});for(var r=0;r<a.length;r++)a[r].setRowNumber(r),null==e[r]&&(e[r]=new Array),e[r][t[column].getName()]=a[r]}}}this.infoTables[this.infoTableSubGroupCodesObj[tbl].getName()]=e}},this.refreshTables(),this.getMaxRowByTable=function(e){var t=-1;if(this.validTables){var a=this.infoTables[e];if(null!=a)for(row in a)for(col in a[row])t<parseInt(a[row][col].getRowNumber())&&(t=parseInt(a[row][col].getRowNumber()))}return t},this.addTableRow=function(e,t){{var a=!1;new Array}if(this.validTables)for(tbl in this.infoTableSubGroupCodesObj)if(this.infoTableSubGroupCodesObj[tbl].getName()==e){var r=this.getMaxRowByTable(e)+1,s=this.infoTableSubGroupCodesObj[tbl].getColumnDefines().toArray(),n=0;s.sort(function(e,t){return parseInt(e.getDisplayOrder())-parseInt(t.getDisplayOrder())});for(col in s){var i=aa.licenseProfessional.getLicenseProfessionScriptModel().getOutput().getInfoTableValueModel();i.setAuditStatus("A"),i.setServProvCode(aa.getServiceProviderCode()),i.setColumnNumber(n++),i.setAuditDate(s[col].getAuditDate()),i.setAuditId("undefined"!=typeof currentUserID?currentUserID:"ADMIN"),i.setInfoId(s[col].getId()),i.setRowNumber(r);for(val in t)val.toString().toUpperCase()==s[col].getName().toString().toUpperCase()&&i.setValue(t[val].toString());s[col].addTableValue(i),a=!0}this.refreshTables()}return a},this.addTableFromASIT=function(e,t){var a=!0;if(this.validTables)for(row in t)this.addTableRow(e,t[row])||(a=!1);else a=!1;return a},this.removeTableRow=function(e,t){var a=!1;if(this.validTables)for(tbl in this.infoTableSubGroupCodesObj)if(this.infoTableSubGroupCodesObj[tbl].getName()==e){var r=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(null!=r){r=r.toArray();for(column in r){var s=r[column].getTableValues();if(null!=s&&(s=s.toArray(),t<=s.length)){var n=aa.util.newArrayList();for(row in s)s[row].getRowNumber()!=t?n.add(s[row]):a=!0;r[column].setTableValues(n)}}}break}return a},this.removeTable=function(e){var t=!1;if(this.validTables)for(tbl in this.infoTableSubGroupCodesObj)if(this.infoTableSubGroupCodesObj[tbl].getName()==e){var a=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(null!=a){a=a.toArray();for(column in a){var r=a[column].getTableValues();if(null!=r){var s=aa.util.newArrayList();a[column].setTableValues(s),t=!0}}}break}return t},this.setTableEnabledFlag=function(e,t,a){var r=!1,s=null;if(s=this.infoTables[e],null!=s&&null!=s[t])for(col in s[t])s[t][col].setAuditStatus(a?"A":"I"),r=!0;return r},this.setDisplayInACA4Table=function(e,t){var a=!1;if(this.validTables)for(tbl in this.infoTableSubGroupCodesObj)if(this.infoTableSubGroupCodesObj[tbl].getName()==e){var r=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(null!=r){r=r.toArray();for(column in r)r[column].setDisplayLicVeriForACA(t),a=!0}if(a){var s=aa.util.newArrayList();for(col in r)s.add(r[col]);this.infoTableSubGroupCodesObj[tbl].setColumnDefines(s)}break}return a},this.valid){var i=this.refLicModel.getAttributes();if(null!=i){var o=i.values(),g=o.iterator();if(g.hasNext()){var u=g.next().toArray();for(x in u)this.attribs[u[x].getAttributeLabel().toUpperCase()]=u[x];this.validAttrs=!0}}}return this.getAttribute=function(e){var t=null;if(this.validAttrs){var a=this.attribs[e.toString().toUpperCase()];null!=a&&(t=a.getAttributeValue())}return t},this.setAttribute=function(e,t){var a=!1;if(this.validAttrs){var r=this.attribs[e.toString().toUpperCase()];null!=r&&(r.setAttributeValue(t),a=!0)}return a},this.updateFromRecordContactByType=function(e,t,a,r){if(this.retVal=!1,this.valid){var s=new Array,n=aa.people.getCapContactByCapID(e);n.getSuccess()?s=n.getOutput():retVal=!1;for(contact in s)if(t.toString().toUpperCase()==s[contact].getPeople().getContactType().toString().toUpperCase()||""==t.toString()&&"Y"==s[contact].getPeople().getFlag()){cont=s[contact],peop=cont.getPeople(),addr=peop.getCompactAddress(),this.refLicModel.setContactFirstName(cont.getFirstName()),this.refLicModel.setContactMiddleName(peop.getMiddleName()),this.refLicModel.setContactLastName(cont.getLastName()),this.refLicModel.setBusinessName(peop.getBusinessName()),a&&(this.refLicModel.setAddress1(addr.getAddressLine1()),this.refLicModel.setAddress2(addr.getAddressLine2()),this.refLicModel.setAddress3(addr.getAddressLine3()),this.refLicModel.setCity(addr.getCity()),this.refLicModel.setState(addr.getState()),this.refLicModel.setZip(addr.getZip())),r&&(this.refLicModel.setPhone1(peop.getPhone1()),this.refLicModel.setPhone2(peop.getPhone2()),this.refLicModel.setPhone3(peop.getPhone3()),this.refLicModel.setEMailAddress(peop.getEmail()),this.refLicModel.setFax(peop.getFax())),this.refLicModel.setAgencyCode(aa.getServiceProviderCode()),this.refLicModel.setAuditDate(sysDate),this.refLicModel.setAuditID(currentUserID),this.refLicModel.setAuditStatus("A"),retVal=!0;break}}return retVal},this.updateFromAddress=function(e){if(this.retVal=!1,this.valid){var t=aa.address.getAddressByCapId(e),a=null;if(t.getSuccess()){Address=t.getOutput();for(yy in Address)if("Y"==Address[yy].getPrimaryFlag()){a=Address[yy],logDebug("Target CAP has primary address");break}null==a&&(a=Address[0])}else logMessage("**ERROR: Failed to get addresses: "+t.getErrorMessage());if(null!=a){var r=a.getAddressLine1();null==r&&(r=a.getHouseNumberStart(),r+=null!=a.getStreetDirection()?" "+a.getStreetDirection():"",r+=null!=a.getStreetName()?" "+a.getStreetName():"",r+=null!=a.getStreetSuffix()?" "+a.getStreetSuffix():"",r+=null!=a.getUnitType()?" "+a.getUnitType():"",r+=null!=a.getUnitStart()?" "+a.getUnitStart():""),this.refLicModel.setAddress1(r),this.refLicModel.setAddress2(a.getAddressLine2()),this.refLicModel.setCity(a.getCity()),this.refLicModel.setState(a.getState()),this.refLicModel.setZip(a.getZip()),retVal=!0}else retVal=!1}return retVal},this.updateFromRecordLicensedProf=function(){var e=!1;if(this.valid){var t=aa.licenseProfessional.getLicenseProf(capId),a=new Array;t.getSuccess()?a=t.getOutput():e=!1;for(capLic in a)a[capLic].getLicenseNbr()+""==this.refLicModel.getStateLicense()+""&&a[capLic].getLicenseType()+""==this.refLicModel.getLicenseType()+""&&(licProfScriptModel=a[capLic],this.refLicModel.setAddress1(licProfScriptModel.getAddress1()),this.refLicModel.setAddress2(licProfScriptModel.getAddress2()),this.refLicModel.setAddress3(licProfScriptModel.getAddress3()),this.refLicModel.setAgencyCode(licProfScriptModel.getAgencyCode()),this.refLicModel.setAuditDate(licProfScriptModel.getAuditDate()),this.refLicModel.setAuditID(licProfScriptModel.getAuditID()),this.refLicModel.setAuditStatus(licProfScriptModel.getAuditStatus()),this.refLicModel.setBusinessLicense(licProfScriptModel.getBusinessLicense()),this.refLicModel.setBusinessName(licProfScriptModel.getBusinessName()),this.refLicModel.setCity(licProfScriptModel.getCity()),this.refLicModel.setCityCode(licProfScriptModel.getCityCode()),this.refLicModel.setContactFirstName(licProfScriptModel.getContactFirstName()),this.refLicModel.setContactLastName(licProfScriptModel.getContactLastName()),this.refLicModel.setContactMiddleName(licProfScriptModel.getContactMiddleName()),this.refLicModel.setContryCode(licProfScriptModel.getCountryCode()),this.refLicModel.setCountry(licProfScriptModel.getCountry()),this.refLicModel.setEinSs(licProfScriptModel.getEinSs()),this.refLicModel.setEMailAddress(licProfScriptModel.getEmail()),this.refLicModel.setFax(licProfScriptModel.getFax()),this.refLicModel.setLicOrigIssDate(licProfScriptModel.getLicesnseOrigIssueDate()),this.refLicModel.setPhone1(licProfScriptModel.getPhone1()),this.refLicModel.setPhone2(licProfScriptModel.getPhone2()),this.refLicModel.setSelfIns(licProfScriptModel.getSelfIns()),this.refLicModel.setState(licProfScriptModel.getState()),this.refLicModel.setLicState(licProfScriptModel.getState()),this.refLicModel.setSuffixName(licProfScriptModel.getSuffixName()),this.refLicModel.setWcExempt(licProfScriptModel.getWorkCompExempt()),this.refLicModel.setZip(licProfScriptModel.getZip()),this.refLicModel.setFein(licProfScriptModel.getFein()),this.refLicModel.setPhone3(licProfScriptModel.getPhone3()),this.refLicModel.setBusinessName2(licProfScriptModel.getBusName2()),e=!0)}return e},this.copyToRecord=function(e,t){var a=!1;if(this.valid){var r=aa.licenseProfessional.getLicenseProf(e),s=new Array,n=!1;if(r.getSuccess()&&(s=r.getOutput()),null!=s)for(capLic in s)if(s[capLic].getLicenseNbr()+""==this.refLicModel.getStateLicense()+""&&s[capLic].getLicenseType()+""==this.refLicModel.getLicenseType()+""){if(t){aa.licenseProfessional.removeLicensedProfessional(s[capLic]);break}n=!0}if(!n&&(capListResult=aa.licenseScript.associateLpWithCap(e,this.refLicModel),a=capListResult.getSuccess(),this.validTables&&a)){var i=aa.licenseProfessional.getLicenseProfessionScriptModel().getOutput();this.infoTableGroupCodeObj.setCapId1(e.getID1()),this.infoTableGroupCodeObj.setCapId2(e.getID2()),this.infoTableGroupCodeObj.setCapId3(e.getID3());var o=this.infoTableGroupCodeObj.getReferenceId(),g=this.infoTableGroupCodeObj.getReferenceType(),u=this.infoTableGroupCodeObj.getReferenceDesc();this.infoTableGroupCodeObj.setReferenceId(this.refLicModel.getStateLicense()),this.infoTableGroupCodeObj.setReferenceType(this.refLicModel.getLicenseType()),this.infoTableGroupCodeObj.setReferenceDesc("Description"),this.infoTableGroupCodeObj.setCategory(1),i.setInfoTableGroupCodeModel(this.infoTableGroupCodeObj),aa.licenseProfessional.createInfoTable(i),this.infoTableGroupCodeObj.setCapId1(null),this.infoTableGroupCodeObj.setCapId2(null),this.infoTableGroupCodeObj.setCapId3(null),this.infoTableGroupCodeObj.setReferenceId(o),this.infoTableGroupCodeObj.setReferenceType(g),this.infoTableGroupCodeObj.setReferenceDesc(u)}}return a},this.enable=function(){this.refLicModel.setAuditStatus("A")},this.disable=function(){this.refLicModel.setAuditStatus("I")},this.getAssociatedRecords=function(){var e=new Array;if(this.valid){var t=aa.licenseScript.getCapIDsByLicenseModel(this.refLicModel);if(t.getSuccess()){var a=t.getOutput();null!=a&&(e=a)}}return e},this.updateRecord=function(){var e=!1;if(this.valid){this.refreshTables();var t=aa.licenseScript.editRefLicenseProf(this.refLicModel);e=t.getSuccess()}return e},this}function linkPublicUserToContact(){var e,t,a,r="Applicant";arguments.length>0&&(r=arguments[0]);var s=aa.people.getCapContactByCapID(capId);if(s.getSuccess()){var n=s.getOutput();for(yy in n)r.equals(n[yy].getCapContactModel().getPeople().getContactType())&&(e=n[yy])}if(!e)return logDebug("Couldn't link public user for "+r+", no such contact"),!1;if(e.getPeople().getContactTypeFlag().equals("organization"))return logDebug("Couldn't link public user for "+r+", the contact is an organization"),!1;t=e.getCapContactModel().getRefContactNumber();var i=aa.publicUser.getPublicUserByPUser(publicUserID);return i.getSuccess()&&i.getOutput()?(a=i.getOutput(),logDebug("linkPublicUserToContact: Found an existing public user: "+a.getUserID()),t&&(logDebug("linkPublicUserToContact: Linking this public user with reference contact : "+t),aa.licenseScript.associateContactWithPublicUser(a.getUserSeqNum(),t)),a):(logDebug("Couldn't link public user for "+r+", no such public user"),!1)}function loadAddressAttributes(e){var t=capId;2==arguments.length&&(t=arguments[1]);var a=null,r=aa.address.getAddressWithAttributeByCapId(t);if(r.getSuccess())var a=r.getOutput();else logDebug("**ERROR: Failed to get Address object: "+r.getErrorType()+":"+r.getErrorMessage());for(i in a){addressAttrObj=a[i].getAttributes().toArray();for(z in addressAttrObj)e["AddressAttribute."+addressAttrObj[z].getB1AttributeName()]=addressAttrObj[z].getB1AttributeValue();e["AddressAttribute.PrimaryFlag"]=a[i].getPrimaryFlag(),e["AddressAttribute.HouseNumberStart"]=a[i].getHouseNumberStart(),e["AddressAttribute.StreetDirection"]=a[i].getStreetDirection(),e["AddressAttribute.StreetName"]=a[i].getStreetName(),e["AddressAttribute.StreetSuffix"]=a[i].getStreetSuffix(),e["AddressAttribute.City"]=a[i].getCity(),e["AddressAttribute.State"]=a[i].getState(),e["AddressAttribute.Zip"]=a[i].getZip(),e["AddressAttribute.AddressStatus"]=a[i].getAddressStatus(),e["AddressAttribute.County"]=a[i].getCounty(),e["AddressAttribute.Country"]=a[i].getCountry(),e["AddressAttribute.AddressDescription"]=a[i].getAddressDescription(),e["AddressAttribute.XCoordinate"]=a[i].getXCoordinator(),e["AddressAttribute.YCoordinate"]=a[i].getYCoordinator()}}function loadAddressAttributes4ACA(e){if(fcapAddressObj=cap.getAddressModel(),!fcapAddressObj)return logDebug("No Address to get attributes"),!1;if(addressAttr=fcapAddressObj.getAttributes(),!addressAttr)return logDebug("No attributes on this address"),!1;addressAttrObj=addressAttr.toArray();for(z in addressAttrObj)e["AddressAttribute."+addressAttrObj[z].getB1AttributeName()]=addressAttrObj[z].getB1AttributeValue();e["AddressAttribute.PrimaryFlag"]=fcapAddressObj.getPrimaryFlag(),e["AddressAttribute.HouseNumberStart"]=fcapAddressObj.getHouseNumberStart(),e["AddressAttribute.StreetDirection"]=fcapAddressObj.getStreetDirection(),e["AddressAttribute.StreetName"]=fcapAddressObj.getStreetName(),e["AddressAttribute.StreetSuffix"]=fcapAddressObj.getStreetSuffix(),e["AddressAttribute.City"]=fcapAddressObj.getCity(),e["AddressAttribute.State"]=fcapAddressObj.getState(),e["AddressAttribute.Zip"]=fcapAddressObj.getZip(),e["AddressAttribute.AddressStatus"]=fcapAddressObj.getAddressStatus(),e["AddressAttribute.County"]=fcapAddressObj.getCounty(),e["AddressAttribute.Country"]=fcapAddressObj.getCountry(),e["AddressAttribute.AddressDescription"]=fcapAddressObj.getAddressDescription(),e["AddressAttribute.XCoordinate"]=fcapAddressObj.getXCoordinator(),e["AddressAttribute.YCoordinate"]=fcapAddressObj.getYCoordinator()}function loadAppSpecific(e){var t=capId;2==arguments.length&&(t=arguments[1]);var a=aa.appSpecificInfo.getByCapID(t);if(a.getSuccess()){var r=a.getOutput();for(loopk in r)useAppSpecificGroupName?e[r[loopk].getCheckboxType()+"."+r[loopk].checkboxDesc]=r[loopk].checklistComment:e[r[loopk].checkboxDesc]=r[loopk].checklistComment}}function loadAppSpecific4ACA(e){var t=capId;if(arguments.length>=2){t=arguments[1];var a=aa.appSpecificInfo.getByCapID(t).getOutput();for(loopk in a)useAppSpecificGroupName?e[a[loopk].getCheckboxType()+"."+a[loopk].checkboxDesc]=a[loopk].checklistComment:e[a[loopk].checkboxDesc]=a[loopk].checklistComment}else{var r=cap.getAppSpecificInfoGroups();if(r)for(var s=cap.getAppSpecificInfoGroups().iterator();s.hasNext();){var n=s.next(),i=n.getFields();if(null!=i)for(var o=i.iterator();o.hasNext();){var g=o.next();useAppSpecificGroupName?e[g.getCheckboxType()+"."+g.getCheckboxDesc()]=g.getChecklistComment():e[g.getCheckboxDesc()]=g.getChecklistComment()}}else logDebug("No ASI for the CapModel")}}function loadAppSpecific4Contact(e,t){var a=capId;3==arguments.length&&(a=arguments[2]);var r=aa.people.getCapContactByPK(a,t);if(r.getSuccess()){var s=r.getOutput().getCapContactModel();if(null==s||null==s.getTemplate()||null==s.getTemplate().getTemplateForms())return;for(var n=s.getTemplate(),i=n.getTemplateForms(),o=0;o<i.size();o++){var g=i.get(o),u=g.subgroups;if(null!=u)for(var c=0;c<u.size();c++){var l=u.get(c);if(null!=l&&null!=l.fields)for(var p=l.fields,d=0;d<p.size();d++){var f=p.get(d);e[f.displayFieldName]=f.defaultValue}}}}}function loadASITable(e){var t=capId;2==arguments.length&&(t=arguments[1]);for(var a=aa.appSpecificTableScript.getAppSpecificTableGroupModel(t).getOutput(),r=a.getTablesArray(),s=r.iterator();s.hasNext();){var n=s.next(),i=n.getTableName();if(i.equals(e)){if(n.rowIndex.isEmpty())return logDebug("Couldn't load ASI Table "+e+" it is empty"),!1;for(var o=new Array,g=new Array,u=n.getTableField().iterator(),c=n.getColumns().iterator(),l=n.getAppSpecificTableModel().getReadonlyField().iterator(),p=1;u.hasNext();){if(!c.hasNext()){var c=n.getColumns().iterator();g.push(o);var o=new Array;p++}var d=c.next(),f=u.next(),m="N";l.hasNext()&&(m=l.next());var C=new asiTableValObj(d.getColumnName(),f,m);o[d.getColumnName()]=C}g.push(o)}}return g}function loadASITables(){var itemCap=capId;1==arguments.length&&(itemCap=arguments[0]);for(var gm=aa.appSpecificTableScript.getAppSpecificTableGroupModel(itemCap).getOutput(),ta=gm.getTablesArray(),tai=ta.iterator();tai.hasNext();){var tsm=tai.next(),tempObject=new Array,tempArray=new Array,tn=tsm.getTableName(),numrows=0;if(tn=String(tn).replace(/[^a-zA-Z0-9]+/g,""),isNaN(tn.substring(0,1))||(tn="TBL"+tn),!tsm.rowIndex.isEmpty()){for(var tsmfldi=tsm.getTableField().iterator(),tsmcoli=tsm.getColumns().iterator(),readOnlyi=tsm.getAppSpecificTableModel().getReadonlyField().iterator(),numrows=1;tsmfldi.hasNext();){if(!tsmcoli.hasNext()){var tsmcoli=tsm.getColumns().iterator();tempArray.push(tempObject);var tempObject=new Array;numrows++}var tcol=tsmcoli.next(),tval=tsmfldi.next(),readOnly="N";readOnlyi.hasNext()&&(readOnly=readOnlyi.next());var fieldInfo=new asiTableValObj(tcol.getColumnName(),tval,readOnly);tempObject[tcol.getColumnName()]=fieldInfo}tempArray.push(tempObject)}var copyStr=""+tn+" = tempArray";logDebug("ASI Table Array : "+tn+" ("+numrows+" Rows)"),eval(copyStr)}}function loadASITables4ACA(){var itemCap=capId;if(1==arguments.length){itemCap=arguments[0];var gm=aa.appSpecificTableScript.getAppSpecificTableGroupModel(itemCap).getOutput()}else var gm=cap.getAppSpecificTableGroupModel();for(var ta=gm.getTablesMap(),tai=ta.values().iterator();tai.hasNext();){var tsm=tai.next();if(!tsm.rowIndex.isEmpty()){var tempObject=new Array,tempArray=new Array,tn=tsm.getTableName();tn=String(tn).replace(/[^a-zA-Z0-9]+/g,""),isNaN(tn.substring(0,1))||(tn="TBL"+tn);for(var tsmfldi=tsm.getTableField().iterator(),tsmcoli=tsm.getColumns().iterator(),numrows=1;tsmfldi.hasNext();){if(!tsmcoli.hasNext()){var tsmcoli=tsm.getColumns().iterator();tempArray.push(tempObject);var tempObject=new Array;numrows++}var tcol=tsmcoli.next(),tval=tsmfldi.next().getInputValue();tempObject[tcol.getColumnName()]=tval}tempArray.push(tempObject);var copyStr=""+tn+" = tempArray";logDebug("ASI Table Array : "+tn+" ("+numrows+" Rows)"),eval(copyStr)}}}function loadASITablesBefore(){var gm=aa.env.getValue("AppSpecificTableGroupModel"),gmItem=gm;if(gmItem=null!=gm&&"undefined"!=typeof gm.size&&gm.size()>0?gm.get(0):gm,null!=gmItem&&""!=gmItem)for(var ta=gmItem.getTablesMap().values(),tai=ta.iterator();tai.hasNext();){var tsm=tai.next();if(!tsm.rowIndex.isEmpty()){var tempObject=new Array,tempArray=new Array,tn=tsm.getTableName(),numrows=0;if(tn=String(tn).replace(/[^a-zA-Z0-9]+/g,""),isNaN(tn.substring(0,1))||(tn="TBL"+tn),!tsm.rowIndex.isEmpty()){for(var tsmfldi=tsm.getTableField().iterator(),tsmcoli=tsm.getColumns().iterator(),numrows=1;tsmfldi.hasNext();){if(!tsmcoli.hasNext()){var tsmcoli=tsm.getColumns().iterator();tempArray.push(tempObject);var tempObject=new Array;numrows++}var tcol=tsmcoli.next(),tval=tsmfldi.next(),readOnly="N",fieldInfo=new asiTableValObj(tcol.getColumnName(),tval,readOnly);tempObject[tcol.getColumnName()]=fieldInfo}tempArray.push(tempObject)}var copyStr=""+tn+" = tempArray";aa.print("ASI Table Array : "+tn+" ("+numrows+" Rows)"),eval(copyStr)}}}function loadFees(){var e=capId;if(arguments.length>0)if(ltcapidstr=arguments[0],"string"==typeof ltcapidstr){var t=aa.cap.getCapID(ltcapidstr);if(!t.getSuccess())return logMessage("**ERROR: Failed to get cap ID: "+ltcapidstr+" error: "+t.getErrorMessage()),!1;e=t.getOutput()}else e=ltcapidstr;var a=new Array,r=aa.fee.getFeeItems(e);if(!r.getSuccess())return logDebug("**ERROR: getting fee items: "+r.getErrorMessage()),!1;var s=r.getOutput();for(ff in s){fFee=s[ff];var n=new Fee,i=0,o=aa.finance.getPaymentFeeItems(e,null);if(o.getSuccess()){var g=o.getOutput();for(ij in g)fFee.getFeeSeqNbr()==g[ij].getFeeSeqNbr()&&(i+=g[ij].getFeeAllocation())}n.sequence=fFee.getFeeSeqNbr(),n.code=fFee.getFeeCod(),n.sched=fFee.getF4FeeItemModel().getFeeSchudle(),n.description=fFee.getFeeDescription(),n.unit=fFee.getFeeUnit(),n.amount=fFee.getFee(),n.amountPaid=i,fFee.getApplyDate()&&(n.applyDate=convertDate(fFee.getApplyDate())),fFee.getEffectDate()&&(n.effectDate=convertDate(fFee.getEffectDate())),fFee.getExpireDate()&&(n.expireDate=convertDate(fFee.getExpireDate())),n.status=fFee.getFeeitemStatus(),n.period=fFee.getPaymentPeriod(),n.display=fFee.getDisplay(),n.accCodeL1=fFee.getAccCodeL1(),n.accCodeL2=fFee.getAccCodeL2(),n.accCodeL3=fFee.getAccCodeL3(),n.formula=fFee.getFormula(),n.udes=fFee.getUdes(),n.UDF1=fFee.getUdf1(),n.UDF2=fFee.getUdf2(),n.UDF3=fFee.getUdf3(),n.UDF4=fFee.getUdf4(),n.subGroup=fFee.getSubGroup(),n.calcFlag=fFee.getCalcFlag(),n.calcProc=fFee.getFeeCalcProc(),n.version=fFee.getF4FeeItemModel().getVersion(),a.push(n)}return a}function Fee(){this.sequence=null,this.code=null,this.description=null,this.unit=null,this.amount=null,this.amountPaid=null,this.applyDate=null,this.effectDate=null,this.expireDate=null,this.status=null,this.recDate=null,this.period=null,this.display=null,this.accCodeL1=null,this.accCodeL2=null,this.accCodeL3=null,this.formula=null,this.udes=null,this.UDF1=null,this.UDF2=null,this.UDF3=null,this.UDF4=null,this.subGroup=null,this.calcFlag=null,this.calcProc=null,this.auditDate=null,this.auditID=null,this.auditStatus=null,this.version=null}function loadGuideSheetItems(e){var t=new Array,a=capId;2==arguments.length&&(a=arguments[1]);var r=aa.inspection.getInspections(a);if(r.getSuccess()){var s=r.getOutput();for(i in s)if(s[i].getIdNumber()==e){var n=s[i].getInspection(),o=n.getGuideSheets();if(o){gsArray=o.toArray();for(var g in gsArray){var u=gsArray[g].getItems().toArray();for(var c in u)t[u[c].getGuideItemText()]=u[c].getGuideItemStatus()}}else logDebug("No guidesheets for this inspection")}}return logDebug("loaded "+t.length+" guidesheet items"),t}function loadParcelAttributes(e){var t=capId;2==arguments.length&&(t=arguments[1]);var a=null,r=aa.parcel.getParcelandAttribute(t,null);if(r.getSuccess())var a=r.getOutput().toArray();else logDebug("**ERROR: Failed to get Parcel object: "+r.getErrorType()+":"+r.getErrorMessage());for(i in a){parcelArea+=a[i].getParcelArea(),parcelAttrObj=a[i].getParcelAttribute().toArray();for(z in parcelAttrObj)e["ParcelAttribute."+parcelAttrObj[z].getB1AttributeName()]=parcelAttrObj[z].getB1AttributeValue();e["ParcelAttribute.Block"]=a[i].getBlock(),e["ParcelAttribute.Book"]=a[i].getBook(),e["ParcelAttribute.CensusTract"]=a[i].getCensusTract(),e["ParcelAttribute.CouncilDistrict"]=a[i].getCouncilDistrict(),e["ParcelAttribute.ExemptValue"]=a[i].getExemptValue(),e["ParcelAttribute.ImprovedValue"]=a[i].getImprovedValue(),e["ParcelAttribute.InspectionDistrict"]=a[i].getInspectionDistrict(),e["ParcelAttribute.LandValue"]=a[i].getLandValue(),e["ParcelAttribute.LegalDesc"]=a[i].getLegalDesc(),e["ParcelAttribute.Lot"]=a[i].getLot(),e["ParcelAttribute.MapNo"]=a[i].getMapNo(),e["ParcelAttribute.MapRef"]=a[i].getMapRef(),e["ParcelAttribute.ParcelStatus"]=a[i].getParcelStatus(),e["ParcelAttribute.SupervisorDistrict"]=a[i].getSupervisorDistrict(),e["ParcelAttribute.Tract"]=a[i].getTract(),e["ParcelAttribute.PlanArea"]=a[i].getPlanArea()}}function loadTasks(e){if("string"==typeof e){var t=aa.cap.getCapID(e);if(!t.getSuccess())return logMessage("**ERROR: Failed to get cap ID: "+e+" error: "+t.getErrorMessage()),!1;ltCapId=t.getOutput()}else ltCapId=e;var a=new Array,r=aa.workflow.getTasks(ltCapId);if(!r.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=r.getOutput();for(i in wfObj){fTask=wfObj[i];var s=new Task;s.status=fTask.getDisposition(),s.comment=fTask.getDispositionComment(),s.process=fTask.getProcessCode(),fTask.getStatusDate()&&(s.statusdate=""+(fTask.getStatusDate().getMonth()+1)+"/"+fTask.getStatusDate().getDate()+"/"+(fTask.getStatusDate().getYear()+1900)),s.processID=fTask.getProcessID(),s.note=fTask.getDispositionNote(),s.step=fTask.getStepNumber(),s.active=fTask.getActiveFlag(),a[fTask.getTaskDescription()]=s}return a}function Task(){this.status=null,this.comment=null,this.note=null,this.statusdate=null,this.process=null,this.processID=null,this.step=null,this.active=null}function loadTaskSpecific(e){var t=capId;2==arguments.length&&(t=arguments[1]);var a=aa.workflow.getTasks(t);if(!a.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+a.getErrorMessage()),!1;var r=a.getOutput();for(i in r){var s=r[i],n=s.getStepNumber(),o=s.getProcessID(),g=aa.taskSpecificInfo.getTaskSpecificInfoByTask(t,o,n);if(g.getSuccess()){var u=g.getOutput();for(a1 in u)useTaskSpecificGroupName?e[s.getProcessCode()+"."+s.getTaskDescription()+"."+u[a1].getCheckboxDesc()]=u[a1].getChecklistComment():e[u[a1].getCheckboxDesc()]=u[a1].getChecklistComment()}}}function logDebug(e){vLevel=1,arguments.length>1&&(vLevel=arguments[1]),((showDebug&vLevel)==vLevel||1==vLevel)&&(debug+=e+br),(showDebug&vLevel)==vLevel&&aa.debug(aa.getServiceProviderCode()+" : "+aa.env.getValue("CurrentUserID"),e)}function logGlobals(e){for(loopGlob in e)logDebug("{"+loopGlob+"} = "+e[loopGlob])}function logMessage(e){message+=e+br}function lookup(e,t){var a,r=aa.bizDomain.getBizDomainByValue(e,t);if(r.getSuccess()){var s=r.getOutput();a=""+s.getDescription(),logDebug("lookup("+e+","+t+") = "+a)}else logDebug("lookup("+e+","+t+") does not exist");return a}function lookupDateRange(e,t){var a=1;3==arguments.length&&(a=arguments[2]);for(var r,s=new Date(t),n=1;9999>=n;n++){var i="0000"+n,i=String(i).substring(i.length,i.length-4),o=aa.bizDomain.getBizDomainByValue(e,i);if(!o.getSuccess()){if(r)return r[a];break}var g=o.getOutput(),u=g.getDescription();if("I"!=g.getAuditStatus()){var c=r,r=u.split("\\^"),l=new Date(r[0]);if(l>=s){if(c)return c[a];break}}}}function lookupFeesByValuation(e,t,a){var r=1;4==arguments.length&&(r=arguments[3]);var s,n=lookup(e,t);if(n){workArr=n.split("^");
for(var i in workArr){if(aa.print(workArr[i]),workVals=workArr[i].split("|"),workVals[0]>a)return s;1==r?s=workVals[r]:(s=parseInt((a-workVals[0])/100),(a-workVals[0])%100>0&&s++,s*=workVals[r])}}return s}function lookupFeesByValuationSlidingScale(e,t,a){var r=2;4==arguments.length&&(r=arguments[3]+1);var s,n=lookup(e,t);if(n){workArr=n.split("^");for(var i in workArr){if(aa.print(workArr[i]),workVals=workArr[i].split("|"),workVals[0]>a)return s;if(2==r)s=workVals[r];else{var o=workVals[1];s=parseInt((a-workVals[0])/o),(a-workVals[0])%o>0&&s++,s*=workVals[r]}}}return s}function loopTask(e,t,a,r){var s=!1,n="";5==arguments.length&&(n=arguments[4],s=!0);var o=aa.workflow.getTaskItems(capId,e,n,null,null,null);if(!o.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var g=o.getOutput();t||(t="NA");for(i in g){var u=g[i];if(u.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!s||u.getProcessCode().equals(n))){var c=aa.date.getCurrentDate(),l=u.getStepNumber(),p=u.getProcessID();s?aa.workflow.handleDisposition(capId,l,p,t,c,r,a,systemUserObj,"L"):aa.workflow.handleDisposition(capId,l,t,c,r,a,systemUserObj,"L"),logMessage("Closing Workflow Task: "+e+" with status "+t+", Looping..."),logDebug("Closing Workflow Task: "+e+" with status "+t+", Looping...")}}}function lpSet(e){this.refresh=function(){var e=aa.set.getSetByPK(this.id).getOutput();this.status=e.getSetStatus(),this.setId=e.getSetID(),this.name=e.getSetTitle(),this.comment=e.getSetComment(),this.model=e.getSetHeaderModel(),this.statusComment=e.getSetStatusComment();var t=aa.set.getLPSetMembersByPK(this.id);t.getSuccess()?(this.members=t.getOutput().toArray(),this.size=this.members.length,this.members.length>0&&(this.empty=!1),logDebug("lpSet: loaded set "+this.id+" of status "+this.status+" with "+this.size+" records")):logDebug("**WARNING** error retrieving set members "+t.getErrorMessage())},this.add=function(e){var t;2==arguments.length&&(t=arguments[1]);try{var a=getRefLicenseProf(e),r=aa.set.addLPSetMember(this.id,a.licSeqNbr);logDebug(r.getSuccess()?"lpSet: added LP "+e+" from set "+this.id:"**WARNING** error removing license from set "+this.id+" : "+r.getErrorMessage())}catch(s){logDebug("**ERROR** error adding license from set "+this.id+" : "+s.message)}},this.remove=function(e){try{var t=getRefLicenseProf(e),a=aa.set.removeSetHeadersListByLP(this.id,t.licSeqNbr);logDebug(a.getSuccess()?"lpSet: removed license "+e+" from set "+this.id:"**WARNING** error removing license from set "+this.id+" : "+a.getErrorMessage())}catch(r){logDebug("**ERROR** error removing license from set "+this.id+" : "+r.message)}},this.update=function(){var e=aa.proxyInvoker.newInstance("com.accela.aa.aamain.cap.SetBusiness").getOutput();this.model.setSetStatus(this.status),this.model.setSetID(this.setId),this.model.setSetTitle(this.name),this.model.setSetComment(this.comment),this.model.setSetStatusComment(this.statusComment),this.model.setRecordSetType(this.type),logDebug("lpSet: updating set header information");try{updateResult=e.updateSetBySetID(this.model)}catch(t){logDebug("**WARNING** error updating set header failed "+t.message)}},this.id=e,this.name=e,this.type=null,this.comment=null,arguments.length>1&&arguments[1]&&(this.name=arguments[1]),arguments.length>2&&arguments[2]&&(this.type=arguments[2]),arguments.length>3&&arguments[3]&&(this.comment=arguments[3]),this.size=0,this.empty=!0,this.members=new Array,this.status="",this.statusComment="",this.model=null;var t=aa.set.getSetByPK(this.id);t.getSuccess()?this.refresh():(t=aa.set.createSet(this.id,this.name,"LICENSE_PROFESSIONAL",this.comment),t.getSuccess()?(logDebug("lpSet: Created new set "+this.id+" of type "+this.type),this.refresh()):logDebug("**WARNING** error creating set "+this.id+" : "+t.getErrorMessage))}function matches(e){for(var t=1;t<arguments.length;t++)if(arguments[t]==e)return!0;return!1}function nextWorkDay(e){if(t=e?convertDate(e):new Date,aa.calendar.getNextWorkDay)var t=new Date(aa.calendar.getNextWorkDay(aa.date.parseDate(t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear())).getOutput().getTime());else logDebug("getNextWorkDay function is only available in Accela Automation 6.3.2 or higher.");return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()}function openUrlInNewWindow(e){newurl='<invalidTag LANGUAGE="JavaScript">\r\n<!--\r\n newwin = window.open("',newurl+=e,newurl+='"); \r\n  //--> \r\n </SCRIPT>',comment(newurl)}function pairObj(e){this.ID=e,this.cri=null,this.act=null,this.elseact=null,this.enabled=!0,this.continuation=!1,this.branch=new Array,this.load=function(e){if(loadArr=e.split("\\^"),loadArr.length<2||loadArr.length>3)logMessage('**ERROR: The following Criteria/Action pair is incorrectly formatted.  Two or three elements separated by a caret ("^") are required. '+br+br+e);else{this.cri=loadArr[0],this.act=loadArr[1],this.elseact=loadArr[2],0==this.cri.length()&&(this.continuation=!0);for(var t=loadArr[1],a=t.indexOf("branch(");!enableVariableBranching&&a>=0;){var r=t.substring(a),s=r.indexOf('")');if(0>s)break;s>=9&&this.branch.push(r.substring(8,s)),t=r.substring(s),a=t.indexOf("branch(")}}}}function parcelConditionExists(e){var t=aa.parcel.getParcelandAttribute(capId,null);if(!t.getSuccess())return logDebug("**WARNING: error getting cap parcels : "+t.getErrorMessage()),!1;var a=t.getOutput().toArray();for(zz in a){if(pcResult=aa.parcelCondition.getParcelConditions(a[zz].getParcelNumber()),!pcResult.getSuccess())return logDebug("**WARNING: error getting parcel conditions : "+pcResult.getErrorMessage()),!1;pcs=pcResult.getOutput();for(pc1 in pcs)if(pcs[pc1].getConditionType().equals(e))return!0}}function parcelExistsOnCap(){var e=capId;1==arguments.length&&(e=arguments[0]);var t=null,a=aa.parcel.getParcelandAttribute(e,null);if(!a.getSuccess())return logDebug("**ERROR: Failed to get Parcel object: "+a.getErrorType()+":"+a.getErrorMessage()),!1;var t=a.getOutput().toArray();for(i in t)return!0;return!1}function paymentByTrustAccount(e){if(feeSeqNbr=e,itemCap=capId,2==arguments.length&&(itemCap=arguments[1]),iListResult=aa.finance.getInvoiceByCapID(itemCap,null),!iListResult.getSuccess())return logDebug("Error: could not retrieve invoice list: "+iListResult.getErrorMessage()),!1;iList=iListResult.getOutput(),invNbr="",feeAmount="",iFound=!1;for(iNum in iList){fList=aa.invoice.getFeeItemInvoiceByInvoiceNbr(iList[iNum].getInvNbr()).getOutput();for(fNum in fList)if(fList[fNum].getFeeSeqNbr()==feeSeqNbr){invNbr=iList[iNum].getInvNbr(),feeAmount=fList[fNum].getFee(),iFound=!0,logMessage("Invoice Number Found: "+invNbr),logMessage("Fee Amount: "+feeAmount);break}}if(!iFound)return logMessage("Invoice not found"),!1;var t=aa.trustAccount.getPrimaryTrustAccountByCAP(itemCap);if(!t.getSuccess())return logDebug("Error: could not retrieve trust account object: "+t.getErrorMessage()),!1;if(tAccountID=t.getOutput().getAcctID(),tAcctResult=aa.trustAccount.getTrustAccountByAccountID(tAccountID),tAcctResult.getSuccess()){if(tAcct=tAcctResult.getOutput(),"Y"==tAcct.getOverdraft){if(logDebug("Overdraft allowed"),tAcct.getAcctBalance()+tAcct.getOverdraftLimit()<feeAmount)return logDebug("The trust account balance plus overdraft allowance is less than invoiced fee amount."),logMessage("Trust Account Balance: "+tAcct.getAcctBalance()),logDebug("Trust Account Overlimit allowance: "+tAcct.getOverdraftLimit()),!1}else if("N"==tAcct.getOverdraft&&tAcct.getAcctBalance()<feeAmount)return logDebug("The trust account balance is less than invoiced fee amount."),logMessage("Trust Account Balance: "+tAcct.getAcctBalance()),!1;comment("Trust Account ID: "+tAcct.getAcctID()),logDebug("Trust Account Balance: "+tAcct.getAcctBalance())}return p=aa.finance.createPaymentScriptModel(),p.setAuditDate(aa.date.getCurrentDate()),p.setAuditStatus("A"),p.setCapID(itemCap),p.setCashierID(p.getAuditID()),p.setPaymentSeqNbr(p.getPaymentSeqNbr()),p.setPaymentAmount(feeAmount),p.setAmountNotAllocated(feeAmount),p.setPaymentChange(0),p.setPaymentComment("Trust Account Auto-Deduct: "+tAccountID),p.setPaymentDate(aa.date.getCurrentDate()),p.setPaymentMethod("Trust Account"),p.setPaymentStatus("Paid"),p.setAcctID(tAccountID),presult=aa.finance.makePayment(p),presult.getSuccess()?(pSeq=presult.getOutput(),logDebug("Payment successful"),pReturn=aa.finance.getPaymentByPK(itemCap,pSeq,currentUserID),pReturn.getSuccess()?(pR=pReturn.getOutput(),logDebug("PaymentSeq: "+pR.getPaymentSeqNbr()),feeSeqNbrArray=new Array,feeSeqNbrArray.push(feeSeqNbr),invNbrArray=new Array,invNbrArray.push(invNbr),feeAllocArray=new Array,feeAllocArray.push(feeAmount),applyResult=aa.finance.applyPayment(itemCap,pR.getPaymentSeqNbr(),feeAmount,feeSeqNbrArray,invNbrArray,feeAllocArray,aa.date.getCurrentDate(),"Paid","Paid",pR.getCashierID(),null),applyResult.getSuccess()?(apply=applyResult.getOutput(),logDebug("Apply Payment Successful"),receiptResult=aa.finance.generateReceipt(itemCap,aa.date.getCurrentDate(),pR.getPaymentSeqNbr(),pR.getCashierID(),null),receiptResult.getSuccess()?(receipt=receiptResult.getOutput(),logDebug("Receipt successfully created: "),!0):(logDebug("error generating receipt: "+receiptResult.getErrorMessage()),!1)):(logDebug("error applying funds: "+applyResult.getErrorMessage()),!1)):(logDebug("Error retrieving payment, must apply payment manually: "+pReturn.getErrorMessage()),!1)):(logDebug("error making payment: "+presult.getErrorMessage()),!1)}function paymentByTrustAccount(e){if(feeSeqNbr=e,itemCap=capId,2==arguments.length&&(itemCap=arguments[1]),iListResult=aa.finance.getInvoiceByCapID(itemCap,null),!iListResult.getSuccess())return logDebug("Error: could not retrieve invoice list: "+iListResult.getErrorMessage()),!1;iList=iListResult.getOutput(),invNbr="",feeAmount="",iFound=!1;for(iNum in iList){fList=aa.invoice.getFeeItemInvoiceByInvoiceNbr(iList[iNum].getInvNbr()).getOutput();for(fNum in fList)if(fList[fNum].getFeeSeqNbr()==feeSeqNbr){invNbr=iList[iNum].getInvNbr(),feeAmount=fList[fNum].getFee(),iFound=!0,logMessage("Invoice Number Found: "+invNbr),logMessage("Fee Amount: "+feeAmount);break}}if(!iFound)return logMessage("Invoice not found"),!1;var t=aa.trustAccount.getPrimaryTrustAccountByCAP(itemCap);if(!t.getSuccess())return logDebug("Error: could not retrieve trust account object: "+t.getErrorMessage()),!1;if(tAccountID=t.getOutput().getAcctID(),tAcctResult=aa.trustAccount.getTrustAccountByAccountID(tAccountID),tAcctResult.getSuccess()){if(tAcct=tAcctResult.getOutput(),"Y"==tAcct.getOverdraft){if(logDebug("Overdraft allowed"),tAcct.getAcctBalance()+tAcct.getOverdraftLimit()<feeAmount)return logDebug("The trust account balance plus overdraft allowance is less than invoiced fee amount."),logMessage("Trust Account Balance: "+tAcct.getAcctBalance()),logDebug("Trust Account Overlimit allowance: "+tAcct.getOverdraftLimit()),!1}else if("N"==tAcct.getOverdraft&&tAcct.getAcctBalance()<feeAmount)return logDebug("The trust account balance is less than invoiced fee amount."),logMessage("Trust Account Balance: "+tAcct.getAcctBalance()),!1;comment("Trust Account ID: "+tAcct.getAcctID()),logDebug("Trust Account Balance: "+tAcct.getAcctBalance())}return p=aa.finance.createPaymentScriptModel(),p.setAuditDate(aa.date.getCurrentDate()),p.setAuditStatus("A"),p.setCapID(itemCap),p.setCashierID(p.getAuditID()),p.setPaymentSeqNbr(p.getPaymentSeqNbr()),p.setPaymentAmount(feeAmount),p.setAmountNotAllocated(feeAmount),p.setPaymentChange(0),p.setPaymentComment("Trust Account Auto-Deduct: "+tAccountID),p.setPaymentDate(aa.date.getCurrentDate()),p.setPaymentMethod("Trust Account"),p.setPaymentStatus("Paid"),p.setAcctID(tAccountID),presult=aa.finance.makePayment(p),presult.getSuccess()?(pSeq=presult.getOutput(),logDebug("Payment successful"),pReturn=aa.finance.getPaymentByPK(itemCap,pSeq,currentUserID),pReturn.getSuccess()?(pR=pReturn.getOutput(),logDebug("PaymentSeq: "+pR.getPaymentSeqNbr()),feeSeqNbrArray=new Array,feeSeqNbrArray.push(feeSeqNbr),invNbrArray=new Array,invNbrArray.push(invNbr),feeAllocArray=new Array,feeAllocArray.push(feeAmount),applyResult=aa.finance.applyPayment(itemCap,pR.getPaymentSeqNbr(),feeAmount,feeSeqNbrArray,invNbrArray,feeAllocArray,aa.date.getCurrentDate(),"Paid","Paid",pR.getCashierID(),null),applyResult.getSuccess()?(apply=applyResult.getOutput(),logDebug("Apply Payment Successful"),receiptResult=aa.finance.generateReceipt(itemCap,aa.date.getCurrentDate(),pR.getPaymentSeqNbr(),pR.getCashierID(),null),receiptResult.getSuccess()?(receipt=receiptResult.getOutput(),logDebug("Receipt successfully created: "),!0):(logDebug("error generating receipt: "+receiptResult.getErrorMessage()),!1)):(logDebug("error applying funds: "+applyResult.getErrorMessage()),!1)):(logDebug("Error retrieving payment, must apply payment manually: "+pReturn.getErrorMessage()),!1)):(logDebug("error making payment: "+presult.getErrorMessage()),!1)}function paymentGetNotAppliedTot(){var e=aa.cashier.getSumNotAllocated(capId);if(e.getSuccess()){var t=e.getOutput();return parseFloat(t)}return logDebug("**ERROR: Getting total not applied: "+e.getErrorMessage()),!1}function prepareRenewal(){if(isRenewProcess(parentCapId,capId)){logDebug("CAPID("+parentCapId+") is ready for renew. PartialCap ("+capId+")");var e=aa.cap.createRenewalCap(parentCapId,capId,!0);return e.getSuccess()?(aa.cap.updateAccessByACA(capId,"N"),!0):(logDebug("ERROR: Associate partial cap with parent CAP. "+e.getErrorMessage()),!1)}return logDebug("Renewal Process did not finish properly"),!1}function proximity(e,t,a){var r="feet";4==arguments.length&&(r=arguments[3]);var s=aa.gis.getGISType(e,t);if(!s.getSuccess())return logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+s.getErrorType()+":"+s.getErrorMessage()),!1;var n=s.getOutput();n.addAttributeName(t+"_ID");var i=aa.gis.getCapGISObjects(capId);if(!i.getSuccess())return logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+i.getErrorType()+":"+i.getErrorMessage()),!1;var o=i.getOutput();for(a1 in o){var g=aa.gis.getBufferByRadius(o[a1],a,r,n);if(!g.getSuccess())return logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+g.getErrorType()+":"+g.getErrorMessage()),!1;var u=g.getOutput();for(a2 in u){var c=u[a2].getGISObjects();if(c.length)return!0}}}function proximityToAttribute(e,t,a,r,s,n){var i=aa.gis.getGISType(e,t);if(!i.getSuccess())return logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+i.getErrorType()+":"+i.getErrorMessage()),!1;var o=i.getOutput();o.addAttributeName(s);var g=aa.gis.getCapGISObjects(capId);if(!g.getSuccess())return logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+g.getErrorType()+":"+g.getErrorMessage()),!1;var u=g.getOutput();for(a1 in u){var c=aa.gis.getBufferByRadius(u[a1],a,r,o);if(!c.getSuccess())return logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+c.getErrorType()+":"+c.getErrorMessage()),!1;var l=c.getOutput();for(a2 in l){proxObj=l[a2].getGISObjects();for(z1 in proxObj){var p=proxObj[z1].getAttributeValues();if(retString=p[0],retString&&retString.equals(n))return!0}}}}function refLicProfGetAttribute(e,t){if(null==e||0==e.length||null==t||0==t.length)return logDebug("Invalid license number or attribute name parameter"),"INVALID PARAMETER";var a=getRefLicenseProf(e),r=0,s="";if(!a)return logMessage("No reference licensed professional found with state license number of "+e),logDebug("No reference licensed professional found with state license number of "+e),"NO LICENSE FOUND";if(r=a.getLicSeqNbr(),s=a.getLicenseType(),logDebug("License Seq Num: "+r+", License Type: "+s),0!=r&&null!=r&&""!=s&&null!=s){var n=aa.people.getPeopleAttributeByPeople(r,s);if(!n.getSuccess())return logDebug("**ERROR retrieving reference license professional attribute: "+n.getErrorMessage()),!1;var o=n.getOutput();if(o){for(i in o)if(t.equals(o[i].getAttributeName()))return logDebug("Reference record for license "+e+", attribute "+t+": "+o[i].getAttributeValue()),o[i].getAttributeValue();return logDebug("Reference record for license "+e+" has no attribute named "+t),"ATTRIBUTE NOT FOUND"}return logDebug("Reference record for license "+e+" has no custom attributes"),"ATTRIBUTE NOT FOUND"}return logDebug("Missing seq nbr or license type"),!1}function refLicProfGetDate(e,t){if(null==t||""==t)var a="EXPIRE";else{var a=t.toUpperCase();"ISSUE"!=a&&"RENEW"!=a&&"BUSINESS"!=a&&"INSURANCE"!=a&&(a="EXPIRE")}if(null==e||""==e)return logDebug("Invalid license number parameter"),"INVALID PARAMETER";var r=getRefLicenseProf(e);if(r){var s=new Date;return"EXPIRE"==a?r.getLicenseExpirationDate()?(s=convertDate(r.getLicenseExpirationDate()),logDebug(e+" License Expiration Date: "+jsDateToMMDDYYYY(s)),s):(logDebug("Reference record for license "+e+" has no License Expiration Date"),"NO DATE FOUND"):"INSURANCE"==a?r.getInsuranceExpDate()?(s=convertDate(r.getInsuranceExpDate()),logDebug(e+" Insurance Expiration Date: "+jsDateToMMDDYYYY(s)),s):(logDebug("Reference record for license "+e+" has no Insurance Expiration Date"),"NO DATE FOUND"):"BUSINESS"==a?r.getBusinessLicExpDate()?(s=convertDate(r.getBusinessLicExpDate()),logDebug(e+" Business Lic Expiration Date: "+jsDateToMMDDYYYY(s)),s):(logDebug("Reference record for license "+e+" has no Business Lic Exp Date"),"NO DATE FOUND"):"ISSUE"==a?r.getLicenseIssueDate()?(s=convertDate(r.getLicenseIssueDate()),logDebug(e+" License Issue Date: "+jsDateToMMDDYYYY(s)),s):(logDebug("Reference record for license "+e+" has no Issue Date"),"NO DATE FOUND"):"RENEW"==a?r.getLicenseLastRenewalDate()?(s=convertDate(r.getLicenseLastRenewalDate()),logDebug(e+" License Last Renewal Date: "+jsDateToMMDDYYYY(s)),s):(logDebug("Reference record for license "+e+" has no Last Renewal Date"),"NO DATE FOUND"):"NO DATE FOUND"}}function removeAllFees(e){if(getFeeResult=aa.fee.getFeeItems(e,null,"NEW"),getFeeResult.getSuccess()){var t=getFeeResult.getOutput();for(feeNum in t){if(t[feeNum].getFeeitemStatus().equals("NEW")){var a=t[feeNum].getFeeSeqNbr(),r=aa.finance.removeFeeItem(e,a);if(!r.getSuccess()){logDebug("**ERROR: removing fee item ("+t[feeNum].getFeeCod()+"): "+r.getErrorMessage());break}logDebug("Removed existing Fee Item: "+t[feeNum].getFeeCod())}t[feeNum].getFeeitemStatus().equals("INVOICED")&&logDebug("Invoiced fee "+t[feeNum].getFeeCod()+" found, not removed")}}else logDebug("**ERROR: getting fee items ("+t[feeNum].getFeeCod()+"): "+getFeeResult.getErrorMessage())}function removeASITable(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.appSpecificTableScript.removeAppSpecificTableInfos(e,t,currentUserID);return a.getSuccess()?void logDebug("Successfully removed all rows from ASI Table: "+e):(aa.print("**WARNING: error removing ASI table "+e+" "+a.getErrorMessage()),!1)}function removeCapCondition(e,t){var a=capId;3==arguments.length&&(a=arguments[2]);var r=aa.capCondition.getCapConditions(a,e);if(!r.getSuccess())return logDebug("**WARNING: error getting cap conditions : "+r.getErrorMessage()),!1;var s=r.getOutput();for(pc1 in s)if(s[pc1].getConditionDescription().equals(t)){var n=aa.capCondition.deleteCapCondition(a,s[pc1].getConditionNumber());logDebug(n.getSuccess()?"Successfully removed condition to CAP : "+a+"  ("+e+") "+t:"**ERROR: removing condition to Parcel "+parcelNum+"  ("+e+"): "+addParcelCondResult.getErrorMessage())}}function removeFee(e,t){if(getFeeResult=aa.finance.getFeeItemsByFeeCodeAndPeriod(capId,e,t,"NEW"),getFeeResult.getSuccess()){var a=getFeeResult.getOutput();for(feeNum in a){if(a[feeNum].getFeeitemStatus().equals("NEW")){var r=a[feeNum].getFeeSeqNbr(),s=aa.finance.removeFeeItem(capId,r);if(!s.getSuccess()){logDebug("**ERROR: removing fee item ("+e+"): "+s.getErrorMessage());break}logDebug("Removed existing Fee Item: "+e)}a[feeNum].getFeeitemStatus().equals("INVOICED")&&logDebug("Invoiced fee "+e+" found, not removed")}}else logDebug("**ERROR: getting fee items ("+e+"): "+getFeeResult.getErrorMessage())}function removeParcelCondition(e,t,a){if(e){var r=aa.parcelCondition.getParcelConditions(e);if(!r.getSuccess())return logDebug("**WARNING: error getting parcel conditions : "+r.getErrorMessage()),!1;var s=r.getOutput();for(pc1 in s)if(s[pc1].getConditionType().equals(t)&&s[pc1].getConditionDescription().equals(a)){var n=aa.parcelCondition.removeParcelCondition(s[pc1].getConditionNumber(),e);n.getSuccess()&&logDebug("Successfully removed condition to Parcel "+e+"  ("+t+") "+a)}else logDebug("**ERROR: removing condition to Parcel "+e+"  ("+t+"): "+addParcelCondResult.getErrorMessage())}else{var i=aa.parcel.getParcelandAttribute(capId,null);if(i.getSuccess()){var o=i.getOutput().toArray();for(zz in o){e=o[zz].getParcelNumber(),logDebug("Adding Condition to parcel #"+zz+" = "+e);var r=aa.parcelCondition.getParcelConditions(e);if(!r.getSuccess())return logDebug("**WARNING: error getting parcel conditions : "+r.getErrorMessage()),!1;var s=r.getOutput();for(pc1 in s)if(s[pc1].getConditionType().equals(t)&&s[pc1].getConditionDescription().equals(a)){var n=aa.parcelCondition.removeParcelCondition(s[pc1].getConditionNumber(),e);n.getSuccess()&&logDebug("Successfully removed condition to Parcel "+e+"  ("+t+") "+a)}else logDebug("**ERROR: removing condition to Parcel "+e+"  ("+t+"): "+addParcelCondResult.getErrorMessage())}}}}function removeRefContactAddressFromRecordContact(e,t,a){if(e&&t&&a){var r=aa.address.createXRefContactAddressModel().getOutput();r.setCapID(e),r.setAddressID(a.getAddressID()),r.setEntityID(aa.util.parseLong(t)),r.setEntityType(a.getEntityType());var s=aa.address.deleteXRefContactAddress(r.getXRefContactAddressModel());return s.getSuccess?(logDebug("Successfully removed reference contact address to cap contact: "+t),!0):(logDebug("Failed to remove reference contact address to cap: "+s.getErrorMessage()),!1)}return logDebug("Could not remove reference contact address no address model, capId or cap contact sequence number"),!1}function removeTask(e,t){var a=!1,r="";3==arguments.length&&(r=arguments[2],a=!0);var s=aa.workflow.getTaskItems(e,t,r,null,null,null);if(!s.getSuccess())return logDebug("**WARNING: Failed to get workflow object: "+s.getErrorMessage()),!1;var n=s.getOutput(),o=null;for(i in n){var g=n[i];!g.getTaskDescription().toUpperCase().equals(t.toUpperCase())||a&&!g.getProcessCode().toUpperCase().equals(r.toUpperCase())||(o=n[i])}if(!o)return logDebug("**WARNING: Task to remove not found: "+t),!1;var u=aa.workflow.removeTask(o);return u.getSuccess()?void logDebug("Removed task "+o.getTaskDescription()):(logDebug("**WARNING: error removing task "+u.getErrorMessage()),!1)}function replaceMessageTokens(m){for(;m.indexOf("|");){var s=m.indexOf("|"),e=m.indexOf("|",s+1);if(0>=e)break;var r=m.substring(s+1,e),evalstring="typeof("+r+') != "undefined" ? '+r+' : "undefined"',v=eval(evalstring),pattern=new RegExp("\\|"+r+"\\|","g");m=String(m).replace(pattern,v)}for(;m.indexOf("{");){var s=m.indexOf("{"),e=m.indexOf("}",s+1);if(0>=e)break;var r=m.substring(s+1,e),evalstring='AInfo["'+r+'"]',v=eval(evalstring),pattern=new RegExp("\\{"+r+"\\}","g");m=String(m).replace(pattern,v)}return m}function replaceNode(e,t,a){var r="",s="<"+t+">",n="</"+t+">";return startPos=e.indexOf(s)+s.length,endPos=e.indexOf(n),startPos>0&&startPos<=endPos?(r=e.substring(0,startPos)+a+e.substring(endPos),unescape(r)):void 0}function resultInspection(e,t,a,r){var s=capId;arguments.length>4&&(s=arguments[4]);var n,i=aa.inspection.getInspections(s);if(i.getSuccess()){var o=i.getOutput();for(xx in o)String(e).equals(o[xx].getInspectionType())&&o[xx].getInspectionStatus().toUpperCase().equals("SCHEDULED")&&(n=o[xx].getIdNumber())}n?(resultResult=aa.inspection.resultInspection(s,n,t,a,r,currentUserID),logDebug(resultResult.getSuccess()?"Successfully resulted inspection: "+e+" to Status: "+t:"**WARNING could not result inspection : "+e+", "+resultResult.getErrorMessage())):logDebug("Could not result inspection : "+e+", not scheduled")}function runEvent(e,t){try{var a=prefix;t&&(doStdChoices?doStandardChoiceActions(t,!0,0):logDebug("runEvent:  Can't execute standard choices for control string "+t+" because doStdChoices is false")),prefix=lookup("EMSE_VARIABLE_BRANCH_PREFIX",e),prefix?doScripts?doScriptActions():logDebug("runEvent:  Can't execute scripts for event "+e+" because doScripts is false"):logDebug("runEvent:  Can't execute scripts for event "+e+" because prefix is not defined in std Choice EMSE_VARIABLE_BRANCH_PREFIX"),prefix=a}catch(r){handleError(r,s)}}function runReport4Email(e,t,a,r,s,n,i,o){var g=!1;if(a)if(matches(a.people.getEmail(),null,void 0,""))g=!1;else{var u;if(u=generateReport(e,t,i,r)){var c=new Array;return c.push(u),sendNotification(o,a.people.getEmail(),"",n,s,c,e),!0}}else g=!1;return g?void 0:!1}function runReport4EmailOrPrint(e,t,a,r,s,n,i){var o=!1;if(a)if(matches(a.people.getEmail(),null,void 0,""))o=!0;else{var g;if(g=generateReport(e,t,i,r)){var u=new Array;u.push(g),sendNotification(sysFromEmail,a.people.getEmail(),"",n,s,u),comment("Email with "+t+" was sent to "+a.people.getEmail()),o=!0}}else o=!0;if(o){var c=generateReport4Workflow(e,t,i,r);showMessage=!0,comment(c)}}function runReportAttach(e,t){var a=t;if(g=aa.reportManager.getReportInfoModelByName(a),!g.getSuccess())return logDebug("**WARNING** couldn't load report "+a+" "+g.getErrorMessage()),!1;var r=g.getOutput(),s=aa.cap.getCap(e).getOutput();appTypeResult=s.getCapType(),appTypeString=appTypeResult.toString(),appTypeArray=appTypeString.split("/"),r.setModule(appTypeArray[0]),r.setCapId(e.getID1()+"-"+e.getID2()+"-"+e.getID3()),r.getEDMSEntityIdModel().setAltId(e.getCustomID());for(var n=aa.util.newHashMap(),i=2;i<arguments.length;i+=2)n.put(arguments[i],arguments[i+1]),logDebug("Report parameter: "+arguments[i]+" = "+arguments[i+1]);r.setReportParameters(n);var o=aa.reportManager.hasPermission(a,currentUserID);if(o.getOutput().booleanValue()){var g=aa.reportManager.getReportResult(r);logDebug("Report "+t+" has been run for "+e.getCustomID())}else logDebug("No permission to report: "+a+" for user: "+currentUserID)}function scheduleInspect(e,t,a){var r=null,s=null,n="Scheduled via Script";if(arguments.length>=3&&null!=arguments[2]){var i=aa.person.getUser(arguments[2]);if(i.getSuccess())var r=i.getOutput()}arguments.length>=4&&null!=arguments[3]&&(s=arguments[3]),5==arguments.length&&null!=arguments[4]&&(n=arguments[4]);var o=aa.inspection.scheduleInspection(e,r,aa.date.parseDate(dateAdd(null,a)),s,t,n);logDebug(o.getSuccess()?"Successfully scheduled inspection : "+t+" for "+dateAdd(null,a):"**ERROR: adding scheduling inspection ("+t+"): "+o.getErrorMessage())}function scheduleInspectDate(e,t){var a=null,r=null,s="Scheduled via Script";if(arguments.length>=3&&null!=arguments[2]){var n=aa.person.getUser(arguments[2]);n.getSuccess()&&(a=n.getOutput())}arguments.length>=4&&null!=arguments[3]&&(r=arguments[3]),arguments.length>=5&&null!=arguments[4]&&(s=arguments[4]);var i=aa.inspection.scheduleInspection(capId,a,aa.date.parseDate(t),r,e,s);logDebug(i.getSuccess()?"Successfully scheduled inspection : "+e+" for "+t:"**ERROR: adding scheduling inspection ("+e+"): "+i.getErrorMessage())}function scheduleInspection(e,t){var a=null,r=null,s="Scheduled via Script";if(arguments.length>=3&&null!=arguments[2]){var n=aa.person.getUser(arguments[2]);if(n.getSuccess())var a=n.getOutput()}arguments.length>=4&&null!=arguments[3]&&(r=arguments[3]),5==arguments.length&&null!=arguments[4]&&(s=arguments[4]);var i=aa.inspection.scheduleInspection(capId,a,aa.date.parseDate(dateAdd(null,t)),r,e,s);logDebug(i.getSuccess()?"Successfully scheduled inspection : "+e+" for "+dateAdd(null,t):"**ERROR: adding scheduling inspection ("+e+"): "+i.getErrorMessage())}function searchProject(e,t){for(var a,r,s=1,n=!1,i=new Array,o=new Array,g=new Array,u=new Array;;){if(!aa.cap.getProjectParents(capId,s).getSuccess())break;s+=1}if(s-=1,getCapResult=aa.cap.getProjectParents(capId,s),myArray=new Array,myOutArray=new Array,null!=e){var a=e.split("/");4!=a.length&&logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+pCapType)}if(getCapResult.getSuccess()&&(parentArray=getCapResult.getOutput(),parentArray.length)){for(x in parentArray)childTypeArray=parentArray[x].getCapType().toString().split("/");r=!0;for(yy in childTypeArray)if(!a[yy].equals(childTypeArray[yy])&&!a[yy].equals("*")){r=!1;break}r&&myArray.push(parentArray[x].getCapID())}if(!myArray.length)return i;u=myArray;for(null!=t&&(a=t.split("/"),4!=a.length&&logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+t));;){for(x in u)if(o=getChildren("*/*/*/*",u[x]),null!=o)for(y in o){n=!1;for(z in i)if(i[z].getCustomID().equals(o[y].getCustomID())){n=!0;break}if(!n&&(g.push(o[y]),!capId.getCustomID().equals(o[y].getCustomID()))){var c=aa.cap.getCap(o[y]).getOutput().getCapType().toString().split("/");r=!0;for(p in c)if(a[p]!=c[p]&&"*"!=a[p]){r=!1;break}r&&i.push(o[y])}}if(!g.length)break;u=g,g=new Array}return i}function sendNotification(e,t,a,r,s,n){var i=capId;7==arguments.length&&(i=arguments[6]);var o=i.ID1,g=i.ID2,u=i.ID3,c=aa.cap.createCapIDScriptModel(o,g,u),l=null;return l=aa.document.sendEmailAndSaveAsDocument(e,t,a,r,s,c,n),l.getSuccess()?(logDebug("Sent email successfully!"),!0):(logDebug("Failed to send mail. - "+l.getErrorType()),!1)}function setContactTypeFlagByType(e){var t=getContactObjs(e);for(var a in t){thisContact=t[a];var r=lookup("CONTACT TYPE FLAG",thisContact.type);void 0!=r&&(thisContact.people.setContactTypeFlag(r),thisContact.save())}}function setIVR(e){var t=aa.cap.newCapScriptModel().getOutput(),a=t.getCapModel(),r=a.getCapID();r.setServiceProviderCode(t.getServiceProviderCode()),r.setID1(aa.env.getValue("PermitId1")),r.setID2(aa.env.getValue("PermitId2")),r.setID3(aa.env.getValue("PermitId3")),a.setTrackingNbr(e),a.setCapID(r),aa.cap.editCapByPK(a),logDebug("IVR Tracking Number updated to "+e)}function setLicExpirationDate(e){var t=e.getCustomID();1==arguments.length&&(calcDateFrom=null,dateOverride=null,renewalStatus=null),2==arguments.length&&(calcDateFrom=arguments[1],dateOverride=null,renewalStatus=null),3==arguments.length&&(calcDateFrom=arguments[1],dateOverride=arguments[2],renewalStatus=null),4==arguments.length&&(calcDateFrom=arguments[1],dateOverride=arguments[2],renewalStatus=arguments[3]);var a="";if(b1ExpResult=aa.expiration.getLicensesByCapID(e),b1ExpResult.getSuccess()){this.b1Exp=b1ExpResult.getOutput();var r=this.b1Exp.getExpUnit(),s=this.b1Exp.getExpInterval();if(null==r)return logDebug("Could not set the expiration date, no expiration unit defined for expiration code: "+this.b1Exp.getExpCode()),!1;"Days"==r&&(a=dateAdd(calcDateFrom,s)),"Months"==r&&(a=dateAddMonths(calcDateFrom,s)),"Years"==r&&(a=dateAddMonths(calcDateFrom,12*s))}return thisLic=new licenseObject(t,e),thisLic.setExpiration(null==dateOverride?dateAdd(a,0):dateAdd(dateOverride,0)),thisLic.setStatus(null!=renewalStatus?renewalStatus:"Active"),logDebug("Successfully set the expiration date and status"),!0}function setTask(e,t,a){var r=!1,s="";4==arguments.length&&(s=arguments[3],r=!0);var n=aa.workflow.getTaskItems(capId,e,s,null,null,null);if(!n.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var o=n.getOutput();for(i in o){var g=o[i];if(g.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!r||g.getProcessCode().equals(s))){{var u=g.getStepNumber(),c=g.getProcessID();g.getCompleteFlag()}r?aa.workflow.adjustTask(capId,u,c,t,a,null,null):aa.workflow.adjustTask(capId,u,t,a,null,null),logDebug("set Workflow Task: "+e)}}}function stripNN(e){var t="0123456789.",a="";for(i=0;i<e.length();i++)t.indexOf(String.fromCharCode(e.charAt(i)))>=0&&(a+=String.fromCharCode(e.charAt(i)));return a}function taskCloseAllExcept(e,t){var a=new Array,r=!1;if(arguments.length>2)for(var s=2;s<arguments.length;s++)a.push(arguments[s]);
else r=!0;var n=aa.workflow.getTasks(capId);if(!n.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+n.getErrorMessage()),!1;var i,o,g,u=n.getOutput(),c=aa.date.getCurrentDate(),l=" ";for(s in u)i=u[s],g=i.getTaskDescription(),o=i.getStepNumber(),r?(aa.workflow.handleDisposition(capId,o,e,c,l,t,systemUserObj,"Y"),logMessage("Closing Workflow Task "+g+" with status "+e),logDebug("Closing Workflow Task "+g+" with status "+e)):exists(g,a)||(aa.workflow.handleDisposition(capId,o,e,c,l,t,systemUserObj,"Y"),logMessage("Closing Workflow Task "+g+" with status "+e),logDebug("Closing Workflow Task "+g+" with status "+e))}function taskStatus(e){var t=!1,a="",r=capId;arguments.length>=2&&(a=arguments[1],a&&(t=!0)),3==arguments.length&&(r=arguments[2]);var s=aa.workflow.getTaskItems(r,e,a,null,null,null);if(!s.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s.getErrorMessage()),!1;var n=s.getOutput();for(i in n){var o=n[i];if(o.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!t||o.getProcessCode().equals(a)))return o.getDisposition()}}function taskStatusDate(e){var t=capId;3==arguments.length&&(t=arguments[2]);var a=!1,r="";arguments.length>1&&null!=arguments[1]&&(r=arguments[1],a=!0);var s=aa.workflow.getTaskItems(t,e,r,null,null,null);if(!s.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+n.getErrorMessage()),!1;var n=s.getOutput();for(i in n){var o=n[i];if(o.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!a||o.getProcessCode().equals(r)))return null!=o.getStatusDate()?""+(o.getStatusDate().getMonth()+1)+"/"+o.getStatusDate().getDate()+"/"+(parseInt(o.getStatusDate().getYear())+1900):(logMessage("**ERROR: NULL workflow task "+o.getTaskDescription()+" status date. "),!1)}}function token(e){return disableTokens||(re=new RegExp("\\{","g"),e=String(e).replace(re,'AInfo["'),re=new RegExp("\\}","g"),e=String(e).replace(re,'"]')),String(e)}function transferFeesAndPayments(e,t){var a=aa.finance.getPaymentByCapID(capId,null).getOutput(),r=new Array,s=new Array,n=new Array;for(ik in a){var i=a[ik],o=aa.finance.getPaymentFeeItems(capId,null);if(o.getSuccess()){var g=o.getOutput();for(ij in g)g[ij].getPaymentSeqNbr()==i.getPaymentSeqNbr()&&(r.push(g[ij].getFeeSeqNbr()),s.push(g[ij].getInvoiceNbr()),n.push(g[ij].getFeeAllocation()))}r.length>0&&(z=aa.finance.applyRefund(capId,i,r,s,n,"FeeStat","InvStat","123"),logDebug(z.getSuccess()?"Refund applied":"Error applying refund "+z.getErrorMessage()))}feeA=loadFees();for(var u in feeA)if(thisFee=feeA[u],logDebug("status is "+thisFee.status),"INVOICED"==thisFee.status){addFee(thisFee.code,thisFee.sched,thisFee.period,thisFee.unit,"Y",t),voidResult=aa.finance.voidFeeItem(capId,thisFee.sequence),logDebug(voidResult.getSuccess()?"Fee item "+thisFee.code+"("+thisFee.sequence+") has been voided":"**ERROR: voiding fee item "+thisFee.code+"("+thisFee.sequence+") "+voidResult.getErrorMessage());var r=new Array,c=new Array;r.push(thisFee.sequence),c.push(thisFee.period);var l=aa.finance.createInvoice(capId,r,c);l.getSuccess()||logDebug("**ERROR: Invoicing the fee items voided "+feeCapMessage+" was not successful.  Reason: "+invoiceResult.getErrorMessage())}var p=paymentGetNotAppliedTot(),d=aa.finance.makeFundTransfer(capId,t,currentUserID,"","",sysDate,sysDate,"",sysDate,p,"NA","Fund Transfer","NA","R",null,"","NA","");logDebug(d.getSuccess()?"Successfully did fund transfer to : "+t.getCustomID():"**ERROR: doing fund transfer to ("+t.getCustomID()+"): "+d.getErrorMessage());var a=aa.finance.getPaymentByCapID(t,null).getOutput();for(ik in a){var r=new Array,s=new Array,n=new Array,i=a[ik],f=0,m=i.getAmountNotAllocated();if(m>0){var C=aa.finance.getInvoiceByCapID(t,null).getOutput();for(var b in C){var D=C[b],A=D.getInvoiceModel().getBalanceDue();if(A>0){feeT=aa.invoice.getFeeItemInvoiceByInvoiceNbr(D.getInvNbr()).getOutput();for(targetFeeNum in feeT){var v=feeT[targetFeeNum];f=v.getFee()>m?m:v.getFee(),m-=f,r.push(v.getFeeSeqNbr()),s.push(D.getInvNbr()),n.push(f)}}}applyResult=aa.finance.applyPayment(t,i,r,s,n,"PAYSTAT","INVSTAT","123"),logDebug(applyResult.getSuccess()?"Successfully applied payment":"**ERROR: applying payment to fee ("+v.getFeeDescription()+"): "+applyResult.getErrorMessage())}}}function transferFunds(e,t){var a=parseFloat(t);if(isNaN(a))return logDebug("dollarAmount parameter is not a number, no funds will be transferred"),!1;var r=paymentGetNotAppliedTot();if(r<parseFloat(t))return logDebug("Insufficient funds $"+r.toString()+" available. Fund transfer of $"+t.toString()+" not done."),logMessage("Insufficient funds available. No funds transferred."),!1;var s=aa.cap.getCapID(e);if(s.getSuccess()){var n=s.getOutput(),i=aa.finance.makeFundTransfer(capId,n,currentUserID,"","",sysDate,sysDate,"",sysDate,t,"NA","Fund Transfer","NA","R",null,"","NA","");logDebug(i.getSuccess()?"Successfully did fund transfer to : "+e:"**ERROR: doing fund transfer to ("+e+"): "+i.getErrorMessage())}else logDebug("**ERROR: getting parent cap id ("+e+"): "+s.getErrorMessage())}function transferReceiptAndApply(e,t){var a=parseFloat(aa.cashier.getSumNotAllocated(e).getOutput()),r=aa.cashier.getTotalFeeAmount(t),s=0;r.getSuccess()&&(s=r.getOutput());var n=s;if(0>=a)return logDebug("insufficient funds to do transfer from receipt record"),!1;s>a&&(n=a);var i=aa.finance.makeFundTransfer(e,t,currentUserID,"","",sysDate,sysDate,"",sysDate,n,"NA","Fund Transfer","NA","R",null,"","NA","");logDebug(i.getSuccess()?"Successfully transferred $"+n+" from "+e+" to "+t:"Error transferring funds "+i.getErrorMessage());var o=aa.finance.getPaymentByCapID(t,null).getOutput();for(ik in o){var g=new Array,u=new Array,c=new Array,l=o[ik],p=0,d=l.getAmountNotAllocated();if(d>0){var f=aa.finance.getInvoiceByCapID(t,null).getOutput();for(var m in f){var C=f[m],b=C.getInvoiceModel().getBalanceDue();if(b>0){feeT=aa.invoice.getFeeItemInvoiceByInvoiceNbr(C.getInvNbr()).getOutput();for(targetFeeNum in feeT){var D=feeT[targetFeeNum];p=D.getFee()>d?d:D.getFee(),d-=p,g.push(D.getFeeSeqNbr()),u.push(C.getInvNbr()),c.push(p)}}}return applyResult=aa.finance.applyPayment(t,l,g,u,c,"PAYSTAT","INVSTAT","123"),applyResult.getSuccess()?(logDebug("Successfully applied payment"),n):(logDebug("**ERROR: applying payment to fee ("+D.getFeeDescription()+"): "+applyResult.getErrorMessage()),!1)}}}function updateAppStatus(e,t){var a=capId;3==arguments.length&&(a=arguments[2]);var r=aa.cap.updateAppStatus(a,"APPLICATION",e,sysDate,t,systemUserObj);logDebug(r.getSuccess()?"Updated application status to "+e+" successfully.":"**ERROR: application status update to "+e+" was unsuccessful.  The reason is "+r.getErrorType()+":"+r.getErrorMessage())}function updateEnfOfficer(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();return r?(cd=r.getCapDetailModel(),cd.setEnforceOfficerName(e),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void logDebug("updated enf officer name to "+e):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function updateFee(e,t,a,r,s,n,i){n=null==n||0==n.length?"Y":n.toUpperCase();var o=!1,g=r,u=null;if(feeUpdated=!1,getFeeResult=null==i?aa.finance.getFeeItemByFeeCode(capId,e,a):aa.finance.getFeeItemByPK(capId,i),getFeeResult.getSuccess()){if(null==i)var c=getFeeResult.getOutput();else{var c=new Array;c[0]=getFeeResult.getOutput()}for(feeNum in c)c[feeNum].getFeeitemStatus().equals("INVOICED")&&("Y"==n?(logDebug("Invoiced fee "+e+" found, subtracting invoiced amount from update qty."),g-=c[feeNum].getFeeUnit(),o=!0):(o=!0,logDebug("Invoiced fee "+e+" found.  Not updating this fee. Not assessing new fee "+e))),c[feeNum].getFeeitemStatus().equals("NEW")&&(g-=c[feeNum].getFeeUnit());for(feeNum in c)if(c[feeNum].getFeeitemStatus().equals("NEW")&&!feeUpdated){var u=c[feeNum].getFeeSeqNbr(),l=aa.finance.editFeeItemUnit(capId,g+c[feeNum].getFeeUnit(),u);if(feeUpdated=!0,!l.getSuccess()){logDebug("**ERROR: updating qty on fee item ("+e+"): "+l.getErrorMessage());break}logDebug("Updated Qty on Existing Fee Item: "+e+" to Qty: "+r),"Y"==s&&(feeSeqList.push(u),paymentPeriodList.push(a))}}else logDebug("**ERROR: getting fee items ("+e+"): "+getFeeResult.getErrorMessage());return u=feeUpdated||0==g||o&&(!o||"Y"!=n)?null:addFee(e,t,a,g,s),updateFeeItemInvoiceFlag(u,s),u}function updateFeeItemInvoiceFlag(e,t){if(null!=e&&publicUser&&!cap.isCompleteCap()){var a=aa.finance.getFeeItemByPK(capId,e);if(a.getSuccess){var r=a.getOutput().getF4FeeItem();r.setAutoInvoiceFlag(t),aa.finance.editFeeItem(r)}}}function updateGuidesheetASIField(e,t,a,r,s,n,i){var o=capId,g=aa.inspection.getInspections(o);if(!g.getSuccess())return logDebug("No inspections on the record"),!1;var u=g.getOutput();for(p in u)if(u[p].getIdNumber()==e){var c=u[p].getInspection(),l=c.getGuideSheets();if(!l)return logDebug("No guidesheets for this inspection"),!1;for(var p=0;p<l.size();p++){var d=l.get(p);if(d&&t.toUpperCase()==d.getGuideType().toUpperCase()){for(var f=d.getItems(),m=0;m<f.size();m++){var C=f.get(m);if(C&&a==C.getGuideItemText()&&r==C.getGuideItemASIGroupName()){var b=C.getItemASISubgroupList();if(b)for(var D=0;D<b.size();D++){var A=b.get(D);if(A&&A.getSubgroupCode()==s){var v=A.getAsiList();if(v)for(var y=0;y<v.size();y++){var h=v.get(y);h&&h.getAsiName()==n&&(logDebug("Change ASI value from:"+h.getAttributeValue()+" to "+i),h.setAttributeValue(i))}}}}}var S=aa.guidesheet.updateGGuidesheet(d,d.getAuditID());return S.getSuccess()?(logDebug("Successfully updated "+t+" on inspection "+e+"."),!0):(logDebug("Could not update guidesheet ID: "+S.getErrorMessage()),!1)}}}return logDebug("No updates to the guidesheet made"),!1}function updateGuidesheetID(e,t,a){var r=capId;arguments>2&&(r=arguments[2]);var s=aa.inspection.getInspections(r);if(!s.getSuccess())return logDebug("No inspections on the record"),!1;var n=s.getOutput();for(i in n)if(n[i].getIdNumber()==e){var o=n[i].getInspection(),g=o.getGuideSheets();if(!g)return logDebug("No guidesheets for this inspection"),!1;gsArray=g.toArray();for(var u in gsArray)if(t.toUpperCase()==gsArray[u].getGuideType().toUpperCase()){gsArray[u].setIdentifier(a);var c=aa.guidesheet.updateGGuidesheet(gsArray[u],gsArray[u].getAuditID());return c.getSuccess()?(logDebug("Successfully updated "+t+" on inspection "+e+" to and ID of "+a),!0):(logDebug("Could not update guidesheet ID: "+c.getErrorMessage()),!1)}}return logDebug("No updates to the guidesheet made"),!1}function updateRefParcelToCap(){var e=null;e=arguments.length>0?arguments[0]:capId;var t=aa.parcel.getParcelDailyByCapID(e,null).getOutput();if(null!=t)for(x in t){var a=aa.parcel.getParceListForAdmin(t[x].getParcelNumber(),null,null,null,null,null,null,null,null,null);if(a.getSuccess()){var r=a.getOutput();if(r.length){var s=r[0].getParcelModel(),n=s.getParcelNumber(),i=aa.parcel.warpCapIdParcelModel2CapParcelModel(e,s);if(i.getSuccess()){var o=i.getOutput();o.setL1ParcelNo(n),aa.parcel.updateDailyParcelWithAPOAttribute(o),logDebug("Updated Parcel "+t[x].getParcelNumber()+" with Reference Data")}else logDebug("Failed to Wrap Parcel Model for "+t[x].getParcelNumber())}else logDebug("No matching reference Parcels found for "+t[x].getParcelNumber())}else logDebug("Failed to get reference Parcel for "+t[x].getParcelNumber())}}function updateShortNotes(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a=aa.cap.getCapDetail(t);if(!a.getSuccess())return logDebug("**ERROR: No cap detail script object : "+a.getErrorMessage()),!1;var r=a.getOutput();return r?(cd=r.getCapDetailModel(),cd.setShortNotes(e),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void logDebug("updated short notes to "+e):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function updateTask(e,t,a,r){var s=!1,n="";arguments.length>4&&""!=arguments[4]&&(n=arguments[4],s=!0);var o=capId;6==arguments.length&&(o=arguments[5]);var g=aa.workflow.getTaskItems(o,e,n,null,null,null);if(!g.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var u=g.getOutput();t||(t="NA");for(i in u){var c=u[i];if(c.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!s||c.getProcessCode().equals(n))){var l=aa.date.getCurrentDate(),p=c.getStepNumber(),d=c.getProcessID();s?aa.workflow.handleDisposition(o,p,d,t,l,r,a,systemUserObj,"U"):aa.workflow.handleDisposition(o,p,t,l,r,a,systemUserObj,"U"),logMessage("Updating Workflow Task "+e+" with status "+t),logDebug("Updating Workflow Task "+e+" with status "+t)}}}function updateTaskAssignedDate(e,t){var a=!1,r="";3==arguments.length&&(r=arguments[2],a=!0);var s=aa.workflow.getTaskItems(capId,e,r,null,null,null);if(!s.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var n=s.getOutput();for(i in n){var o=n[i];if(o.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!a||o.getProcessCode().equals(r))){var g=aa.util.now(),u=new Date(t);if(g.setTime(u.getTime()),g){var c=o.getTaskItem();c.setAssignmentDate(g);var l=aa.workflow.adjustTaskWithNoAudit(c);logDebug(l.getSuccess()?"Updated Workflow Task : "+e+" Assigned Date to "+t:"Error updating wfTask : "+l.getErrorMessage())}else logDebug("Couldn't update assigned date.  Invalid date : "+t)}}}function updateTaskDepartment(e,t){var a=!1,r="";3==arguments.length&&(r=arguments[2],a=!0);var s=aa.workflow.getTaskItems(capId,e,r,null,null,null);if(!s.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=s.getOutput();for(var n in wfObj)if(fTask=wfObj[n],fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!a||fTask.getProcessCode().equals(r)))if(t){var i=fTask.getTaskItem().getAssignedUser();i.setDeptOfUser(t),fTask.setAssignedUser(i);var o=fTask.getTaskItem(),g=aa.workflow.assignTask(o);logDebug(g.getSuccess()?"Updated Workflow Task : "+e+" Department Set to "+t:"Error updating wfTask : "+g.getErrorMessage())}else logDebug("Couldn't update Department.  Invalid department : "+t)}function updateWorkDesc(e){var t=capId;arguments.length>1&&(t=arguments[1]);var a,r=aa.cap.getCapWorkDesByPK(t);if(!r.getSuccess())return aa.print("**ERROR: Failed to get work description: "+r.getErrorMessage()),!1;var s=r.getOutput();return s?(a=s.getCapWorkDesModel(),a.setDescription(e),aa.cap.editCapWorkDes(a),void aa.print("Updated Work Description to : "+e)):(aa.print("**ERROR: Failed to get workdes Obj: "+r.getErrorMessage()),!1)}function validateGisObjects(){var e=aa.gis.getCapGISObjects(capId);if(!e.getSuccess())return logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+e.getErrorType()+":"+e.getErrorMessage()),!1;var t=e.getOutput();for(a1 in t){var a=aa.gis.getGISObjectAttributes(t[a1]);if(!a.getSuccess())return logDebug("**WARNING: Retrieving GIS Attributes.  Reason is: "+a.getErrorType()+":"+a.getErrorMessage()),!1;var r=a.getOutput();if(null!=r)return!0}}function verhoeff(){var e=new Array;e[0]=new Array(0,1,2,3,4,5,6,7,8,9),e[1]=new Array(1,5,7,6,2,8,3,0,9,4);for(var t=2;8>t;t++){e[t]=new Array;for(var a=0;10>a;a++)e[t][a]=e[t-1][e[1][a]]}Op=new Array,Op[0]=new Array(0,1,2,3,4,5,6,7,8,9),Op[1]=new Array(1,2,3,4,0,6,7,8,9,5),Op[2]=new Array(2,3,4,0,1,7,8,9,5,6),Op[3]=new Array(3,4,0,1,2,8,9,5,6,7),Op[4]=new Array(4,0,1,2,3,9,5,6,7,8),Op[5]=new Array(5,9,8,7,6,0,4,3,2,1),Op[6]=new Array(6,5,9,8,7,1,0,4,3,2),Op[7]=new Array(7,6,5,9,8,2,1,0,4,3),Op[8]=new Array(8,7,6,5,9,3,2,1,0,4),Op[9]=new Array(9,8,7,6,5,4,3,2,1,0),Inv=new Array(0,4,3,2,1,5,6,7,8,9),reverse_str=function(e){for(var t="",a=e.length-1;a>=0;a--)t+=e.charAt(a);return t},this.check=function(t){for(var a=reverse_str(t),r=0,s=0;s<a.length;s++)r=Op[r][e[s%8][a.charAt(s)]];return 0!=r?!1:!0},this.compute=function(t){for(var a="x"+reverse_str(t),r=0,s=1;s<a.length;s++)r=Op[r][e[s%8][a.charAt(s)]];return t+Inv[r]}}function workDescGet(e){var t=aa.cap.getCapWorkDesByPK(e);if(!t.getSuccess())return logDebug("**ERROR: Failed to get work description: "+t.getErrorMessage()),!1;var a=t.getOutput(),r=a.getDescription();return r}function zeroPad(e,t){for(var a=e+"";a.length<t;)a="0"+a;return a}String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/,"")},String.prototype.left=function(e){return this.substr(0,e)},String.prototype.right=function(e){return this.substr(this.length-e,this.length)};